<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document w3p:PR" about="" property="dcterms:language" content="en">
<head>
<title>JSON-LD 1.0 Processing Algorithms and API</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<style type="text/css">
  .highlight {
    font-weight: bold;
    color: #0a3;
  }
  .comment {
    color: #999;
  }
  .error a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
  }
  ol.algorithm {
    counter-reset: numsection;
    list-style-type: none;
  }
  ol.algorithm li {
    margin: 0.5em 0;
  }
  ol.algorithm li:before {
    font-weight: bold;
    counter-increment: numsection;
    content: counters(numsection, ".") ") ";
  }
</style>
<style>
/* --- INLINES --- */
em.rfc2119 {
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}
</style><style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title { color: #2b2; }
div.issue-title span, div.note-title span {
    text-transform: uppercase;
}
div.note, div.issue {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .issue > p:first-child { margin-top: 0 }
.issue, .note {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.issue { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note {
    border-color: #52e052;
    background: #e9fbe9;
}


</style><style>/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID, .idlCallbackID, .idlEnumID {
    font-weight:    bold;
    color:  #005a9c;
}
a.idlEnumItem {
    color:  #000;
    border-bottom:  1px dotted #ccc;
    text-decoration: none;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType, .idlCallbackType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlCtor*/
.idlCtorName {
    color:  #ff4500;
}
.idlCtorName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName, .idlDefaultValue {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlSectionComment*/
.idlSectionComment {
    color: gray;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.constructors, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .constructors dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .constructors dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.constructors dt code {
    background:  #cfc;
}

.attributes dd, .methods dd, .constants dd, .constructors dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}
</style><link href="https://www.w3.org/StyleSheets/TR/W3C-PR" rel="stylesheet"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>

<body id="respecDocument" role="document" class="h-entry"><div id="respecHeader" role="contentinfo" class="head">
  <p>

      <a href="http://www.w3.org/"><img src="https://www.w3.org/Icons/w3c_home" alt="W3C" height="48" width="72"></a>

  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">JSON-LD 1.0 Processing Algorithms and API</h1>

  <h2 id="w3c-proposed-recommendation-05-november-2013" property="dcterms:issued" datatype="xsd:dateTime" content="2013-11-04T23:00:00.000Z"><abbr title="World Wide Web Consortium">W3C</abbr> Proposed Recommendation <time class="dt-published" datetime="2013-11-05">05 November 2013</time></h2>
  <dl>

      <dt>This version:</dt>
      <dd><a class="u-url" href="http://www.w3.org/TR/2013/PR-json-ld-api-20131105/">http://www.w3.org/TR/2013/PR-json-ld-api-20131105/</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/json-ld-api/">http://www.w3.org/TR/json-ld-api/</a></dd>


      <dt>Latest editor's draft:</dt>
      <dd><a href="http://dvcs.w3.org/hg/json-ld/raw-file/default/spec/latest/json-ld-api/index.html">http://dvcs.w3.org/hg/json-ld/raw-file/default/spec/latest/json-ld-api/index.html</a></dd>


      <dt>Test suite:</dt>
      <dd><a href="http://www.w3.org/2013/json-ld-tests/">http://www.w3.org/2013/json-ld-tests/</a></dd>




      <dt>Previous version:</dt>
      <dd><a rel="dcterms:replaces" href="http://www.w3.org/TR/2013/CR-json-ld-api-20130910/">http://www.w3.org/TR/2013/CR-json-ld-api-20130910/</a></dd>


    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Markus Lanthaler" href="http://www.markus-lanthaler.com/">Markus Lanthaler</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.tugraz.at/">Graz University of Technology</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Gregg Kellogg" href="http://greggkellogg.net/">Gregg Kellogg</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://kellogg-assoc.com/">Kellogg Associates</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Manu Sporny" href="http://manu.sporny.org/">Manu Sporny</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://digitalbazaar.com/">Digital Bazaar</a></span>
</dd>


      <dt>Authors:</dt>
      <dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Dave Longley" href="http://digitalbazaar.com/">Dave Longley</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://digitalbazaar.com/">Digital Bazaar</a></span>
</dd>
<dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Gregg Kellogg" href="http://greggkellogg.net/">Gregg Kellogg</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://kellogg-assoc.com/">Kellogg Associates</a></span>
</dd>
<dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Markus Lanthaler" href="http://www.markus-lanthaler.com/">Markus Lanthaler</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.tugraz.at/">Graz University of Technology</a></span>
</dd>
<dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Manu Sporny" href="http://digitalbazaar.com/">Manu Sporny</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://digitalbazaar.com/">Digital Bazaar</a></span>
</dd>



  </dl>


    <p>

        This document is also available in this non-normative format:

      <a rel="alternate" href="diff-20130910.html">diff to previous version</a>
    </p>




      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
        2010-2013

        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved.
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
      </p>


  <hr>
</div>
<section rel="bibo:chapter" resource="#abstract" typeof="bibo:Chapter" datatype="" property="dcterms:abstract" class="introductory" id="abstract"><h2 id="h2_abstract" role="heading" aria-level="1">Abstract</h2>
  <p>This specification defines a set of algorithms for programmatic transformations
    of JSON-LD documents. Restructuring data according to the defined transformations
    often dramatically simplifies its usage. Furthermore, this document proposes
    an Application Programming Interface (API) for developers implementing the
    specified algorithms.</p>
</section><section rel="bibo:chapter" resource="#sotd" typeof="bibo:Chapter" id="sotd" class="introductory"><h2 id="h2_sotd" role="heading" aria-level="1">Status of This Document</h2>



        <p>
          <em>This section describes the status of this document at the time of its publication. Other
          documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision
          of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports
          index</a> at http://www.w3.org/TR/.</em>
        </p>

  <p>This document has been under development for over 31 months in the
    JSON for Linking Data Community Group. The document has been
    transferred to the RDF Working Group for review, improvement, and publication
    along the Recommendation track. The specification has undergone significant
    development, review, and changes during the course of the last 31 months.</p>

  <p>There are several independent
    <a href="http://json-ld.org/test-suite/reports/">interoperable implementations</a> of
    this specification. There is a fairly complete test suite [<cite><a href="#bib-JSON-LD-TESTS" class="bibref">JSON-LD-TESTS</a></cite>]
    and a <a href="http://json-ld.org/playground/">live JSON-LD editor</a>
    that is capable of demonstrating the features described in
    this document. While there will be continuous development on implementations,
    the test suite, and the live editor, they are believed to be mature enough
    to be integrated into a non-production system at this point in time. There
    is an expectation that they could be used in a production system within the
    next two months.</p>

  <p>Changes since the
    <a href="http://www.w3.org/TR/2013/CR-json-ld-api-20130910/">10&nbsp;September&nbsp;2013 Candidate Recommendation</a>:</p>

  <ul>
    <li>Fixed a bug that relabeled blank node identifiers used with reverse properties inconsistently when
      creating a node map .</li>
    <li>Made the API non-normative given that Promises are still not properly specified.</li>
  </ul>

        <p>
          This document was published by the <a href="http://www.w3.org/2011/rdf-wg/">RDF Working Group</a> as a Proposed Recommendation.

            This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation.






              The <abbr title="World Wide Web Consortium">W3C</abbr> Membership and other interested parties are invited
              to review the document and send comments to
              <a rel="discussion" href="mailto:public-rdf-comments@w3.org">public-rdf-comments@w3.org</a>
              (<a href="mailto:public-rdf-comments-request@w3.org?subject=subscribe">subscribe</a>,
              <a href="http://lists.w3.org/Archives/Public/public-rdf-comments/">archives</a>)
              through 05 December 2013.
              Advisory Committee Representatives should consult their
              <a href="https://www.w3.org/2002/09/wbs/myQuestionnaires">WBS questionnaires</a>.
              Note that substantive technical comments were expected during the Last Call review period that ended 06 June 2013.
            </p>



          <p>
            Publication as a Proposed Recommendation does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership.
            This is a draft document and may be updated, replaced or obsoleted by other documents at
            any time. It is inappropriate to cite this document as other than work in progress.
          </p>


        <p>

            This document was produced by a group operating under the

                <a id="sotd_patent" about="" rel="w3p:patentRules" href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.





              <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/46168/status" rel="disclosure">public list of any patent disclosures</a>

            made in connection with the deliverables of the group; that page also includes instructions for
            disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the
            information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.


        </p>




</section><section id="toc"><h2 id="h2_toc" role="heading" aria-level="1" class="introductory">Table of Contents</h2><ul id="respecContents" role="directory" class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><span class="secno">1. </span>Introduction</a></li><li class="tocline"><a class="tocxref" href="#features"><span class="secno">2. </span>Features</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#expansion"><span class="secno">2.1 </span>Expansion</a></li><li class="tocline"><a class="tocxref" href="#compaction"><span class="secno">2.2 </span>Compaction</a></li><li class="tocline"><a class="tocxref" href="#flattening"><span class="secno">2.3 </span>Flattening</a></li><li class="tocline"><a class="tocxref" href="#rdf-serialization-deserialization"><span class="secno">2.4 </span>RDF Serialization/Deserialization</a></li></ul></li><li class="tocline"><a class="tocxref" href="#conformance"><span class="secno">3. </span>Conformance</a></li><li class="tocline"><a class="tocxref" href="#general-terminology"><span class="secno">4. </span>General Terminology</a></li><li class="tocline"><a class="tocxref" href="#algorithm-terms"><span class="secno">5. </span>Algorithm Terms</a></li><li class="tocline"><a class="tocxref" href="#context-processing-algorithms"><span class="secno">6. </span>Context Processing Algorithms</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#context-processing-algorithm"><span class="secno">6.1 </span>Context Processing Algorithm</a></li><li class="tocline"><a class="tocxref" href="#create-term-definition"><span class="secno">6.2 </span>Create Term Definition</a></li><li class="tocline"><a class="tocxref" href="#iri-expansion"><span class="secno">6.3 </span><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion</a></li></ul></li><li class="tocline"><a class="tocxref" href="#expansion-algorithms"><span class="secno">7. </span>Expansion Algorithms</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#expansion-algorithm"><span class="secno">7.1 </span>Expansion Algorithm</a></li><li class="tocline"><a class="tocxref" href="#value-expansion"><span class="secno">7.2 </span>Value Expansion</a></li></ul></li><li class="tocline"><a class="tocxref" href="#compaction-algorithms"><span class="secno">8. </span>Compaction Algorithms</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#compaction-algorithm"><span class="secno">8.1 </span>Compaction Algorithm</a></li><li class="tocline"><a class="tocxref" href="#inverse-context-creation"><span class="secno">8.2 </span>Inverse Context Creation</a></li><li class="tocline"><a class="tocxref" href="#iri-compaction"><span class="secno">8.3 </span><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction</a></li><li class="tocline"><a class="tocxref" href="#term-selection"><span class="secno">8.4 </span>Term Selection</a></li><li class="tocline"><a class="tocxref" href="#value-compaction"><span class="secno">8.5 </span>Value Compaction</a></li></ul></li><li class="tocline"><a class="tocxref" href="#flattening-algorithms"><span class="secno">9. </span>Flattening Algorithms</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#flattening-algorithm"><span class="secno">9.1 </span>Flattening Algorithm</a></li><li class="tocline"><a class="tocxref" href="#node-map-generation"><span class="secno">9.2 </span>Node Map Generation</a></li><li class="tocline"><a class="tocxref" href="#generate-blank-node-identifier"><span class="secno">9.3 </span>Generate Blank Node Identifier</a></li></ul></li><li class="tocline"><a class="tocxref" href="#rdf-serialization-deserialization-algorithms"><span class="secno">10. </span>RDF Serialization/Deserialization Algorithms</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#deserialize-json-ld-to-rdf-algorithm"><span class="secno">10.1 </span>Deserialize JSON-LD to RDF algorithm</a></li><li class="tocline"><a class="tocxref" href="#object-to-rdf-conversion"><span class="secno">10.2 </span>Object to RDF Conversion</a></li><li class="tocline"><a class="tocxref" href="#list-to-rdf-conversion"><span class="secno">10.3 </span>List to RDF Conversion</a></li><li class="tocline"><a class="tocxref" href="#serialize-rdf-as-json-ld-algorithm"><span class="secno">10.4 </span>Serialize RDF as JSON-LD Algorithm</a></li><li class="tocline"><a class="tocxref" href="#rdf-to-object-conversion"><span class="secno">10.5 </span>RDF to Object Conversion</a></li><li class="tocline"><a class="tocxref" href="#data-round-tripping"><span class="secno">10.6 </span>Data Round Tripping</a></li></ul></li><li class="tocline"><a class="tocxref" href="#the-application-programming-interface"><span class="secno">11. </span>The Application Programming Interface</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#the-jsonldprocessor-interface"><span class="secno">11.1 </span>The <span class="formerLink"><code>JsonLdProcessor</code></span> Interface</a></li><li class="tocline"><a class="tocxref" href="#the-jsonldoptions-type"><span class="secno">11.2 </span>The <span class="formerLink"><code>JsonLdOptions</code></span> Type</a></li><li class="tocline"><a class="tocxref" href="#remote-document-and-context-retrieval"><span class="secno">11.3 </span>Remote Document and Context Retrieval</a></li><li class="tocline"><a class="tocxref" href="#error-handling"><span class="secno">11.4 </span>Error Handling</a></li></ul></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></section>




<section id="introduction" class="informative">
  <!--OddPage--><h2 id="h2_introduction" role="heading" aria-level="1"><span class="secno">1. </span>Introduction</h2><p><em>This section is non-normative.</em></p>

  <p>This document is a detailed specification of the JSON-LD processing algorithms.
    The document is primarily intended for the following audiences:</p>

  <ul>
    <li>Software developers who want to implement the algorithms to transform
      JSON-LD documents.</li>
    <li>Web authors and developers who want a very detailed view of how
      a <a href="#dfn-json-ld-processor" title="json-ld-processor" class="tref internalDFN">JSON-LD Processor</a> operates.</li>
    <li>Developers who want an overview of the proposed JSON-LD API.</li>
  </ul>

  <p>To understand the basics in this specification you must first be familiar with
    JSON, which is detailed in [<cite><a href="#bib-RFC4627" class="bibref">RFC4627</a></cite>]. You must also understand the
    JSON-LD syntax defined in [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>], which is the base syntax used by all
    of the algorithms in this document. To understand the API and how it is
    intended to operate in a programming environment, it is useful to have working
    knowledge of the JavaScript programming language [<cite><a href="#bib-ECMA-262" class="bibref">ECMA-262</a></cite>] and
    WebIDL [<cite><a href="#bib-WEBIDL" class="bibref">WEBIDL</a></cite>]. To understand how JSON-LD maps to RDF, it is helpful to be
    familiar with the basic RDF concepts [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>].</p>
</section> <!-- end of Introduction -->


<section id="features" class="informative">
  <!--OddPage--><h2 id="h2_features" role="heading" aria-level="1"><span class="secno">2. </span>Features</h2><p><em>This section is non-normative.</em></p>

  <p>The JSON-LD Syntax specification [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>] defines a syntax to
    express Linked Data in JSON. Because there is more than one way to
    express Linked Data using this syntax, it is often useful to be able to
    transform JSON-LD documents so that they may be more easily consumed by
    specific applications.</p>

  <p>JSON-LD uses <a href="#dfn-context" title="context" class="tref internalDFN">contexts</a> to allow Linked Data
    to be expressed in a way that is specifically tailored to a particular
    person or application. By providing a <a href="#dfn-context" title="context" class="tref internalDFN">context</a>,
    JSON data can be expressed in a way that is a natural fit for a particular
    person or application whilst also indicating how the data should be
    understood at a global scale. In order for people or applications to
    share data that was created using a <a href="#dfn-context" title="context" class="tref internalDFN">context</a> that is different
    from their own, a JSON-LD processor must be able to transform a document
    from one <a href="#dfn-context" title="context" class="tref internalDFN">context</a> to another. Instead of requiring JSON-LD
    processors to write specific code for every imaginable
    <a href="#dfn-context" title="context" class="tref internalDFN">context</a> switching scenario, it is much easier to specify a
    single algorithm that can remove any <a href="#dfn-context" title="context" class="tref internalDFN">context</a>. Similarly,
    another algorithm can be specified to subsequently apply any
    <a href="#dfn-context" title="context" class="tref internalDFN">context</a>. These two algorithms represent the most basic
    transformations of JSON-LD documents. They are referred to as
    <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expansion</a> and <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compaction</a>, respectively.</p>

  <p>There are four major types of transformation that are discussed in this
    document: expansion, compaction, flattening, and RDF serialization/deserialization.</p>

  <section id="expansion" class="informative">
    <h3 id="h3_expansion" role="heading" aria-level="2"><span class="secno">2.1 </span>Expansion</h3><p><em>This section is non-normative.</em></p>

    <p>The algorithm that removes <a href="#dfn-context" title="context" class="tref internalDFN">context</a> is
      called <dfn id="dfn-expansion" title="expansion">expansion</dfn>. Before performing any other
      transformations on a JSON-LD document, it is easiest to
      remove any <a href="#dfn-context" title="context" class="tref internalDFN">context</a> from it and to make data structures
      more regular.</p>

    <p>To get an idea of how context and data structuring affects the same data,
      here is an example of JSON-LD that uses only <a href="#dfn-term" title="term" class="tref internalDFN">terms</a>
      and is fairly compact:</p>

    <div class="example"><div class="example-title"><span>Example 1</span>: Sample JSON-LD document</div><pre class="example">{
  "@context": {
    "name": "http://xmlns.com/foaf/0.1/name",
    "homepage": {
      "@id": "http://xmlns.com/foaf/0.1/homepage",
      "@type": "@id"
    }
  },
  "@id": "http://me.markus-lanthaler.com/",
  "name": "Markus Lanthaler",
  "homepage": "http://www.markus-lanthaler.com/"
}</pre></div>

    <p>The next input example uses one <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> to express a property
    and an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> to encapsulate another, but
    leaves the rest of the information untouched.</p>

    <div class="example"><div class="example-title"><span>Example 2</span>: Sample JSON-LD document using an IRI instead of a term to express a property</div><pre class="example">{
  "@context": {
    <span class="highlight">"website": "http://xmlns.com/foaf/0.1/homepage"</span>
  },
  "@id": "http://me.markus-lanthaler.com/",
  "<span class="highlight">http://xmlns.com/foaf/0.1/name</span>": "Markus Lanthaler",
  <span class="highlight">"website"</span>: <span class="highlight">{ "@id":</span> "http://www.markus-lanthaler.com/" <span class="highlight">}</span>
}</pre></div>

    <p>Note that both inputs are valid JSON-LD and both represent the same
      information. The difference is in their <a href="#dfn-context" title="context" class="tref internalDFN">context</a> information
      and in the data structures used. A JSON-LD processor can remove
      <a href="#dfn-context" title="context" class="tref internalDFN">context</a> and ensure that the data is more regular by employing
      <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expansion</a>.</p>

    <p><a href="#dfn-expansion" title="expansion" class="tref internalDFN">Expansion</a> has two important goals: removing any contextual
      information from the document, and ensuring all values are represented
      in a regular form. These goals are accomplished by expanding all properties
      to <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute IRIs</a> and by expressing all
      values in <a href="#dfn-array" title="array" class="tref internalDFN">arrays</a> in
      <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a>. <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">Expanded form</a> is the most verbose
      and regular way of expressing of values in JSON-LD; all contextual
      information from the document is instead stored locally with each value.
      Running the <a href="#expansion-algorithm">Expansion algorithm</a>
      (<code class="idlMemberName"><a href="#widl-JsonLdProcessor-expand-Promise-any-input-JsonLdOptions-options">expand</a></code>
      operation) against the above examples results in the following output:</p>

    <div class="example"><div class="example-title"><span>Example 3</span>: Expanded sample document</div><pre class="example">[
  {
    "@id": "http://me.markus-lanthaler.com/",
    "http://xmlns.com/foaf/0.1/name": [
      { "@value": "Markus Lanthaler" }
    ],
    "http://xmlns.com/foaf/0.1/homepage": [
      { "@id": "http://www.markus-lanthaler.com/" }
    ]
  }
]</pre></div>

    <p>Note that in the output above all <a href="#dfn-context" title="context" class="tref internalDFN">context</a> definitions have
      been removed, all <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> and
      <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a> have been expanded to absolute
      <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a>, and all
      <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD values</a> are expressed in
      <a href="#dfn-array" title="array" class="tref internalDFN">arrays</a> in <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a>. While the
      output is more verbose and difficult for a human to read, it establishes a
      baseline that makes JSON-LD processing easier because of its very regular
      structure.</p>
  </section> <!-- end of Expansion -->

  <section id="compaction" class="informative">
    <h3 id="h3_compaction" role="heading" aria-level="2"><span class="secno">2.2 </span>Compaction</h3><p><em>This section is non-normative.</em></p>

    <p>While <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expansion</a> removes <a href="#dfn-context" title="context" class="tref internalDFN">context</a> from a given
      input, <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compaction's</a> primary function is to
      perform the opposite operation: to express a given input according to
      a particular <a href="#dfn-context" title="context" class="tref internalDFN">context</a>. <dfn id="dfn-compaction" title="compaction">Compaction</dfn> applies a
      <a href="#dfn-context" title="context" class="tref internalDFN">context</a> that specifically tailors the way information is
      expressed for a particular person or application. This simplifies applications
      that consume JSON or JSON-LD by expressing the data in application-specific
      terms, and it makes the data easier to read by humans.</p>

    <p><a href="#dfn-compaction" title="compaction" class="tref internalDFN">Compaction</a> uses a developer-supplied <a href="#dfn-context" title="context" class="tref internalDFN">context</a> to
      shorten <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> to <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> or
      <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a> and
      <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD values</a> expressed in
      <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a> to simple values such as <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>
      or <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a>.</p>

    <p>For example, assume the following expanded JSON-LD input document:</p>

    <div class="example"><div class="example-title"><span>Example 4</span>: Expanded sample document</div><pre class="example">[
  {
    "@id": "http://me.markus-lanthaler.com/",
    "http://xmlns.com/foaf/0.1/name": [
      { "@value": "Markus Lanthaler" }
    ],
    "http://xmlns.com/foaf/0.1/homepage": [
      { "@id": "http://www.markus-lanthaler.com/" }
    ]
  }
]</pre></div>

    <p>Additionally, assume the following developer-supplied JSON-LD
      <a href="#dfn-context" title="context" class="tref internalDFN">context</a>:</p>

    <div class="example"><div class="example-title"><span>Example 5</span>: JSON-LD context</div><pre class="example">{
  "@context": {
    "name": "http://xmlns.com/foaf/0.1/name",
    "homepage": {
      "@id": "http://xmlns.com/foaf/0.1/homepage",
      "@type": "@id"
    }
  }
}</pre></div>

    <p>Running the <a href="#compaction-algorithm">Compaction Algorithm</a>
      (<code class="idlMemberName"><a href="#widl-JsonLdProcessor-compact-Promise-any-input-JsonLdContext-context-JsonLdOptions-options">compact</a></code>
      operation) given the context supplied above against the JSON-LD input
      document provided above would result in the following output:</p>

    <div class="example"><div class="example-title"><span>Example 6</span>: Compacted sample document</div><pre class="example">{
  "@context": {
    "name": "http://xmlns.com/foaf/0.1/name",
    "homepage": {
      "@id": "http://xmlns.com/foaf/0.1/homepage",
      "@type": "@id"
    }
  },
  "@id": "http://me.markus-lanthaler.com/",
  "name": "Markus Lanthaler",
  "homepage": "http://www.markus-lanthaler.com/"
}</pre></div>

    <p>Note that all <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> have been compacted to
      <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> as specified in the <a href="#dfn-context" title="context" class="tref internalDFN">context</a>,
      which has been injected into the output. While compacted output is
      useful to humans, it is also used to generate structures that are easy to
      program against. Compaction enables developers to map any expanded document
      into an application-specific compacted document. While the context provided
      above mapped <code>http://xmlns.com/foaf/0.1/name</code> to <code>name</code>, it
      could also have been mapped to any other term provided by the developer.</p>
  </section> <!-- end of Compaction -->

  <section id="flattening" class="informative">
    <h3 id="h3_flattening" role="heading" aria-level="2"><span class="secno">2.3 </span>Flattening</h3><p><em>This section is non-normative.</em></p>

    <p>While expansion ensures that a document is in a uniform structure,
      flattening goes a step further to ensure that the shape of the data
      is deterministic. In expanded documents, the properties of a single
      <a href="#dfn-node" title="node" class="tref internalDFN">node</a> may be spread across a number of different
      <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a>. By flattening a
      document, all properties of a <a href="#dfn-node" title="node" class="tref internalDFN">node</a> are collected in a single
      <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> and all <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank nodes</a>
      are labeled with a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>. This may drastically
      simplify the code required to process JSON-LD data in certain applications.</p>

    <p>For example, assume the following JSON-LD input document:</p>

    <div class="example"><div class="example-title"><span>Example 7</span>: Sample JSON-LD document</div><pre class="example">{
  "@context": {
    "name": "http://xmlns.com/foaf/0.1/name",
    "knows": "http://xmlns.com/foaf/0.1/knows"
  },
  "@id": "http://me.markus-lanthaler.com/",
  "name": "Markus Lanthaler",
  "knows": [
    {
      "name": "Dave Longley"
    }
  ]
}</pre></div>

    <p>Running the <a href="#flattening-algorithm">Flattening algorithm</a>
      (<code class="idlMemberName"><a href="#widl-JsonLdProcessor-flatten-Promise-any-input-JsonLdContext-context-JsonLdOptions-options">flatten</a></code>
      operation) with a context set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a> to prevent compaction
      returns the following document:</p>

    <div class="example"><div class="example-title"><span>Example 8</span>: Flattened sample document in expanded form</div><pre class="example">[
  {
    "@id": "_:t0",
    "http://xmlns.com/foaf/0.1/name": [
      { "@value": "Dave Longley" }
    ]
  },
  {
    "@id": "http://me.markus-lanthaler.com/",
    "http://xmlns.com/foaf/0.1/name": [
      { "@value": "Markus Lanthaler" }
    ],
    "http://xmlns.com/foaf/0.1/knows": [
      { "@id": "_:t0" }
    ]
  }
]</pre></div>

    <p>Note how in the output above all properties of a <a href="#dfn-node" title="node" class="tref internalDFN">node</a> are collected in a
      single <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> and how the <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a> representing
      "Dave Longley" has been assigned the <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>
      <code>_:t0</code>.</p>

    <p>To make it easier for humans to read or for certain applications to
      process it, a flattened document can be compacted by passing a context. Using
      the same context as the input document, the flattened and compacted document
      looks as follows:</p>

    <div class="example"><div class="example-title"><span>Example 9</span>: Flattened and compacted sample document</div><pre class="example">{
  "@context": {
    "name": "http://xmlns.com/foaf/0.1/name",
    "knows": "http://xmlns.com/foaf/0.1/knows"
  },
  "@graph": [
    {
      "@id": "_:t0",
      "name": "Dave Longley"
    },
    {
      "@id": "http://me.markus-lanthaler.com/",
      "name": "Markus Lanthaler",
      "knows": { "@id": "_:t0" }
    }
  ]
}</pre></div>

    <p>Please note that the result of flattening and compacting a document
      is always a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> which contains an <code>@graph</code>
      member that represents the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a>.</p>
  </section> <!-- end of Flattening -->

  <section id="rdf-serialization-deserialization" class="informative">
    <h3 id="h3_rdf-serialization-deserialization" role="heading" aria-level="2"><span class="secno">2.4 </span>RDF Serialization/Deserialization</h3><p><em>This section is non-normative.</em></p>

    <p>JSON-LD can be used to serialize RDF data as described in
      [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>]. This ensures that data can be round-tripped to and from
      any RDF syntax without any loss in fidelity.</p>

    <p>For example, assume the following RDF input serialized in Turtle [<cite><a href="#bib-TURTLE" class="bibref">TURTLE</a></cite>]:</p>

    <div class="example"><div class="example-title"><span>Example 10</span>: Sample Turtle document</div><pre class="example">&lt;http://me.markus-lanthaler.com/&gt; &lt;http://xmlns.com/foaf/0.1/name&gt; "Markus Lanthaler" .
&lt;http://me.markus-lanthaler.com/&gt; &lt;http://xmlns.com/foaf/0.1/homepage&gt; &lt;http://www.markus-lanthaler.com/&gt; .</pre></div>

    <p>Using the <a href="#serialize-rdf-as-json-ld-algorithm">Serialize RDF as JSON-LD algorithm</a>
      a developer could transform this document into expanded JSON-LD:</p>

    <div class="example"><div class="example-title"><span>Example 11</span>: Sample Turtle document converted to JSON-LD</div><pre class="example">[
  {
    "@id": "http://me.markus-lanthaler.com/",
    "http://xmlns.com/foaf/0.1/name": [
      { "@value": "Markus Lanthaler" }
    ],
    "http://xmlns.com/foaf/0.1/homepage": [
      { "@id": "http://www.markus-lanthaler.com/" }
    ]
  }
]</pre></div>

    <p>Note that the output above could easily be compacted using the technique outlined
      in the previous section. It is also possible to deserialize the JSON-LD document back
      to RDF using the <a href="#deserialize-json-ld-to-rdf-algorithm">Deserialize JSON-LD to RDF algorithm</a>.</p>
  </section> <!-- end of RDF Serialization/Deserialization -->
</section> <!-- end of Features section -->


<section id="conformance">
  <!--OddPage--><h2 id="h2_conformance" role="heading" aria-level="1"><span class="secno">3. </span>Conformance</h2>

  <p>All examples and notes as well as sections marked as non-normative in this
    specification are non-normative. Everything else in this specification is
    normative.</p>

  <p>The keywords <em title="MUST" class="rfc2119">MUST</em>, <em title="MUST NOT" class="rfc2119">MUST NOT</em>, <em title="REQUIRED" class="rfc2119">REQUIRED</em>, <em title="SHOULD" class="rfc2119">SHOULD</em>, <em title="SHOULD NOT" class="rfc2119">SHOULD NOT</em>, <em title="RECOMMENDED" class="rfc2119">RECOMMENDED</em>,
    <em title="MAY" class="rfc2119">MAY</em>, and <em title="OPTIONAL" class="rfc2119">OPTIONAL</em> in this specification are to be interpreted as described
    in [<cite><a href="#bib-RFC2119" class="bibref">RFC2119</a></cite>].</p>

  <p>There are two classes of products that can claim conformance to this
    specification: <a href="#dfn-json-ld-processor" title="json-ld-processor" class="tref internalDFN">JSON-LD Processors</a>,
    and <a href="#dfn-rdf-serializer/deserializer" title="rdf-serializer/deserializer" class="tref internalDFN">RDF Serializers/Deserializers</a>.</p>

  <p>A conforming <dfn id="dfn-json-ld-processor" title="json-ld-processor">JSON-LD Processor</dfn> is a system which can perform the
    <a href="#expansion-algorithm">Expansion</a>, <a href="#compaction-algorithm">Compaction</a>,
    and <a href="#flattening-algorithm">Flattening</a> operations defined in this specification.</p>

  <p><a href="#dfn-json-ld-processor" title="json-ld-processor" class="tref internalDFN">JSON-LD Processors</a> <em title="MUST NOT" class="rfc2119">MUST NOT</em>
    attempt to correct malformed <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> or language tags;
    however, they <em title="MAY" class="rfc2119">MAY</em> issue validation warnings. IRIs are not modified other
    than conversion between <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative</a> and
    <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute IRIs</a>.</p>

  <p>A conforming <dfn id="dfn-rdf-serializer/deserializer" title="rdf-serializer/deserializer">RDF Serializer/Deserializer</dfn> is a system that can
    <a href="#deserialize-json-ld-to-rdf-algorithm">deserialize JSON-LD to RDF</a> and
    <a href="#serialize-rdf-as-json-ld-algorithm">serialize RDF as JSON-LD</a> as
    defined in this specification.</p>

  <p>The algorithms in this specification are generally written with more concern for clarity
    than efficiency. Thus, <a href="#dfn-json-ld-processor" title="json-ld-processor" class="tref internalDFN">JSON-LD Processors</a> may
    implement the algorithms given in this specification in any way desired,
    so long as the end result is indistinguishable from the result that would
    be obtained by the specification's algorithms.</p>

  <div class="note"><div id="h_note_1" role="heading" aria-level="2" class="note-title"><span>Note</span></div><p class="">Implementers can partially check their level of conformance to
    this specification by successfully passing the test cases of the JSON-LD test
    suite [<cite><a href="#bib-JSON-LD-TESTS" class="bibref">JSON-LD-TESTS</a></cite>]. Note, however, that passing all the tests in the test
    suite does not imply complete conformance to this specification. It only implies
    that the implementation conforms to aspects tested by the test suite.</p></div>
</section> <!-- end of Conformance section -->


<section id="general-terminology">
  <!--OddPage--><h2 id="h2_general-terminology" role="heading" aria-level="1"><span class="secno">4. </span>General Terminology</h2>

  <p>This document uses the following terms as defined in JSON [<cite><a href="#bib-RFC4627" class="bibref">RFC4627</a></cite>]. Refer
    to the <em>JSON Grammar</em> section in [<cite><a href="#bib-RFC4627" class="bibref">RFC4627</a></cite>] for formal definitions.</p>

  <dl>
    <dt><dfn id="dfn-json-object" title="json-object">JSON object</dfn></dt>
    <dd>An object structure is represented as a pair of curly brackets surrounding
      zero or more key-value pairs. A key is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>.
      A single colon comes after each key, separating the key from the value.
      A single comma separates a value from a following key. In contrast to JSON,
      in JSON-LD the keys in an object must be unique.</dd>
    <dt><dfn id="dfn-array" title="array">array</dfn></dt>
    <dd>An array structure is represented as square brackets surrounding zero
      or more values. Values are separated by commas.
      In JSON, an array is an <em>ordered</em> sequence of zero or more values.
      While JSON-LD uses the same array representation as JSON,
      the collection is <em>unordered</em> by default. While order is
      preserved in regular JSON arrays, it is not in regular JSON-LD arrays
      unless specifically defined (see
      <cite><a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#sets-and-lists">Sets and Lists</a></cite> in
      the JSON-LD specification [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>]).</dd>
    <dt><dfn id="dfn-string" title="string">string</dfn></dt>
    <dd>A string is a sequence of zero or more Unicode characters,
      wrapped in double quotes, using backslash escapes (if necessary). A
      character is represented as a single character string.</dd>
    <dt><dfn id="dfn-number" title="number">number</dfn></dt>
    <dd>A number is similar to that used in most programming languages, except
      that the octal and hexadecimal formats are not used and that leading
      zeros are not allowed.</dd>
    <dt><dfn id="dfn-true" title="true">true</dfn> and <dfn id="dfn-false" title="false">false</dfn></dt>
    <dd>Values that are used to express one of two possible boolean states.</dd>
    <dt><dfn id="dfn-null" title="null">null</dfn></dt>
    <dd>The <a href="#dfn-null" title="null" class="tref internalDFN">null</a> value. A key-value pair in the
      <code>@context</code> where the value, or the <code>@id</code> of the
      value, is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> explicitly decouples a term's association
      with an <abbr title="Internationalized Resource Identifier">IRI</abbr>. A key-value pair in the body of a JSON-LD document whose
      value is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> has the same meaning as if the key-value pair
      was not defined. If <code>@value</code>, <code>@list</code>, or
      <code>@set</code> is set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a> in expanded form, then
      the entire <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> is ignored.</dd>
  </dl>

  <p>Furthermore, the following terminology is used throughout this document:</p>

  <dl>
    <dt><dfn id="dfn-keyword" title="keyword">keyword</dfn></dt>
    <dd>A JSON key that is specific to JSON-LD, specified in the section
      <cite><a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#syntax-tokens-and-keywords">Syntax Tokens and Keywords</a></cite>
      of the JSON-LD specification [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>].</dd>
    <dt><dfn id="dfn-context" title="context">context</dfn></dt>
    <dd>A set of rules for interpreting a JSON-LD document as specified in the section
      <cite><a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#the-context">The Context</a></cite> of the JSON-LD
      specification [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>].</dd>
    <dt><dfn id="dfn-json-ld-document" title="json-ld-document">JSON-LD document</dfn></dt>
    <dd>A <a href="#dfn-json-ld-document" title="json-ld-document" class="tref internalDFN">JSON-LD document</a> is a serialization of a collection of
      <a href="#dfn-graph" title="graph" class="tref internalDFN">graphs</a> and comprises exactly one
      <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a> and zero or more <a href="#dfn-named-graph" title="named-graph" class="tref internalDFN">named graphs</a>.</dd>
    <dt><dfn id="dfn-named-graph" title="named-graph">named graph</dfn></dt>
    <dd>A named graph is a pair consisting of an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a>
      (the <dfn id="dfn-graph-name" title="graph-name">graph name</dfn>) and a <a href="#dfn-graph" title="graph" class="tref internalDFN">graph</a>.</dd>
    <dt><dfn id="dfn-default-graph" title="default-graph">default graph</dfn></dt>
    <dd>The default graph is the only graph in a JSON-LD document which has no <a href="#dfn-graph-name" title="graph-name" class="tref internalDFN">graph name</a>.</dd>
    <dt><dfn id="dfn-graph" title="graph">Graph</dfn></dt>
    <dd>A labeled directed graph, i.e., a set of <a href="#dfn-node" title="node" class="tref internalDFN">nodes</a>
      connected by <a href="#dfn-edge" title="edge" class="tref internalDFN">edges</a>,
      as specified in the <cite><a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#data-model">Data Model</a></cite>
      section of the JSON-LD specification [<cite><a href="#bib-JSON-LD" class="bibref">JSON-LD</a></cite>].</dd>
    <dt><dfn id="dfn-edge" title="edge">edge</dfn></dt>
    <dd>Every <a href="#dfn-edge" title="edge" class="tref internalDFN">edge</a> has a direction associated with it and is labeled with
      an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>. Within the JSON-LD syntax
      these edge labels are called <dfn id="dfn-property" title="property">properties</dfn>. Whenever possible, an
      <a href="#dfn-edge" title="edge" class="tref internalDFN">edge</a> should be labeled with an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</dd>
    <dt><dfn id="dfn-node" title="node">node</dfn></dt>
    <dd>Every <a href="#dfn-node" title="node" class="tref internalDFN">node</a> is an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, a <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a>,
      a <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD value</a>, or a <a href="#dfn-list" title="list" class="tref internalDFN">list</a>.</dd>
    <dt><dfn id="dfn-iri" title="iri"><abbr title="Internationalized Resource Identifier">IRI</abbr></dfn></dt>
    <dd>An <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> (Internationalized Resource Identifier) is a string that conforms to the syntax
      defined in [<cite><a href="#bib-RFC3987" class="bibref">RFC3987</a></cite>].</dd>
    <dt><dfn id="dfn-absolute-iri" title="absolute-iri">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></dfn></dt>
    <dd>An absolute <abbr title="Internationalized Resource Identifier">IRI</abbr> is defined in [<cite><a href="#bib-RFC3987" class="bibref">RFC3987</a></cite>] containing a <em>scheme</em> along with a <em>path</em> and
      optional <em>query</em> and fragment segments.</dd>
    <dt><dfn id="dfn-relative-iri" title="relative-iri">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></dfn></dt>
    <dd>A relative <abbr title="Internationalized Resource Identifier">IRI</abbr> is an <abbr title="Internationalized Resource Identifier">IRI</abbr> that is relative to some other <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</dd>
    <dt><dfn id="dfn-blank-node" title="blank-node">blank node</dfn></dt>
    <dd>A <a href="#dfn-node" title="node" class="tref internalDFN">node</a> in a <a href="#dfn-graph" title="graph" class="tref internalDFN">graph</a> that is neither an
      <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, nor a <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD value</a>, nor a <a href="#dfn-list" title="list" class="tref internalDFN">list</a>.</dd>
    <dt><dfn id="dfn-blank-node-identifier" title="blank-node-identifier">blank node identifier</dfn></dt>
    <dd>A blank node identifier is a string that can be used as an identifier for a
      <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a> within the scope of a JSON-LD document. Blank node identifiers
      begin with <code>_:</code>.</dd>
    <dt><dfn id="dfn-json-ld-value" title="json-ld-value">JSON-LD value</dfn></dt>
    <dd>A <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD value</a> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, a <a href="#dfn-number" title="number" class="tref internalDFN">number</a>,
      <a href="#dfn-true" title="true" class="tref internalDFN">true</a> or <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, a <a href="#dfn-typed-value" title="typed-value" class="tref internalDFN">typed value</a>, or a
      <a href="#dfn-language-tagged-string" title="language-tagged-string" class="tref internalDFN">language-tagged string</a>.</dd>
    <dt><dfn id="dfn-typed-value" title="typed-value">typed value</dfn></dt>
    <dd>A <a href="#dfn-typed-value" title="typed-value" class="tref internalDFN">typed value</a> consists of a value, which is a string, and a type,
      which is an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</dd>
    <dt><dfn id="dfn-language-tagged-string" title="language-tagged-string">language-tagged string</dfn></dt>
    <dd>A <a href="#dfn-language-tagged-string" title="language-tagged-string" class="tref internalDFN">language-tagged string</a> consists of a string and a non-empty language
      tag as defined by [<cite><a href="#bib-BCP47" class="bibref">BCP47</a></cite>]. The language tag must be well-formed according to
      <a href="http://tools.ietf.org/html/bcp47#section-2.2.9">section 2.2.9 Classes of Conformance</a>
      of [<cite><a href="#bib-BCP47" class="bibref">BCP47</a></cite>], and is normalized to lowercase.</dd>
    <dt><dfn id="dfn-list" title="list">list</dfn></dt>
    <dd>A <a href="#dfn-list" title="list" class="tref internalDFN">list</a> is an ordered sequence of <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a>,
      <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank nodes</a>, and
      <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD values</a>.</dd>
  </dl>
</section> <!-- end of General Terminology section -->


<section id="algorithm-terms">
  <!--OddPage--><h2 id="h2_algorithm-terms" role="heading" aria-level="1"><span class="secno">5. </span>Algorithm Terms</h2>

  <dl>
    <dt><dfn id="dfn-active-graph" title="active-graph">active graph</dfn></dt>
    <dd>The name of the currently active graph that the processor should use when
      processing.</dd>
    <dt><dfn id="dfn-active-subject" title="active-subject">active subject</dfn></dt>
    <dd>The currently active subject that the processor should use when
      processing.</dd>
    <dt><dfn id="dfn-active-property" title="active-property">active property</dfn></dt>
    <dd>The currently active <a href="#dfn-property" title="property" class="tref internalDFN">property</a> or <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> that
      the processor should use when processing.</dd>
    <dt><dfn id="dfn-active-context" title="active-context">active context</dfn></dt>
    <dd>A context that is used to resolve <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> while
      the processing algorithm is running.</dd>
    <dt><dfn id="dfn-local-context" title="local-context">local context</dfn></dt>
    <dd>A context that is specified within a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>,
      specified via the <code>@context</code> <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>.</dd>
    <dt><dfn id="dfn-json-ld-input" title="json-ld-input">JSON-LD input</dfn></dt>
    <dd>The JSON-LD data structure that is provided as input to the algorithm.</dd>
    <dt><dfn id="dfn-term" title="term">term</dfn></dt>
    <dd>A <a href="#dfn-term" title="term" class="tref internalDFN">term</a> is a short word defined in a context that may be expanded to
      an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a></dd>
    <dt><dfn id="dfn-compact-iri" title="compact-iri">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></dfn></dt>
    <dd>A compact <abbr title="Internationalized Resource Identifier">IRI</abbr> has the form of <dfn id="dfn-prefix" title="prefix">prefix</dfn>:<em>suffix</em> and is used as a way
      of expressing an <abbr title="Internationalized Resource Identifier">IRI</abbr> without needing to define separate <a href="#dfn-term" title="term" class="tref internalDFN">term</a> definitions for
      each <abbr title="Internationalized Resource Identifier">IRI</abbr> contained within a common vocabulary identified by <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>.</dd>
    <dt><dfn id="dfn-node-object" title="node-object">node object</dfn></dt>
    <dd>A <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> represents zero or more properties of a
      <a href="#dfn-node" title="node" class="tref internalDFN">node</a> in the <a href="#dfn-graph" title="graph" class="tref internalDFN">graph</a> serialized by the
      JSON-LD document. A <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> is a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>
      if it exists outside of the JSON-LD <a href="#dfn-context" title="context" class="tref internalDFN">context</a> and:
      <ul>
        <li>it does not contain the <code>@value</code>, <code>@list</code>,
          or <code>@set</code> keywords, or</li>
        <li>it is not the top-most <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> in the JSON-LD document consisting
          of no other members than <code>@graph</code> and <code>@context</code>.</li>
      </ul>
    </dd>
    <dt><dfn id="dfn-value-object" title="value-object">value object</dfn></dt>
    <dd>A <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> that has an <code>@value</code>
      member.</dd>
    <dt><dfn id="dfn-list-object" title="list-object">list object</dfn></dt>
    <dd>A <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> that has an <code>@list</code>
      member.</dd>
    <dt><dfn id="dfn-set-object" title="set-object">set object</dfn></dt>
    <dd>A <a href="#dfn-set-object" title="set-object" class="tref internalDFN">set object</a> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> that has an <code>@set</code>
      member.</dd>
    <dt><dfn id="dfn-scalar" title="scalar">scalar</dfn></dt>
    <dd>A scalar is either a JSON <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, <a href="#dfn-number" title="number" class="tref internalDFN">number</a>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
      or <a href="#dfn-false" title="false" class="tref internalDFN">false</a>.</dd>
    <dt><dfn id="dfn-rdf-subject" title="rdf-subject">RDF subject</dfn></dt>
    <dd>A <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-subject" title="subject" class="tref externalDFN">subject</a>
      as specified by [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>].</dd>
    <dt><dfn id="dfn-rdf-predicate" title="rdf-predicate">RDF predicate</dfn></dt>
    <dd>A <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-predicate" title="predicate" class="tref externalDFN">predicate</a>
      as specified by [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>].</dd>
    <dt><dfn id="dfn-rdf-object" title="rdf-object">RDF object</dfn></dt>
    <dd>An <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-object" title="object" class="tref externalDFN">object</a>
      as specified by [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>].</dd>
    <dt><dfn id="dfn-rdf-triple" title="rdf-triple">RDF triple</dfn></dt>
    <dd>A <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref externalDFN">triple</a>
      as specified by [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>].</dd>
    <dt><dfn id="dfn-rdf-dataset" title="rdf-dataset">RDF dataset</dfn></dt>
    <dd>A <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-dataset" title="dataset" class="tref externalDFN">dataset</a>
      as specified by [<cite><a href="#bib-RDF11-CONCEPTS" class="bibref">RDF11-CONCEPTS</a></cite>] representing a collection of
      <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph" title="rdf-graphs" class="tref externalDFN">RDF graphs</a>.</dd>
  </dl>
</section> <!-- end of Algorithm Terms section -->


<section id="context-processing-algorithms">
  <!--OddPage--><h2 id="h2_context-processing-algorithms" role="heading" aria-level="1"><span class="secno">6. </span>Context Processing Algorithms</h2>

  <section id="context-processing-algorithm">
    <h3 id="h3_context-processing-algorithm" role="heading" aria-level="2"><span class="secno">6.1 </span>Context Processing Algorithm</h3>

    <p>When processing a JSON-LD data structure, each processing rule is applied
      using information provided by the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. This
      section describes how to produce an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>.</p>

    <p>The <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> contains the active
      <dfn id="dfn-term-definition" title="term-definition">term definitions</dfn> which specify how
      properties and values have to be interpreted as well as the current <dfn id="dfn-base-iri" title="base-iri">base <abbr title="Internationalized Resource Identifier">IRI</abbr></dfn>,
      the <dfn id="dfn-vocabulary-mapping" title="vocabulary-mapping">vocabulary mapping</dfn> and the <dfn id="dfn-default-language" title="default-language">default language</dfn>. Each
      <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> consists of an <dfn id="dfn-iri-mapping" title="iri-mapping"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</dfn>, a boolean
      flag <dfn id="dfn-reverse-property" title="reverse-property">reverse property</dfn>, an optional <dfn id="dfn-type-mapping" title="type-mapping">type mapping</dfn>
      or <dfn id="dfn-language-mapping" title="language-mapping">language mapping</dfn>, and an optional  <dfn id="dfn-container-mapping" title="container-mapping">container mapping</dfn>.
      A <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> can not only be used to map a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
      to an <abbr title="Internationalized Resource Identifier">IRI</abbr>, but also to map a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> to a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>,
      in which case it is referred to as a <dfn id="dfn-keyword-alias" title="keyword-alias">keyword alias</dfn>.</p>

    <p>When processing, the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is initialized
      without any <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definitions</a>,
      <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, or <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>.
      If a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> is encountered during processing, a new
      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is created by cloning the existing
      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. Then the information from the
      <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> is merged into the new <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>.
      Given that <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local contexts</a> may contain
      references to remote contexts, this includes their retrieval.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>First we prepare a new <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> <i>result</i> by cloning
        the current <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. Then we normalize the form of the passed
        <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.
        <a href="#dfn-local-context" title="local-context" class="tref internalDFN">Local contexts</a> may be in the form of a
        <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, or an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing
        a combination of the two. Finally we process each <a href="#dfn-context" title="context" class="tref internalDFN">context</a> contained
        in the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> <a href="#dfn-array" title="array" class="tref internalDFN">array</a> as follows.</p>

      <p>If <a href="#dfn-context" title="context" class="tref internalDFN">context</a> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, it represents a reference to
        a remote context. We dereference the remote context and replace <a href="#dfn-context" title="context" class="tref internalDFN">context</a>
        with the value of the <code>@context</code> key of the top-level object in the
        retrieved JSON-LD document. If there's no such key, an invalid remote context has
        been detected. Otherwise, we process <a href="#dfn-context" title="context" class="tref internalDFN">context</a> by recursively using
        this algorithm ensuring that there is no cyclical reference.</p>

      <p>If <a href="#dfn-context" title="context" class="tref internalDFN">context</a> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, we first update the
        <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, the <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, and the
        <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a> by processing three specific keywords:
        <code>@base</code>, <code>@vocab</code>, and <code>@language</code>.
        These are handled before any other keys in the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> because
        they affect how the other keys are processed. Please note that <code>@base</code> is
        ignored when processing remote contexts.</p>

      <p>Then, for every other key in <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, we update
        the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in <i>result</i>. Since
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definitions</a> in a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>
        may themselves contain <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> or
        <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a>, we may need to recurse.
        When doing so, we must ensure that there is no cyclical dependency,
        which is an error. After we have processed any
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> dependencies,
        we update the current <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>,
        which may be a <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword alias</a>.</p>

      <p>Finally, we return <i>result</i> as the new <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm">Algorithm</h4>

      <p>This algorithm specifies how a new <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is updated
        with a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. The algorithm takes three input variables:
        an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, and an  <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
        <i>remote contexts</i> which is used to detect cyclical context inclusions.
        If <i>remote contexts</i> is not passed, it is initialized to an empty
        <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</p>

      <ol class="algorithm">
        <li>Initialize <i>result</i> to the result of cloning
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>.</li>
        <li>If <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
          set it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only
          <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>.</li>
        <li>
          For each item <i>context</i> in <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>:
          <ol class="algorithm">
            <li>If <i>context</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set <i>result</i> to a
              newly-initialized <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and continue with the
              next <i>context</i>. The <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> of the
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is set to the <abbr title="Internationalized Resource Identifier">IRI</abbr> of the currently being processed
              document (which might be different from the currently being processed context),
              if available; otherwise to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If set, the
              <code class="idlMemberName"><a href="#widl-JsonLdOptions-base">base</a></code>
              option of a JSON-LD API Implementation overrides the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
            <li>If <i>context</i> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>,
              <ol class="algorithm">
                <li>Set <i>context</i> to the result of resolving <i>value</i> against
                  the base <abbr title="Internationalized Resource Identifier">IRI</abbr> which is established as specified in
                  <cite><a href="http://tools.ietf.org/html/rfc3986#section-5.1">section 5.1 Establishing a Base URI</a></cite>
                  of [<cite><a href="#bib-RFC3986" class="bibref">RFC3986</a></cite>]. Only the basic algorithm in
                  <cite><a href="http://tools.ietf.org/html/rfc3986#section-5.2">section 5.2</a></cite>
                  of [<cite><a href="#bib-RFC3986" class="bibref">RFC3986</a></cite>] is used; neither
                  <cite><a href="http://tools.ietf.org/html/rfc3986#section-6.2.2">Syntax-Based Normalization</a></cite> nor
                  <cite><a href="http://tools.ietf.org/html/rfc3986#section-6.2.3">Scheme-Based Normalization</a></cite>
                  are performed. Characters additionally allowed in <abbr title="Internationalized Resource Identifier">IRI</abbr>
                  references are treated in the same way that unreserved
                  characters are treated in URI references, per
                  <cite><a href="http://tools.ietf.org/html/rfc3987#section-6.5">section 6.5</a></cite>
                  of [<cite><a href="#bib-RFC3987" class="bibref">RFC3987</a></cite>].</li>
                <li>If <i>context</i> is in the <i>remote contexts</i> array, a
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.recursive-context-inclusion">recursive context inclusion</a></code>
                  error has been detected and processing is aborted;
                  otherwise, add <i>context</i> to <i>remote contexts</i>.</li>
                <li>Dereference <i>context</i>. If <i>context</i> cannot be dereferenced, a
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.loading-remote-context-failed">loading remote context failed</a></code>
                  error has been detected and processing is aborted. If the dereferenced document has no
                  top-level <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with an <code>@context</code> member, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-remote-context">invalid remote context</a></code>
                  has been detected and processing is aborted; otherwise,
                  set <i>context</i> to the value of that member.</li>
                <li>Set <i>result</i> to the result of recursively calling this algorithm,
                  passing <i>result</i> for <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  <i>context</i> for <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, and <i>remote contexts</i>.</li>
                <li>Continue with the next <i>context</i>.</li>
              </ol>
            </li>
            <li>If <i>context</i> is not a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-local-context">invalid local context</a></code>
              error has been detected and processing is aborted.</li>
            <li>If <i>context</i> has an <code>@base</code> key and <i>remote contexts</i> is empty, i.e., the currently
              being processed context is not a remote context:
              <ol class="algorithm">
                <li>Initialize <i>value</i> to the value associated with the
                  <code>@base</code> key.</li>
                <li>If <i>value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, remove the
                  <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> of <i>result</i>.</li>
                <li>Otherwise, if <i>value</i> is an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>,
                  the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> of <i>result</i> is set to <i>value</i>.</li>
                <li>Otherwise, if <i>value</i> is a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a> and
                  the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> of <i>result</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
                  set the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> of <i>result</i> to the result of
                  resolving <i>value</i> against the current <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
                  of <i>result</i>.</li>
                <li>Otherwise, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-base-IRI">invalid base <abbr title="Internationalized Resource Identifier">IRI</abbr></a></code>
                  error has been detected and processing is aborted.</li>
              </ol>
            </li>
            <li>If <i>context</i> has an <code>@vocab</code> key:
              <ol class="algorithm">
                <li>Initialize <i>value</i> to the value associated with the
                  <code>@vocab</code> key.</li>
                <li>If <i>value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, remove
                  any <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a> from <i>result</i>.</li>
                <li>Otherwise, if <i>value</i> is an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
                  or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, the <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>
                  of <i>result</i> is set to <i>value</i>. If it is not an
                  <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-vocab-mapping">invalid vocab mapping</a></code>
                  error has been detected and processing is aborted.</li>
              </ol>
            </li>
            <li>If <i>context</i> has an <code>@language</code> key:
              <ol class="algorithm">
                <li>Initialize <i>value</i> to the value associated with the
                  <code>@language</code> key.</li>
                <li>If <i>value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, remove
                  any <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a> from <i>result</i>.</li>
                <li>Otherwise, if <i>value</i> is <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, the
                  <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a> of <i>result</i> is set to
                  lowercased <i>value</i>. If it is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-default-language">invalid default language</a></code>
                  error has been detected and processing is aborted.</li>
              </ol>
            </li>
            <li>Create a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>defined</i> to use to keep
              track of whether or not a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> has already been defined
              or currently being defined during recursion.</li>
            <li>For each <i>key</i>-<i>value</i> pair in <i>context</i> where
              <i>key</i> is not <code>@base</code>, <code>@vocab</code>, or
              <code>@language</code>, invoke the
              <a href="#create-term-definition">Create Term Definition algorithm</a>,
              passing <i>result</i> for <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
              <i>context</i> for <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, <i>key</i>,
              and <i>defined</i>.</li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>
    </section>
  </section> <!-- end of Context Processing -->

  <section id="create-term-definition">
    <h3 id="h3_create-term-definition" role="heading" aria-level="2"><span class="secno">6.2 </span>Create Term Definition</h3>

    <p>This algorithm is called from the
      <a href="#context-processing-algorithm">Context Processing algorithm</a>
      to create a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>
      for a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> being processed in a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-1">Overview</h4><p><em>This section is non-normative.</em></p>

      <p><a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">Term definitions</a> are created by
        parsing the information in the given <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> for the
        given <a href="#dfn-term" title="term" class="tref internalDFN">term</a>. If the given <a href="#dfn-term" title="term" class="tref internalDFN">term</a> is a
        <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, it may omit an <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> by
        depending on its <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> having its own
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>. If the <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> is
        a key in the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, then its <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
        must first be created, through recursion, before continuing. Because a
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> can depend on other
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definitions</a>, a mechanism must
        be used to detect cyclical dependencies. The solution employed here
        uses a map, <i>defined</i>, that keeps track of whether or not a
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a> has been defined or is currently in the process of
        being defined. This map is checked before any recursion is attempted.</p>

      <p>After all dependencies for a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> have been defined, the rest of
        the information in the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> for the given
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a> is taken into account, creating the appropriate
        <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>, <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>, and
        <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> for the
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-1">Algorithm</h4>

      <p>The algorithm has four required inputs which are:
        an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>,
        a <i>term</i>, and a map <i>defined</i>.</p>

      <ol class="algorithm">
        <li>If <i>defined</i> contains the key <i>term</i> and the associated
          value is <a href="#dfn-true" title="true" class="tref internalDFN">true</a> (indicating that the
          <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> has already been created), return. Otherwise,
          if the value is <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, a
          <code class="error"><a href="#idl-def-JsonLdErrorCode.cyclic-IRI-mapping">cyclic <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
          error has been detected and processing is aborted.</li>
        <li>Set the value associated with <i>defined</i>'s <i>term</i> key to
          <a href="#dfn-false" title="false" class="tref internalDFN">false</a>. This indicates that the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
          is now being created but is not yet complete.</li>
        <li>Since <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> cannot be overridden,
          <i>term</i> must not be a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>. Otherwise, a
          <code class="error"><a href="#idl-def-JsonLdErrorCode.keyword-redefinition">keyword redefinition</a></code>
          error has been detected and processing is aborted.</li>
        <li>Remove any existing <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> for <i>term</i> in
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>.</li>
        <li>Initialize <i>value</i> to a copy of the value associated with the key
          <i>term</i> in <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>.</li>
        <li>If <i>value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or <i>value</i>
          is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing the key-value pair
          <code>@id</code>-<a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set the
          <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> to
          <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set the value associated with <i>defined</i>'s
          key <i>term</i> to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, and return.</li>
        <li>Otherwise, if <i>value</i> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, convert it
          to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting of a single member whose
          key is <code>@id</code> and whose value is <i>value</i>.</li>
        <li>Otherwise, <i>value</i> must be a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, if not, an
          <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-term-definition">invalid term definition</a></code>
          error has been detected and processing is aborted.</li>
        <li>Create a new <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>, <i>definition</i>.</li>
        <li>If <i>value</i> contains the key <code>@type</code>:
          <ol class="algorithm">
            <li>Initialize <i>type</i> to the value associated with the
              <code>@type</code> key, which must be a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>. Otherwise, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-type-mapping">invalid type mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>Set <i>type</i> to the result of using the
              <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>, passing
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <i>type</i> for <i>value</i>,
              <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>,
              <a href="#dfn-false" title="false" class="tref internalDFN">false</a> for <i>document relative</i>,
              <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, and <i>defined</i>. If the expanded <i>type</i> is
              neither <code>@id</code>, nor <code>@vocab</code>, nor an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-type-mapping">invalid type mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>Set the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> for <i>definition</i> to <i>type</i>.</li>
          </ol>
        </li>
        <li>If <i>value</i> contains the key <code>@reverse</code>:
          <ol class="algorithm">
            <li>If <i>value</i> contains an <code>@id</code>, member, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-reverse-property">invalid reverse property</a></code>
              error has been detected and processing is aborted.</li>
            <li>If the value associated with the <code>@reverse</code> key
              is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>Otherwise, set the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> of <i>definition</i> to the
              result of using the <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>,
              passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, the value associated with
              the <code>@reverse</code> key for <i>value</i>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a>
              for <i>vocab</i>, <a href="#dfn-false" title="false" class="tref internalDFN">false</a> for <i>document relative</i>,
              <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, and <i>defined</i>. If the result
              is neither an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> nor a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>,
              i.e., it contains no colon (<code>:</code>), an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>If <i>value</i> contains an <code>@container</code> member,
              set the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> of <i>definition</i>
              to its value; if its value is neither <code>@set</code>, nor
              <code>@index</code>, nor <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-reverse-property">invalid reverse property</a></code>
              error has been detected (reverse properties only support set- and
              index-containers) and processing is aborted.</li>
            <li>Set the <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a> flag of <i>definition</i>
              to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>.</li>
            <li>Set the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> of <i>term</i> in
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> to <i>definition</i> and the
              value associated with <i>defined</i>'s key <i>term</i> to
              <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and return.</li>
          </ol>
        </li>
        <li>Set the <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a> flag of <i>definition</i>
          to <a href="#dfn-false" title="false" class="tref internalDFN">false</a>.</li>
        <li>If <i>value</i> contains the key <code>@id</code> and its value
          does not equal <i>term</i>:
          <ol class="algorithm">
            <li>If the value associated with the <code>@id</code> key is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>Otherwise, set the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> of <i>definition</i> to the
              result of using the <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>, passing
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, the value associated with the <code>@id</code> key for
              <i>value</i>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>,
              <a href="#dfn-false" title="false" class="tref internalDFN">false</a> for <i>document relative</i>,
              <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, and <i>defined</i>. If the resulting
              <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> is neither a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>, nor an
              <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, nor a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
              error has been detected and processing is aborted; if it equals <code>@context</code>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-keyword-alias">invalid keyword alias</a></code>
              error has been detected and processing is aborted.</li>
          </ol>
        </li>
        <li>
          Otherwise if the <i>term</i> contains a colon (<code>:</code>):
          <ol class="algorithm">
            <li>If <i>term</i> is a <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a> with a
              <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> that is a key in <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>
              a dependency has been found. Use this algorithm recursively passing
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, the
              <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> as <i>term</i>, and <i>defined</i>.</li>
            <li>If <i>term</i>'s <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> has a
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, set
              the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> of <i>definition</i> to the result of
              concatenating the value associated with the <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>'s
              <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> and the <i>term</i>'s <i>suffix</i>.</li>
            <li>Otherwise, <i>term</i> is an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> or
              <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>. Set the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>
              of <i>definition</i> to <i>term</i>.</li>
          </ol>
        </li>
        <li>Otherwise, if <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a
          <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>
          of <i>definition</i> is set to the result of concatenating the value
          associated with the <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a> and <i>term</i>.
          If it does not have a <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, an
          <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid <abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a></code>
          error been detected and processing is aborted.</li>
        <li>If <i>value</i> contains the key <code>@container</code>:
          <ol class="algorithm">
            <li>Initialize <i>container</i> to the value associated with the
              <code>@container</code> key, which must be either
              <code>@list</code>, <code>@set</code>, <code>@index</code>,
              or <code>@language</code>. Otherwise, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-container-mapping">invalid container mapping</a></code> error
              has been detected and processing is aborted.</li>
            <li>Set the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> of <i>definition</i> to
              <i>container</i>.</li>
          </ol>
        </li>
        <li>If <i>value</i> contains the key <code>@language</code> and
          does not contain the key <code>@type</code>:
          <ol class="algorithm">
            <li>Initialize <i>language</i> to the value associated with the
              <code>@language</code> key, which must be either <a href="#dfn-null" title="null" class="tref internalDFN">null</a>
              or a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>. Otherwise, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-language-mapping">invalid language mapping</a></code>
              error has been detected and processing is aborted.</li>
            <li>If <i>language</i> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> set it to
              lowercased <i>language</i>. Set the <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>
              of <i>definition</i> to <i>language</i>.</li>
          </ol>
        </li>
        <li>Set the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> of <i>term</i> in
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> to <i>definition</i> and set the value
          associated with <i>defined</i>'s key <i>term</i> to
          <a href="#dfn-true" title="true" class="tref internalDFN">true</a>.</li>
      </ol>
    </section>
  </section> <!-- end of Term Creation -->

  <section id="iri-expansion">
    <h3 id="h3_iri-expansion" role="heading" aria-level="2"><span class="secno">6.3 </span><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion</h3>

    <p>In JSON-LD documents, some keys and values may represent
      <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a>. This section defines an algorithm for
      transforming a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> that represents an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> into
      an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.
      It also covers transforming <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword aliases</a>
      into <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a>.</p>

    <p><a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> expansion may occur during context processing or during
      any of the other JSON-LD algorithms. If <abbr title="Internationalized Resource Identifier">IRI</abbr> expansion occurs during context
      processing, then the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> and its related <i>defined</i>
      map from the <a href="#context-processing-algorithm">Context Processing algorithm</a>
      are passed to this algorithm. This allows for <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
      dependencies to be processed via the
      <a href="#create-term-definition">Create Term Definition algorithm</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-2">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>In order to expand <i>value</i> to an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, we must
        first determine if it is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, a
        <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword alias</a>, or some form of <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>. Based on what
        we find, we handle the specific kind of expansion; for example, we expand
        a <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword alias</a> to a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> and a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
        to an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> according to its <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>
        in the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. While inspecting <i>value</i> we
        may also find that we need to create <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
        dependencies because we're running this algorithm during context processing.
        We can tell whether or not we're running during context processing by
        checking <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> against <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.
        We know we need to create a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> when <i>value</i> is
        a key in the <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> and the <i>defined</i> map
        does not have a key for <i>value</i> with an associated value of
        <a href="#dfn-true" title="true" class="tref internalDFN">true</a>. The <i>defined</i> map is used during
        <a href="#context-processing-algorithm">Context Processing</a> to keep track of
        which <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> have already been defined or are
        in the process of being defined. We create a
        <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> by using the
        <a href="#create-term-definition">Create Term Definition algorithm</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-2">Algorithm</h4>

      <p>The algorithm takes two required and four optional input variables. The
        required inputs are an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and a <i>value</i>
        to be expanded. The optional inputs are two flags,
        <i>document relative</i> and <i>vocab</i>, that specifying
        whether <i>value</i> can be interpreted as a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        against the document's base <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a>
        <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, respectively, and
        a <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> and a map <i>defined</i> to be used when
        this algorithm is used during <a href="#context-processing-algorithm">Context Processing</a>.
        If not passed, the two flags are set to <code>false</code> and
        <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> and <i>defined</i> are initialized to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</p>

      <ol class="algorithm">
        <li>If <i>value</i> is a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> or <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
          return <i>value</i> as is.</li>
        <li>If <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, it contains
          a key that equals <i>value</i>, and the value associated with the key
          that equals <i>value</i> in <i>defined</i> is not <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
          invoke the <a href="#create-term-definition">Create Term Definition algorithm</a>,
          passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>,
          <i>value</i> as <i>term</i>, and <i>defined</i>. This will ensure that
          a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> is created for <i>value</i> in
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> during <a href="#context-processing-algorithm">Context Processing</a>.
        </li>
        <li>If <i>vocab</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and the
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> for
          <i>value</i>, return the associated <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>.</li>
        <li>If <i>value</i> contains a colon (<code>:</code>), it is either
          an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, a <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, or a
          <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>:
          <ol class="algorithm">
            <li>Split <i>value</i> into a <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> and <i>suffix</i>
              at the first occurrence of a colon (<code>:</code>).</li>
            <li>If <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> is underscore (<code>_</code>)
              or <i>suffix</i> begins with double-forward-slash
              (<code>//</code>), return <i>value</i> as it is already an
              <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> or a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.</li>
            <li>If <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, it
              contains a key that equals <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>, and the value
              associated with the key that equals <i>prefix</i> in <i>defined</i>
              is not <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, invoke the
              <a href="#create-term-definition">Create Term Definition algorithm</a>,
              passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
              <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>, <i>prefix</i> as <i>term</i>,
              and <i>defined</i>. This will ensure that a
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> is created for <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>
              in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> during
              <a href="#context-processing-algorithm">Context Processing</a>.</li>
            <li>If <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> contains a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
              for <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>, return the result of concatenating
              the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> associated with <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a> and
              <i>suffix</i>.</li>
            <li>Return <i>value</i> as it is already an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
          </ol>
        </li>
        <li>If <i>vocab</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, and
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>,
          return the result of concatenating the <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>
          with <i>value</i>.</li>
        <li>Otherwise, if <i>document relative</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
          set <i>value</i> to the result of resolving <i>value</i> against
          the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>. Only the basic algorithm in
          <cite><a href="http://tools.ietf.org/html/rfc3986#section-5.2">section 5.2</a></cite>
          of [<cite><a href="#bib-RFC3986" class="bibref">RFC3986</a></cite>] is used; neither
          <cite><a href="http://tools.ietf.org/html/rfc3986#section-6.2.2">Syntax-Based Normalization</a></cite> nor
          <cite><a href="http://tools.ietf.org/html/rfc3986#section-6.2.3">Scheme-Based Normalization</a></cite>
          are performed. Characters additionally allowed in <abbr title="Internationalized Resource Identifier">IRI</abbr> references are treated
          in the same way that unreserved characters are treated in URI references, per
          <cite><a href="http://tools.ietf.org/html/rfc3987#section-6.5">section 6.5</a></cite>
          of [<cite><a href="#bib-RFC3987" class="bibref">RFC3987</a></cite>].</li>
        <li>Return <i>value</i> as is.</li>
      </ol>
    </section>
  </section> <!-- end of IRI Expansion -->
</section> <!-- end of Context Processing section -->


<section id="expansion-algorithms">
  <!--OddPage--><h2 id="h2_expansion-algorithms" role="heading" aria-level="1"><span class="secno">7. </span>Expansion Algorithms</h2>

  <section id="expansion-algorithm">
    <h3 id="h3_expansion-algorithm" role="heading" aria-level="2"><span class="secno">7.1 </span>Expansion Algorithm</h3>

    <p>This algorithm expands a JSON-LD document, such that all <a href="#dfn-context" title="context" class="tref internalDFN">context</a>
      definitions are removed, all <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> and
      <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a> are expanded to
      <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute IRIs</a>,
      <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>, or
      <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> and all
      <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD values</a> are expressed in
      <a href="#dfn-array" title="array" class="tref internalDFN">arrays</a> in <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-3">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>Starting with its root <i>element</i>, we can process the
        JSON-LD document recursively, until we have a fully
        <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expanded</a> <i>result</i>. When
        <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expanding</a> an <i>element</i>, we can treat
        each one differently according to its type, in order to break down the
        problem:</p>

      <ol>
        <li>If the <i>element</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, there is nothing
          to expand.</li>
        <li>Otherwise, if <i>element</i> is a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a>, we expand it
          according to the <a href="#value-expansion">Value Expansion algorithm</a>.</li>
        <li>Otherwise, if the <i>element</i> is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, then we expand
          each of its items recursively and return them in a new
          <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
        <li>Otherwise, <i>element</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>. We expand
          each of its keys, adding them to our <i>result</i>, and then we expand
          each value for each key recursively. Some of the keys will be
          <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> or
          <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a> and others will be
          <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> or simply ignored because
          they do not have definitions in the <a href="#dfn-context" title="context" class="tref internalDFN">context</a>. Any
          <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> will be expanded using the
          <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>.
        </li>
      </ol>

      <p>Finally, after ensuring <i>result</i> is in an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
        we return <i>result</i>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-3">Algorithm</h4>

      <p>The algorithm takes three input variables: an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
        an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and an <i>element</i> to be expanded.
        To begin, the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
        and <i>element</i> is set to the <a href="#dfn-json-ld-input" title="json-ld-input" class="tref internalDFN">JSON-LD input</a>.</p>

      <ol class="algorithm">
        <li>If <i>element</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, return <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
        <li>If <i>element</i> is a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a>,
          <ol class="algorithm">
            <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or <code>@graph</code>,
              drop the free-floating <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a> by returning <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
            <li>Return the result of the
              <a href="#value-expansion">Value Expansion algorithm</a>, passing the
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and
              <i>element</i> as <i>value</i>.</li>
          </ol>
        </li>
        <li>If <i>element</i> is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
          <ol class="algorithm">
            <li>Initialize an empty array, <i>result</i>.</li>
            <li>For each <i>item</i> in <i>element</i>:
              <ol class="algorithm">
                <li>Initialize <i>expanded item</i> to the result of using this
                  algorithm recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>item</i> as <i>element</i>.</li>
                <li>If the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is <code>@list</code> or its
                  <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> is set to <code>@list</code>, the
                  <i>expanded item</i> must not be an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> or a
                  <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, otherwise a
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.list-of-lists">list of lists</a></code>
                  error has been detected and processing is aborted.</li>
                <li>If <i>expanded item</i> is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, append each
                  of its items to <i>result</i>. Otherwise, if
                  <i>expanded item</i> is not null, append it to <i>result</i>.</li>
              </ol>
            </li>
            <li>Return <i>result</i>.</li>
          </ol>
        </li>
        <li>Otherwise <i>element</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>If <i>element</i> contains the key <code>@context</code>, set
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> to the result of the
          <a href="#context-processing-algorithm">Context Processing algorithm</a>,
          passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and the value of the
          <code>@context</code> key as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>.</li>
        <li>Initialize an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, <i>result</i>.</li>
        <li>For each <i>key</i> and <i>value</i> in <i>element</i>,
          ordered lexicographically by <i>key</i>:
          <ol class="algorithm">
            <li>If <i>key</i> is <code>@context</code>, continue to
              the next <i>key</i>.</li>
            <li>Set <i>expanded property</i> to the result of
              using the <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>,
              passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <i>key</i> for
              <i>value</i>, and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>.</li>
            <li>If <i>expanded property</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or it neither
              contains a colon (<code>:</code>) nor it is a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>,
              drop <i>key</i> by continuing to the next <i>key</i>.</li>
            <li>If <i>expanded property</i> is a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>:
              <ol class="algorithm">
                <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> equals <code>@reverse</code>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-reverse-property-map">invalid reverse property map</a></code>
                  error has been detected and processing is aborted.</li>
                <li>If <i>result</i> has already an <i>expanded property</i> member, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.colliding-keywords">colliding keywords</a></code>
                  error has been detected and processing is aborted.</li>
                <li>If <i>expanded property</i> is <code>@id</code> and
                  <i>value</i> is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid--id-value">invalid @id value</a></code>
                  error has been detected and processing is aborted. Otherwise,
                  set <i>expanded value</i> to the result of using the
                  <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>,
                  passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <i>value</i>, and <a href="#dfn-true" title="true" class="tref internalDFN">true</a>
                  for <i>document relative</i>.</li>
                <li>If <i>expanded property</i> is <code>@type</code> and <i>value</i>
                  is neither a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> nor an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> of
                  <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-type-value">invalid type value</a></code>
                  error has been detected and processing is aborted. Otherwise,
                  set <i>expanded value</i> to the result of using the
                  <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>, passing
                  <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>,
                  and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>document relative</i> to expand the <i>value</i>
                  or each of its items.</li>
                <li>If <i>expanded property</i> is <code>@graph</code>, set
                  <i>expanded value</i> to the result of using this algorithm
                  recursively passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <code>@graph</code>
                  for <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>value</i> for <i>element</i>.</li>
                <li>If <i>expanded property</i> is <code>@value</code> and
                  <i>value</i> is not a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a> or <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-value-object-value">invalid value object value</a></code>
                  error has been detected and processing is aborted. Otherwise,
                  set <i>expanded value</i> to <i>value</i>. If <i>expanded value</i>
                  is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set the <code>@value</code>
                  member of <i>result</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a> and continue with the
                  next <i>key</i> from <i>element</i>. Null values need to be preserved
                  in this case as the meaning of an <code>@type</code> member depends
                  on the existence of an <code>@value</code> member.</li>
                <li>If <i>expanded property</i> is <code>@language</code> and
                  <i>value</i> is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-language-tagged-string">invalid language-tagged string</a></code>
                  error has been detected and processing is aborted. Otherwise,
                  set <i>expanded value</i> to lowercased <i>value</i>.</li>
                <li>If <i>expanded property</i> is <code>@index</code> and
                  <i>value</i> is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid--index-value">invalid @index value</a></code>
                  error has been detected and processing is aborted. Otherwise,
                  set <i>expanded value</i> to <i>value</i>.</li>
                <li>If <i>expanded property</i> is <code>@list</code>:
                  <ol class="algorithm">
                    <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or
                      <code>@graph</code>, continue with the next <i>key</i>
                      from <i>element</i> to remove the free-floating list.</li>
                    <li>Otherwise, initialize <i>expanded value</i> to the result of using
                      this algorithm recursively passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                      <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>value</i> for <i>element</i>.</li>
                    <li>If <i>expanded value</i> is a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, a
                      <code class="error"><a href="#idl-def-JsonLdErrorCode.list-of-lists">list of lists</a></code>
                      error has been detected and processing is aborted.</li>
                  </ol>
                </li>
                <li>If <i>expanded property</i> is <code>@set</code>, set
                  <i>expanded value</i> to the result of using this algorithm
                  recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>value</i> for
                  <i>element</i>.</li>
                <li>If <i>expanded property</i> is <code>@reverse</code> and
                  <i>value</i> is not a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, an
                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid--reverse-value">invalid @reverse value</a></code>
                  error has been detected and processing is aborted. Otherwise
                  <ol class="algorithm">
                    <li>Initialize <i>expanded value</i> to the result of using this
                      algorithm recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                      <code>@reverse</code> as <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and
                      <i>value</i> as <i>element</i>.</li>
                    <li>If <i>expanded value</i> contains an <code>@reverse</code> member,
                      i.e., properties that are reversed twice, execute for each of its
                      <i>property</i> and <i>item</i> the following steps:
                      <ol class="algorithm">
                        <li>If <i>result</i> does not have a <i>property</i> member, create
                          one and set its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                        <li>Append <i>item</i> to the value of the <i>property</i> member
                          of <i>result</i>.</li>
                      </ol>
                    </li>
                    <li>If <i>expanded value</i> contains members other than <code>@reverse</code>:
                      <ol class="algorithm">
                        <li>If <i>result</i> does not have an <code>@reverse</code> member, create
                          one and set its value to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
                        <li>Reference the value of the <code>@reverse</code> member in <i>result</i>
                          using the variable <i>reverse map</i>.</li>
                        <li>For each <i>property</i> and <i>items</i> in <i>expanded value</i>
                          other than <code>@reverse</code>:
                          <ol class="algorithm">
                            <li>For each <i>item</i> in <i>items</i>:
                              <ol class="algorithm">
                                <li>If <i>item</i> is a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> or <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, an
                                  <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid--reverse-value">invalid reverse property value</a></code>
                                  has been detected and processing is aborted.</li>
                                <li>If <i>reverse map</i> has no <i>property</i> member, create one
                                  and initialize its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                                <li>Append <i>item</i> to the value of the <i>property</i>
                                  member in <i>reverse map</i>.</li>
                              </ol>
                            </li>
                          </ol>
                        </li>
                      </ol>
                    </li>
                    <li>Continue with the next <i>key</i> from <i>element</i>.</li>
                  </ol>
                </li>
                <li>Unless <i>expanded value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set
                  the <i>expanded property</i> member of <i>result</i> to
                  <i>expanded value</i>.</li>
                <li>Continue with the next <i>key</i> from <i>element</i>.</li>
              </ol>
            </li>
            <li>Otherwise, if <i>key</i>'s <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> in
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is <code>@language</code> and
              <i>value</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> then <i>value</i>
              is expanded from a <a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#dfn-language-map" title="language-map" class="tref externalDFN">language map</a>
              as follows:
              <ol class="algorithm">
                <li>Initialize <i>expanded value</i> to an empty
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>For each key-value pair <i>language</i>-<i>language value</i>
                  in <i>value</i>, ordered lexicographically by <i>language</i>:
                  <ol class="algorithm">
                    <li>If <i>language value</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                      set it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only
                      <i>language value</i>.</li>
                    <li>For each <i>item</i> in <i>language value</i>:
                      <ol class="algorithm">
                        <li><i>item</i> must be a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>,
                          otherwise an
                          <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-language-map-value">invalid language map value</a></code>
                          error has been detected and processing is aborted.</li>
                        <li>Append a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> to
                          <i>expanded value</i> that consists of two
                          key-value pairs: (<code>@value</code>-<i>item</i>)
                          and (<code>@language</code>-lowercased
                          <i>language</i>).</li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>Otherwise, if <i>key</i>'s <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> in
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is <code>@index</code> and
              <i>value</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> then <i>value</i>
              is expanded from an index map as follows:
              <ol class="algorithm">
                <li>Initialize <i>expanded value</i> to an empty
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>For each key-value pair <i>index</i>-<i>index value</i>
                  in <i>value</i>, ordered lexicographically by <i>index</i>:
                  <ol class="algorithm">
                    <li>If <i>index value</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                      set it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only
                      <i>index value</i>.</li>
                    <li>Initialize <i>index value</i> to the result of
                      using this algorithm recursively, passing
                      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                      <i>key</i> as <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>,
                      and <i>index value</i> as <i>element</i>.</li>
                    <li>For each <i>item</i> in <i>index value</i>:
                      <ol class="algorithm">
                        <li>If <i>item</i> does not have the key
                          <code>@index</code>, add the key-value pair
                          (<code>@index</code>-<i>index</i>) to
                          <i>item</i>.</li>
                        <li>Append <i>item</i> to <i>expanded value</i>.</li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>Otherwise, initialize <i>expanded value</i> to the result of
              using this algorithm recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
              <i>key</i> for <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>value</i>
              for <i>element</i>.</li>
            <li>If <i>expanded value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, ignore <i>key</i>
              by continuing to the next <i>key</i> from <i>element</i>.</li>
            <li>If the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> associated to <i>key</i> in
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is <code>@list</code> and
              <i>expanded value</i> is not already a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>,
              convert <i>expanded value</i> to a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>
              by first setting it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only
              <i>expanded value</i> if it is not already an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
              and then by setting it to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing
              the key-value pair <code>@list</code>-<i>expanded value</i>.</li>
            <li>Otherwise, if the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> associated to
              <i>key</i> indicates that it is a <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a>
              <ol class="algorithm">
                <li>If <i>result</i> has no <code>@reverse</code> member, create
                  one and initialize its value to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
                <li>Reference the value of the <code>@reverse</code> member in <i>result</i>
                  using the variable <i>reverse map</i>.</li>
                <li>If <i>expanded value</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, set
                  it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing <i>expanded value</i>.</li>
                <li>For each <i>item</i> in <i>expanded value</i>
                  <ol class="algorithm">
                    <li>If <i>item</i> is a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> or <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, an
                      <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid--reverse-value">invalid reverse property value</a></code>
                      has been detected and processing is aborted.</li>
                    <li>If <i>reverse map</i> has no <i>expanded property</i> member,
                      create one and initialize its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                    <li>Append <i>item</i> to the value of the <i>expanded property</i>
                      member of <i>reverse map</i>.</li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>Otherwise, if <i>key</i> is not a <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a>:
              <ol class="algorithm">
                <li>If <i>result</i> does not have an <i>expanded property</i>
                  member, create one and initialize its value to an empty
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>Append <i>expanded value</i> to value of the <i>expanded property</i>
                  member of <i>result</i>.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>If <i>result</i> contains the key <code>@value</code>:
          <ol class="algorithm">
            <li>The <i>result</i> must not contain any keys other than
              <code>@value</code>, <code>@language</code>, <code>@type</code>,
              and <code>@index</code>. It must not contain both the
              <code>@language</code> key and the <code>@type</code> key.
              Otherwise, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-value-object">invalid value object</a></code>
              error has been detected and processing is aborted.</li>
            <li>If the value of <i>result</i>'s <code>@value</code> key is
              <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, then set <i>result</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
            <li>Otherwise, if the value of <i>result</i>'s <code>@value</code> member
              is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> and <i>result</i> contains the key
              <code>@language</code>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-language-tagged-value">invalid language-tagged value</a></code>
              error has been detected (only <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>
              can be language-tagged) and processing is aborted.</li>
            <li>Otherwise, if the <i>result</i> has a <code>@type</code> member
              and its value is not an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-typed-value">invalid typed value</a></code>
              error has been detected and processing is aborted.</li>
          </ol>
        </li>
        <li>Otherwise, if <i>result</i> contains the key <code>@type</code>
          and its associated value is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, set it to
          an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only the associated value.</li>
        <li>Otherwise, if <i>result</i> contains the key <code>@set</code>
          or <code>@list</code>:
          <ol class="algorithm">
            <li>The <i>result</i> must contain at most one other key and that
              key must be <code>@index</code>. Otherwise, an
              <code class="error"><a href="#idl-def-JsonLdErrorCode.invalid-set-or-list-object">invalid set or list object</a></code>
              error has been detected and processing is aborted.</li>
            <li>If <i>result</i> contains the key <code>@set</code>, then
              set <i>result</i> to the key's associated value.</li>
          </ol>
        </li>
        <li>If <i>result</i> contains only the key
          <code>@language</code>, set <i>result</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
        <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or <code>@graph</code>,
          drop free-floating values as follows:
          <ol class="algorithm">
            <li>If <i>result</i> is an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> or contains
              the keys <code>@value</code> or <code>@list</code>, set <i>result</i> to
              <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
            <li>Otherwise, if <i>result</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> whose only
              key is <code>@id</code>, set <i>result</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>

      <p>If, after the above algorithm is run, the result is a
        <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> that contains only an <code>@graph</code> key, set the
        result to the value of <code>@graph</code>'s value. Otherwise, if the result
        is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Finally, if
        the result is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, then set the result to an
        <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only the result.</p>
    </section>
  </section> <!-- end of Expansion Algorithm -->


  <section id="value-expansion">
    <h3 id="h3_value-expansion" role="heading" aria-level="2"><span class="secno">7.2 </span>Value Expansion</h3>

    <p>Some values in JSON-LD can be expressed in a
      <a href="#dfn-compacted-form" title="compacted-form" class="tref internalDFN">compact form</a>. These values are required
      to be <a href="#dfn-expansion" title="expansion" class="tref internalDFN">expanded</a> at times when processing
      JSON-LD documents. A value is said to be in <dfn id="dfn-expanded-form" title="expanded-form">expanded form</dfn>
      after the application of this algorithm.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-4">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> in the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> set to <code>@id</code> or <code>@vocab</code>,
        a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with a single member <code>@id</code> whose
        value is the result of using the
        <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a> on <i>value</i>
        is returned.</p>

      <p>Otherwise, the result will be a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing
        an <code>@value</code> member whose value is the passed <i>value</i>.
        Additionally, an <code>@type</code> member will be included if there is a
        <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> associated with the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
        or an <code>@language</code> member if <i>value</i> is a
        <a href="#dfn-string" title="string" class="tref internalDFN">string</a> and there is <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> associated
        with the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-4">Algorithm</h4>

      <p>The algorithm takes three required inputs: an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
        an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and a <i>value</i> to expand.</p>

      <ol class="algorithm">
        <li>If the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>
          in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> that is <code>@id</code>, return a new
          <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing a single key-value pair where the
          key is <code>@id</code> and the value is the result of using the
          <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>, passing
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <i>value</i>, and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for
          <i>document relative</i>.</li>
        <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> in
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> that is <code>@vocab</code>, return
          a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing a single key-value pair
          where the key is <code>@id</code> and the value is the result of
          using the <a href="#iri-expansion"><abbr title="Internationalized Resource Identifier">IRI</abbr> Expansion algorithm</a>, passing
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <i>value</i>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for
          <i>vocab</i>, and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for
          <i>document relative</i>.</li>
        <li>Otherwise, initialize <i>result</i> to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
          with an <code>@value</code> member whose value is set to
          <i>value</i>.</li>
        <li>If <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> in
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, add an <code>@type</code> member to
          <i>result</i> and set its value to the value associated with the
          <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>.</li>
        <li>Otherwise, if <i>value</i> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>:
          <ol class="algorithm">
            <li>If a <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> is associated with
              <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
              add an <code>@language</code> to <i>result</i> and set its
              value to the language code associated with the
              <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>; unless the
              <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> is set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a> in
              which case no member is added.</li>
            <li>Otherwise, if the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a
              <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>, add an <code>@language</code>
              to <i>result</i> and set its value to the
              <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>.</li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>
    </section>
  </section> <!-- end of Value Expansion -->

</section> <!-- end of Expansion section -->


<section id="compaction-algorithms">
  <!--OddPage--><h2 id="h2_compaction-algorithms" role="heading" aria-level="1"><span class="secno">8. </span>Compaction Algorithms</h2>

  <section id="compaction-algorithm">
    <h3 id="h3_compaction-algorithm" role="heading" aria-level="2"><span class="secno">8.1 </span>Compaction Algorithm</h3>

    <p>This algorithm compacts a JSON-LD document, such that the given
      <a href="#dfn-context" title="context" class="tref internalDFN">context</a> is applied. This must result in shortening
      any applicable <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> to
      <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> or
      <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a>, any applicable
      <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> to
      <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword aliases</a>, and
      any applicable <a href="#dfn-json-ld-value" title="json-ld-value" class="tref internalDFN">JSON-LD values</a>
      expressed in <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a> to simple values such as
      <a href="#dfn-string" title="string" class="tref internalDFN">strings</a> or
      <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-5">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>Starting with its root <i>element</i>, we can process the
        JSON-LD document recursively, until we have a fully
        <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compacted</a> <i>result</i>. When
        <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compacting</a> an <i>element</i>, we can treat
        each one differently according to its type, in order to break down the
        problem:</p>

      <ol>
        <li>If the <i>element</i> is a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a>, it is
          already in <a href="#dfn-compacted-form" title="compacted-form" class="tref internalDFN">compacted form</a>, so we simply return it.</li>
        <li>If the <i>element</i> is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, we compact
          each of its items recursively and return them in a new
          <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
        <li>Otherwise <i>element</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>. The value
          of each key in element is compacted recursively. Some of the keys will be
          compacted, using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
          to <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> or <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a>
          and others will be compacted from <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> to
          <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword aliases</a> or simply left
          unchanged because they do not have definitions in the <a href="#dfn-context" title="context" class="tref internalDFN">context</a>.
          Values will be converted to <a href="#dfn-compacted-form" title="compacted-form" class="tref internalDFN">compacted form</a> via the
          <a href="#value-compaction">Value Compaction algorithm</a>. Some data
          will be reshaped based on <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>
          specified in the context such as <code>@index</code> or <code>@language</code>
          maps.</li>
      </ol>

      <p>The final output is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with a <code>@context</code>
        key, if a non-empty <a href="#dfn-context" title="context" class="tref internalDFN">context</a> was given, where the <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
        is either <i>result</i> or a wrapper for it where <i>result</i> appears
        as the value of an (aliased) <code>@graph</code> key because <i>result</i>
        contained two or more items in an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-5">Algorithm</h4>

      <p>The algorithm takes five required input variables: an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
        an <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, an
        <i>element</i> to be compacted, and a flag
        <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>.
        To begin, the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is set to the result of
        performing <a href="#context-processing-algorithm">Context Processing</a>
        on the passed <a href="#dfn-context" title="context" class="tref internalDFN">context</a>, the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> is
        set to the result of performing the
        <a href="#inverse-context-creation">Inverse Context Creation algorithm</a>
        on <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is
        set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, <i>element</i> is set to the result of
        performing the <a href="#expansion-algorithm">Expansion algorithm</a>
        on the <a href="#dfn-json-ld-input" title="json-ld-input" class="tref internalDFN">JSON-LD input</a>, and, if not passed,
        <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
        is set to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>.</p>

      <ol class="algorithm">
        <li>If <i>element</i> is a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a>, it is already in its most
          compact form, so simply return <i>element</i>.</li>
        <li>If <i>element</i> is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>:
          <ol class="algorithm">
            <li>Initialize <i>result</i> to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
            <li>For each <i>item</i> in <i>element</i>:
              <ol class="algorithm">
                <li>Initialize <i>compacted item</i> to the result of using this
                  algorithm recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and
                  <em>item</em> for <i>element</i>.</li>
                <li>If <i>compacted item</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, then append
                  it to <i>result</i>.</li>
              </ol>
            </li>
            <li>If <i>result</i> contains only one item (it has a length of
              <code>1</code>), <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has no
              <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, and
              <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
              is <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, set <i>result</i> to its only item.</li>
            <li>Return <i>result</i>.</li>
          </ol>
        </li>
        <li>Otherwise <i>element</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>If <i>element</i> has an <code>@value</code> or <code>@id</code>
          member and the result of using the
          <a href="#value-compaction">Value Compaction algorithm</a>,
          passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
          <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>,and <i>element</i> as <i>value</i> is
          a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a>, return that result.</li>
        <li>Initialize <i>inside reverse</i> to <a href="#dfn-true" title="true" class="tref internalDFN">true</a> if
          <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> equals <code>@reverse</code>,
          otherwise to <a href="#dfn-false" title="false" class="tref internalDFN">false</a>.</li>
        <li>Initialize <i>result</i> to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>For each key <i>expanded property</i> and value <i>expanded value</i>
          in <i>element</i>,  ordered lexicographically by <i>expanded property</i>:
          <ol class="algorithm">
            <li>If <i>expanded property</i> is <code>@id</code> or
              <code>@type</code>:
                <ol class="algorithm">
                  <li>If <i>expanded value</i> is a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>,
                    then initialize <i>compacted value</i> to the result
                    of using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                    passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                    <i>expanded value</i> for <i>iri</i>,
                    and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i> if
                    <i>expanded property</i> is <code>@type</code>,
                    <a href="#dfn-false" title="false" class="tref internalDFN">false</a> otherwise.</li>
                  <li>Otherwise, <i>expanded value</i> must be a
                    <code>@type</code> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>:
                    <ol class="algorithm">
                      <li>Initialize <i>compacted value</i> to an empty
                        <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                      <li>For each item <i>expanded type</i> in
                        <i>expanded value</i>, append the result of
                        of using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                        passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                        <i>expanded type</i> for <i>iri</i>, and
                        <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>,
                        to <i>compacted value</i>.</li>
                      <li>If <i>compacted value</i> contains only one
                        item (it has a length of <code>1</code>), then
                        set <i>compacted value</i> to its only item.</li>
                    </ol>
                  </li>
                  <li>Initialize <i>alias</i> to the result of using the
                    <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                    passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                    <i>expanded property</i> for <i>iri</i>,
                    and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>.</li>
                  <li>Add a member <i>alias</i> to <i>result</i> whose value is
                    set to <i>compacted value</i> and continue to the next
                    <i>expanded property</i>.</li>
                </ol>
              </li>
            <li>If <i>expanded property</i> is <code>@reverse</code>:
              <ol class="algorithm">
                <li>Initialize <i>compacted value</i> to the result of using this
                  algorithm recursively, passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, <code>@reverse</code> for
                  <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>expanded value</i>
                  for <i>element</i>.</li>
                <li>For each <i>property</i> and <i>value</i> in <i>compacted value</i>:
                  <ol class="algorithm">
                    <li>If the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> for <i>property</i> in the
                      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> indicates that <i>property</i> is
                      a <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a>
                      <ol class="algorithm">
                        <li>If the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> for <i>property</i> in
                          the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a
                          <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> of <code>@set</code> or
                          <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
                          is <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, and <i>value</i> is not an
                          <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, set <i>value</i> to a new
                          <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only <i>value</i>.</li>
                        <li>If <i>property</i> is not a member of
                          <i>result</i>, add one and set its value to <i>value</i>.</li>
                        <li>Otherwise, if the value of the <i>property</i> member of
                          <i>result</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, set it to a new
                          <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only the value. Then
                          append <i>value</i> to its value if <i>value</i>
                          is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, otherwise append each
                          of its items.</li>
                        <li>Remove the <i>property</i> member from
                          <i>compacted value</i>.</li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>If <i>compacted value</i> has some remaining members, i.e.,
                  it is not an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>:
                  <ol class="algorithm">
                    <li>Initialize <i>alias</i> to the result of using the
                      <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                      passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                      <code>@reverse</code> for <i>iri</i>,
                      and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>.</li>
                    <li>Set the value of the <i>alias</i> member of <i>result</i> to
                      <i>compacted value</i>.</li>
                  </ol>
                </li>
                <li>Continue with the next <i>expanded property</i> from <i>element</i>.</li>
              </ol>
            </li>
            <li>If <i>expanded property</i> is <code>@index</code> and
              <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>
              in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> that is <code>@index</code>,
              then the compacted result will be inside of an <code>@index</code>
              container, drop the <code>@index</code> property by continuing
              to the next <i>expanded property</i>.</li>
            <li>Otherwise, if <i>expanded property</i> is <code>@index</code>,
              <code>@value</code>, or <code>@language</code>:
              <ol class="algorithm">
                <li>Initialize <i>alias</i> to the result of using
                  the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                  passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                  <i>expanded property</i> for <i>iri</i>,
                  and <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>.</li>
                <li>Add a member <i>alias</i> to <i>result</i> whose value is
                  set to <i>expanded value</i> and continue with the next
                  <i>expanded property</i>.</li>
              </ol>
            </li>
            <li>If <i>expanded value</i> is an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>:
              <ol class="algorithm">
                <li>Initialize <i>item active property</i> to the result of
                  using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                  passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                  <i>expanded property</i> for <i>iri</i>,
                  <i>expanded value</i> for <i>value</i>,
                  <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>, and
                  <i>inside reverse</i>.</li>
                <li>If <i>result</i> does not have the key that equals
                  <i>item active property</i>, set this key's value in
                  <i>result</i> to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Otherwise, if
                  the key's value is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, then set it
                  to one containing only the value.</li>
              </ol>
            </li>
            <li>
              At this point, <i>expanded value</i> must be an
              <a href="#dfn-array" title="array" class="tref internalDFN">array</a> due to the
              <a href="#expansion-algorithm">Expansion algorithm</a>.
              For each item <i>expanded item</i> in <i>expanded value</i>:
              <ol class="algorithm">
                <li>Initialize <i>item active property</i> to the result of using
                  the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                  passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                  <i>expanded property</i> for <i>iri</i>,
                  <i>expanded item</i> for <i>value</i>,
                  <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>, and
                  <i>inside reverse</i>.</li>
                <li>Initialize <i>container</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If there
                  is a <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> for
                  <i>item active property</i> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
                  set <i>container</i> to its value.</li>
                <li>Initialize <i>compacted item</i> to the result of using
                  this algorithm recursively, passing
                  <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                  <i>item active property</i> for <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>,
                  <i>expanded item</i> for <i>element</i> if it does
                  not contain the key <code>@list</code>, otherwise pass
                  the key's associated value for <i>element</i>.</li>
                <li>
                  If <i>expanded item</i> is a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>:
                  <ol class="algorithm">
                    <li>If <i>compacted item</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
                      then set it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only
                      <i>compacted item</i>.</li>
                    <li>If <i>container</i> is not <code>@list</code>:
                      <ol class="algorithm">
                        <li>Convert <i>compacted item</i> to a
                          <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a> by setting it to a
                          <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> containing key-value pair
                          where the key is the result of the
                          <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                          passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                          <code>@list</code> for <i>iri</i>, and <i>compacted item</i>
                          for <i>value</i>.</li>
                        <li>If <i>expanded item</i> contains the key
                          <code>@index</code>, then add a key-value pair
                          to <i>compacted item</i> where the key is the
                          result of the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
                          passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                          <code>@index</code> as <i>iri</i>, and the value associated with the
                          <code>@index</code> key in <i>expanded item</i> as <i>value</i>.</li>
                      </ol>
                    </li>
                    <li>Otherwise, <i>item active property</i> must not be a key
                      in <i>result</i> because there cannot be two
                      <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list objects</a> associated
                      with an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> that has a
                      <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>; a
                      <code class="error"><a href="#idl-def-JsonLdErrorCode.compaction-to-list-of-lists">compaction to list of lists</a></code>
                      error has been detected and processing is aborted.</li>
                  </ol>
                </li>
                <li>
                  If <i>container</i> is <code>@language</code> or
                  <code>@index</code>:
                  <ol class="algorithm">
                    <li>If <i>item active property</i> is not a key in
                      <i>result</i>, initialize it to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.
                      Initialize <i>map object</i> to the value of <i>item active property</i>
                      in <i>result</i>.</li>
                    <li>If <i>container</i> is <code>@language</code> and
                      <i>compacted item</i> contains the key
                      <code>@value</code>, then set <i>compacted item</i>
                      to the value associated with its <code>@value</code> key.</li>
                    <li>Initialize <i>map key</i> to the value associated with
                      with the key that equals <i>container</i> in
                      <i>expanded item</i>.</li>
                    <li>If <i>map key</i> is not a key in <i>map object</i>,
                      then set this key's value in <i>map object</i>
                      to <i>compacted item</i>. Otherwise, if the value
                      is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, then set it to one
                      containing only the value and then append
                      <i>compacted item</i> to it.</li>
                  </ol>
                </li>
                <li>
                  Otherwise,
                  <ol class="algorithm">
                    <li>If
                      <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
                      is <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, <i>container</i> is <code>@set</code> or
                      <code>@list</code>, or <i>expanded property</i> is
                      <code>@list</code> or <code>@graph</code> and
                      <i>compacted item</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
                      set it to a new <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                      containing only <i>compacted item</i>.</li>
                    <li>If <i>item active property</i> is not a key in
                      <i>result</i> then add the key-value pair,
                      (<i>item active property</i>-<i>compacted item</i>),
                      to <i>result</i>.</li>
                    <li>Otherwise, if the value associated with the key that
                      equals <i>item active property</i> in <i>result</i>
                      is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, set it to a new
                      <a href="#dfn-array" title="array" class="tref internalDFN">array</a> containing only the value. Then
                      append <i>compacted item</i> to the value if
                      <i>compacted item</i> is not an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>,
                      otherwise, concatenate it.</li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>

      <p>If, after the algorithm outlined above is run, the result <i>result</i>
        is an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>, replace it with a new
        <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with a single member whose key is the result
        of using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
        passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, and
        <code>@graph</code> as <i>iri</i> and whose value is the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
        <i>result</i>. Finally, if a non-empty <i>context</i> has been passed,
        add an <code>@context</code> member to <i>result</i> and set its value
        to the passed <i>context</i>.</p>
    </section>
  </section> <!-- end of Compaction -->

  <section id="inverse-context-creation">
    <h3 id="h3_inverse-context-creation" role="heading" aria-level="2"><span class="secno">8.2 </span>Inverse Context Creation</h3>

    <p>When there is more than one <a href="#dfn-term" title="term" class="tref internalDFN">term</a> that could be chosen
      to compact an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, it has to be ensured that the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
      selection is both deterministic and represents the most context-appropriate
      choice whilst taking into consideration algorithmic complexity.</p>

    <p>In order to make <a href="#dfn-term" title="term" class="tref internalDFN">term</a> selections, the concept of an
      <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> is introduced. An <dfn id="dfn-inverse-context" title="inverse-context">inverse context</dfn>
      is essentially a reverse lookup table that maps
      <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>,
      <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mappings</a>, and
      <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mappings</a> to a simple
      <a href="#dfn-term" title="term" class="tref internalDFN">term</a> for a given <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. A
      <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> only needs to be generated for an
      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> if it is being used for <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compaction</a>.</p>

    <p>To make use of an <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, a list of preferred
      <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a> and the
      <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> are gathered
      for a particular value associated with an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>. These parameters
      are then fed to the <a href="#term-selection">Term Selection algorithm</a>,
      which will find the <a href="#dfn-term" title="term" class="tref internalDFN">term</a> that most appropriately
      matches the value's mappings.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-6">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>To create an <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> for a given
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, each <a href="#dfn-term" title="term" class="tref internalDFN">term</a> in the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is visited, ordered by length, shortest
        first (ties are broken by choosing the lexicographically least
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a>). For each <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, an entry is added to
        the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> for each possible combination of
        <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> and <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>
        or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> that would legally match the
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a>. Illegal matches include differences between a
        value's <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> and
        that of the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>. If a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> has no
        <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>, <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>, or
        <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> (or some combination of these), then it
        will have an entry in the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> using the special
        key <code>@none</code>. This allows the
        <a href="#term-selection">Term Selection algorithm</a> to fall back
        to choosing more generic <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> when a more
        specifically-matching <a href="#dfn-term" title="term" class="tref internalDFN">term</a> is not available for a particular
        <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> and value combination.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-6">Algorithm</h4>

      <p>The algorithm takes one required input: the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> that
        the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> is being created for.</p>

      <ol class="algorithm">
        <li>Initialize <i>result</i> to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>Initialize <i>default language</i> to <code>@none</code>. If the
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>,
          set <i>default language</i> to it.</li>
        <li>For each key <a href="#dfn-term" title="term" class="tref internalDFN">term</a> and value <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in
          the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, ordered by shortest <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
          first (breaking ties by choosing the lexicographically least
          <a href="#dfn-term" title="term" class="tref internalDFN">term</a>):
          <ol class="algorithm">
            <li>If the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
              <a href="#dfn-term" title="term" class="tref internalDFN">term</a> cannot be selected during <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compaction</a>,
              so continue to the next <a href="#dfn-term" title="term" class="tref internalDFN">term</a>.</li>
            <li>Initialize <i>container</i> to <code>@none</code>. If there
              is a <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> in
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>, set <i>container</i> to
              its associated value.</li>
            <li>Initialize <i>iri</i> to the value of the <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>
              for the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>.</li>
            <li>If <i>iri</i> is not a key in <i>result</i>, add
              a key-value pair where the key is <i>iri</i> and the value
              is an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> to <i>result</i>.</li>
            <li>Reference the value associated with the <i>iri</i> member in
              <i>result</i> using the variable <i>container map</i>.</li>
            <li>If <i>container map</i> has no <i>container</i> member,
              create one and set its value to a new
              <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with two members. The first member is
              <code>@language</code> and its value is a new empty
              <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, the second member is <code>@type</code>
              and its value is a new empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
            <li>Reference the value associated with the <i>container</i> member
              in <i>container map</i> using the variable <i>type/language map</i>.</li>
            <li>If the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> indicates that the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
              represents a <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a>:
              <ol class="algorithm">
                <li>Reference the value associated with the <code>@type</code>
                  member in <i>type/language map</i> using the variable
                  <i>type map</i>.</li>
                <li>If <i>type map</i> does not have a <code>@reverse</code>
                  member, create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
              </ol>
            </li>
            <li>Otherwise, if <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> has a
              <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>:
              <ol class="algorithm">
                <li>Reference the value associated with the <code>@type</code>
                  member in <i>type/language map</i> using the variable
                  <i>type map</i>.</li>
                <li>If <i>type map</i> does not have a member corresponding
                  to the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> in <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>,
                  create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
              </ol>
            </li>
            <li>Otherwise, if <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> has a
              <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> (might be <a href="#dfn-null" title="null" class="tref internalDFN">null</a>):
              <ol class="algorithm">
                <li>Reference the value associated with the <code>@language</code>
                  member in <i>type/language map</i> using the variable
                  <i>language map</i>.</li>
                <li>If the <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> equals <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
                  set <i>language</i> to <code>@null</code>; otherwise set it
                  to the language code in <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>.</li>
                <li>If <i>language map</i> does not have a <i>language</i> member,
                  create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
              </ol>
            </li>
            <li>Otherwise:
              <ol class="algorithm">
                <li>Reference the value associated with the <code>@language</code>
                  member in <i>type/language map</i> using the variable
                  <i>language map</i>.</li>
                <li>If <i>language map</i> does not have a <i>default language</i>
                  member, create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
                <li>If <i>language map</i> does not have a <code>@none</code>
                  member, create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
                <li>Reference the value associated with the <code>@type</code>
                  member in <i>type/language map</i> using the variable
                  <i>type map</i>.</li>
                <li>If <i>type map</i> does not have a <code>@none</code>
                  member, create one and set its value to the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
                  being processed.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>
    </section>
  </section> <!-- end of Inverse Context Creation -->

  <section id="iri-compaction">
    <h3 id="h3_iri-compaction" role="heading" aria-level="2"><span class="secno">8.3 </span><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction</h3>

    <p>This algorithm compacts an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> to a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> or
      <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, or a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> to a
      <a href="#dfn-keyword-alias" title="keyword-alias" class="tref internalDFN">keyword alias</a>. A value that is associated with the
      <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> may be passed in order to assist in selecting the most
      context-appropriate <a href="#dfn-term" title="term" class="tref internalDFN">term</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-7">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>If the passed <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, we simply
        return <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. Otherwise, we first try to find a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
        that the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> can be compacted to if
        it is relative to <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a>
        <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>. In order to select the most appropriate
        <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, we may have to collect information about the passed
        <i>value</i>. This information includes which
        <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>
        would be preferred for expressing the <i>value</i>, and what its
        <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> is. For
        <a href="#dfn-list-object" title="list-object" class="tref internalDFN">JSON-LD lists</a>, the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>
        or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> will be chosen based on the most
        specific values that work for all items in the list. Once this
        information is gathered, it is passed to the
        <a href="#term-selection">Term Selection algorithm</a>, which will
        return the most appropriate <a href="#dfn-term" title="term" class="tref internalDFN">term</a> to use.</p>

      <p>If no <a href="#dfn-term" title="term" class="tref internalDFN">term</a> was found that could be used to compact the
        <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, an attempt is made to compact the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> using the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a> <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>,
        if there is one. If the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> could not be compacted, an
        attempt is made to find a <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>. If there is no
        appropriate <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> is
        transformed to a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a> using the document's
        <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>. Finally, if the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or
        <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> still could not be compacted, it is returned
        as is.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-7">Algorithm</h4>

      <p>This algorithm takes three required inputs and three optional inputs.
        The required inputs are an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, an <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
        and the <i>iri</i> to be compacted. The optional inputs are a <i>value</i> associated
        with the <i>iri</i>, a <i>vocab</i> flag which specifies whether the
        passed <i>iri</i> should be compacted using the
        <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a>
        <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>, and a <i>reverse</i> flag which specifies whether
        a <a href="#dfn-reverse-property" title="reverse-property" class="tref internalDFN">reverse property</a> is being compacted. If not passed, <i>value</i> is set to
        <a href="#dfn-null" title="null" class="tref internalDFN">null</a> and <i>vocab</i> and <i>reverse</i> are both set to
        <code>false</code>.</p>

      <ol class="algorithm">
        <li>If <i>iri</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, return <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
        <li>If <i>vocab</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and <i>iri</i> is a
          key in <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>:
          <ol class="algorithm">
            <li>Initialize <i>default language</i> to
              <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a>
              <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>, if it has one, otherwise to
              <code>@none</code>.</li>
            <li>Initialize <i>containers</i> to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. This
              <a href="#dfn-array" title="array" class="tref internalDFN">array</a> will be used to keep track of an ordered list of
              preferred <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>
              for a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, based on what is compatible with
              <i>value</i>.</li>
            <li>Initialize <i>type/language</i> to <code>@language</code>,
              and <i>type/language value</i> to <code>@null</code>. These two
              variables will keep track of the preferred
              <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> for
              a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, based on what is compatible with <i>value</i>.</li>
            <li>If <i>value</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> that contains the
              key <code>@index</code>, then append the value <code>@index</code>
              to <i>containers</i>.</li>
            <li>If <i>reverse</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, set <i>type/language</i>
              to <code>@type</code>, <i>type/language value</i> to
              <code>@reverse</code>, and append <code>@set</code> to <i>containers</i>.</li>
            <li>Otherwise, if <i>value</i> is a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, then set
              <i>type/language</i> and <i>type/language value</i>
              to the most specific values that work for all items in
              the list as follows:
              <ol class="algorithm">
                <li>If <code>@index</code> is a not key in <i>value</i>, then
                  append <code>@list</code> to <i>containers</i>.</li>
                <li>Initialize <i>list</i> to the <a href="#dfn-array" title="array" class="tref internalDFN">array</a> associated
                  with the key <code>@list</code> in <i>value</i>.</li>
                <li>Initialize <i>common type</i> and <i>common language</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If
                  <i>list</i> is empty, set <i>common language</i> to
                  <i>default language</i>.</li>
                <li>For each <i>item</i> in <i>list</i>:
                  <ol class="algorithm">
                    <li>Initialize <i>item language</i> to <code>@none</code> and
                      <i>item type</i> to <code>@none</code>.</li>
                    <li>If <i>item</i> contains the key <code>@value</code>:
                      <ol class="algorithm">
                        <li>If <i>item</i> contains the key <code>@language</code>,
                          then set <i>item language</i> to its associated
                          value.</li>
                        <li>Otherwise, if <i>item</i> contains the key
                          <code>@type</code>, set <i>item type</i> to its
                          associated value.</li>
                        <li>Otherwise, set <i>item language</i> to
                          <code>@null</code>.</li>
                      </ol>
                    </li>
                    <li>Otherwise, set <i>item type</i> to <code>@id</code>.</li>
                    <li>If <i>common language</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it
                      to <i>item language</i>.</li>
                    <li>Otherwise, if <i>item language</i> does not equal
                      <i>common language</i> and <i>item</i> contains the
                      key <code>@value</code>, then set <i>common language</i>
                      to <code>@none</code> because list items have conflicting
                      languages.</li>
                    <li>If <i>common type</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it
                      to <i>item type</i>.</li>
                    <li>Otherwise, if <i>item type</i> does not equal
                      <i>common type</i>, then set <i>common type</i>
                      to <code>@none</code> because list items have conflicting
                      types.</li>
                    <li>If <i>common language</i> is <code>@none</code> and
                      <i>common type</i> is <code>@none</code>, then
                      stop processing items in the list because it has been
                      detected that there is no common language or type amongst
                      the items.</li>
                  </ol>
                </li>
                <li>If <i>common language</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
                  <code>@none</code>.</li>
                <li>If <i>common type</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
                  <code>@none</code>.</li>
                <li>If <i>common type</i> is not <code>@none</code> then set
                  <i>type/language</i> to <code>@type</code> and
                  <i>type/language value</i> to <i>common type</i>.</li>
                <li>Otherwise, set <i>type/language value</i> to
                  <i>common language</i>.</li>
              </ol>
            </li>
            <li>Otherwise:
              <ol class="algorithm">
                <li>If <i>value</i> is a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a>:
                  <ol class="algorithm">
                    <li>If <i>value</i> contains the key <code>@language</code>
                      and does not contain the key <code>@index</code>,
                      then set <i>type/language value</i> to its associated
                      value and append <code>@language</code> to
                      <i>containers</i>.</li>
                    <li>Otherwise, if <i>value</i> contains the key
                      <code>@type</code>, then set <i>type/language value</i> to
                      its associated value and set <i>type/language</i> to
                      <code>@type</code>.</li>
                  </ol>
                </li>
                <li>Otherwise, set <i>type/language</i> to <code>@type</code>
                  and set <i>type/language value</i> to <code>@id</code>.</li>
                <li>Append <code>@set</code> to <i>containers</i>.</li>
              </ol>
            </li>
            <li>Append <code>@none</code> to <i>containers</i>. This represents
              the non-existence of a <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>, and it will
              be the last <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> value to be checked as it
              is the most generic.</li>
            <li>If <i>type/language value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
              <code>@null</code>. This is the key under which <a href="#dfn-null" title="null" class="tref internalDFN">null</a> values
              are stored in the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> <i>entry</i>.</li>
            <li>Initialize <i>preferred values</i> to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.
              This <a href="#dfn-array" title="array" class="tref internalDFN">array</a> will indicate, in order, the preferred values for
              a <a href="#dfn-term" title="term" class="tref internalDFN">term's</a> <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or
              <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>.</li>
            <li>If <i>type/language value</i> is <code>@reverse</code>, append
              <code>@reverse</code> to <i>preferred values</i>.</li>
            <li>If <i>type/language value</i> is <code>@id</code> or <code>@reverse</code>
              and <i>value</i> has an <code>@id</code> member:
              <ol class="algorithm">
                <li>If the result of using the
                  <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> compaction algorithm</a>,
                  passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
                  the value associated with the <code>@id</code> key in <i>value</i> for
                  <i>iri</i>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>, and
                  <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>document relative</i> has a
                  <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>
                  with an <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> that equals the value associated
                  with the <code>@id</code> key in <i>value</i>,
                  then append <code>@vocab</code>, <code>@id</code>, and
                  <code>@none</code>, in that order, to <i>preferred values</i>.</li>
                <li>Otherwise, append <code>@id</code>, <code>@vocab</code>, and
                  <code>@none</code>, in that order, to <i>preferred values</i>.</li>
              </ol>
            </li>
            <li>Otherwise, append <i>type/language value</i> and <code>@none</code>, in
              that order, to <i>preferred values</i>.</li>
            <li>Initialize <i>term</i> to the result of the
              <a href="#term-selection">Term Selection algorithm</a>, passing
              <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, <i>iri</i>, <i>containers</i>,
              <i>type/language</i>, and <i>preferred values</i>.</li>
            <li>If <i>term</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, return <i>term</i>.</li>
          </ol>
        </li>
        <li>At this point, there is no simple <a href="#dfn-term" title="term" class="tref internalDFN">term</a> that <i>iri</i>
          can be compacted to. If <i>vocab</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has a <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>:
          <ol class="algorithm">
            <li>If <i>iri</i> begins with the
              <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping's</a> value
              but is longer, then initialize <i>suffix</i> to the substring
              of <i>iri</i> that does not match. If <i>suffix</i> does not
              have a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>,
              then return <i>suffix</i>.</li>
          </ol>
        </li>
        <li>The <i>iri</i> could not be compacted using the
          <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a> <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a>.
          Try to create a <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, starting by initializing
          <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. This variable will be used to
          tore the created <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, if any.</li>
        <li>For each key <a href="#dfn-term" title="term" class="tref internalDFN">term</a> and value <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in
          the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>:
          <ol class="algorithm">
            <li>If the <a href="#dfn-term" title="term" class="tref internalDFN">term</a> contains a colon (<code>:</code>),
              then continue to the next <a href="#dfn-term" title="term" class="tref internalDFN">term</a> because
              <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> with colons can't be
              used as <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefixes</a>.</li>
            <li>If the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
              its <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> equals <i>iri</i>, or its
              <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a> is not a substring at the beginning of
              <i>iri</i>, the <a href="#dfn-term" title="term" class="tref internalDFN">term</a> cannot be used as a <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefix</a>
              because it is not a partial match with <i>iri</i>.
              Continue with the next <a href="#dfn-term" title="term" class="tref internalDFN">term</a>.</li>
            <li>Initialize <i>candidate</i> by concatenating <a href="#dfn-term" title="term" class="tref internalDFN">term</a>,
              a colon (<code>:</code>), and the substring of <i>iri</i>
              that follows after the value of the
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition's</a>
              <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>.</li>
            <li>If either <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a> or <i>candidate</i> is
              shorter or the same length but lexicographically less than
              <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i> and <i>candidate</i> does not have a
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> or if the
              <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> has an <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>
              that equals <i>iri</i> and <i>value</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
              set <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i> to <i>candidate</i>.</li>
          </ol>
        </li>
        <li>If <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, return <i>compact <abbr title="Internationalized Resource Identifier">IRI</abbr></i>.</li>
        <li>If <i>vocab</i> is <a href="#dfn-false" title="false" class="tref internalDFN">false</a> then
          transform <i>iri</i> to a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a> using
          the document's base <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
        <li>Finally, return <i>iri</i> as is.</li>
      </ol>
    </section>
  </section> <!-- end of IRI Compaction -->

  <section id="term-selection">
    <h3 id="h3_term-selection" role="heading" aria-level="2"><span class="secno">8.4 </span>Term Selection</h3>

    <p>This algorithm, invoked via the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>,
      makes use of an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context's</a>
      <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a> to find the <a href="#dfn-term" title="term" class="tref internalDFN">term</a> that is best
      used to <a href="#dfn-compaction" title="compaction" class="tref internalDFN">compact</a> an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>. Other
      information about a value associated with the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> is given,
      including which <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>
      and which <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> would
      be best used to express the value.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-8">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>The <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context's</a> entry for
        the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> will be first searched according to the preferred
        <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>, in the order
        that they are given. Amongst <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> with a matching
        <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>, preference will be given to those
        with a matching <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>,
        over those without a <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or
        <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>. If there is no <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
        with a matching <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> then the <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
        without a <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> that matches the given
        <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> is selected. If
        there is still no selected <a href="#dfn-term" title="term" class="tref internalDFN">term</a>, then a <a href="#dfn-term" title="term" class="tref internalDFN">term</a>
        with no <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> will
        be selected if available. No <a href="#dfn-term" title="term" class="tref internalDFN">term</a> will be selected that
        has a conflicting <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>.
        Ties between <a href="#dfn-term" title="term" class="tref internalDFN">terms</a> that have the same
        mappings are resolved by first choosing the shortest terms, and then by
        choosing the lexicographically least term. Note that these ties are
        resolved automatically because they were previously resolved when the
        <a href="#inverse-context-creation">Inverse Context Creation algorithm</a>
        was used to create the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-8">Algorithm</h4>

      <p>This algorithm has five required inputs. They are:
        an <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>, a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> or <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        <i>iri</i>, an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>containers</i> that represents an
        ordered list of preferred <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mappings</a>,
        a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> <i>type/language</i> that indicates whether
        to look for a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> with a matching <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>
        or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>, and an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> representing
        an ordered list of <i>preferred values</i> for the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a>
        or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> to look for.</p>

      <ol class="algorithm">
        <li>Initialize <i>container map</i> to the value associated with
          <i>iri</i> in the <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>.</li>
        <li>For each item <i>container</i> in <i>containers</i>:
          <ol class="algorithm">
            <li>If <i>container</i> is not a key in <i>container map</i>, then
              there is no <a href="#dfn-term" title="term" class="tref internalDFN">term</a> with a matching
              <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> for it, so continue to the next
              <i>container</i>.</li>
            <li>Initialize <i>type/language map</i> to the value associated
              with the <i>container</i> member in <i>container map</i>.</li>
            <li>Initialize <i>value map</i> to the value associated
              with <i>type/language</i> member in <i>type/language map</i>.</li>
            <li>For each <i>item</i> in <i>preferred values</i>:
              <ol class="algorithm">
                <li>If <i>item</i> is not a key in <i>value map</i>,
                  then there is no <a href="#dfn-term" title="term" class="tref internalDFN">term</a> with a matching
                  <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a>,
                  so continue to the next <i>item</i>.</li>
                <li>Otherwise, a matching term has been found, return the value
                  associated with the <i>item</i> member in
                  <i>value map</i>.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>No matching term has been found. Return <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
      </ol>
    </section>
  </section> <!-- end of Term Selection -->

  <section id="value-compaction">
    <h3 id="h3_value-compaction" role="heading" aria-level="2"><span class="secno">8.5 </span>Value Compaction</h3>

    <p><a href="#dfn-expansion" title="expansion" class="tref internalDFN">Expansion</a> transforms all values into <a href="#dfn-expanded-form" title="expanded-form" class="tref internalDFN">expanded form</a>
      in JSON-LD. This algorithm performs the opposite operation, transforming
      a value into <dfn id="dfn-compacted-form" title="compacted-form">compacted form</dfn>. This algorithm compacts a
      value according to the <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> in the given
      <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> that is associated with the value's associated
      <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-9">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>The <i>value</i> to compact has either an <code>@id</code> or an
        <code>@value</code> member.</p>

      <p>For the former case, if the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> of
        <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is set to <code>@id</code> or <code>@vocab</code>
        and <i>value</i> consists of only an <code>@id</code> member and, if
        the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
        is set to <code>@index</code>, an <code>@index</code> member, <i>value</i>
        can be compacted to a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> by returning the result of
        using the <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> Compaction algorithm</a>
        to compact the value associated with the <code>@id</code> member.
        Otherwise, <i>value</i> cannot be compacted and is returned as is.</p>

      <p>For the latter case, it might be possible to compact <i>value</i>
        just into the value associated with the <code>@value</code> member.
        This can be done if the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> has a matching
        <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> or <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> and there
        is either no <code>@index</code> member or the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>
        of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is set to <code>@index</code>. It can
        also be done if <code>@value</code> is the only member in <i>value</i>
        (apart an <code>@index</code> member in case the <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a>
        of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is set to <code>@index</code>) and
        either its associated value is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>, there is
        no <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>, or there is an explicit
        <a href="#dfn-null" title="null" class="tref internalDFN">null</a> <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> for the
        <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-9">Algorithm</h4>

      <p>This algorithm has four required inputs: an <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, an
        <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,  an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and a <i>value</i>
        to be compacted.</p>

      <ol class="algorithm">
        <li>Initialize <i>number members</i> to the number of members
          <i>value</i> contains.</li>
        <li>If <i>value</i> has an <code>@index</code> member and the
          <a href="#dfn-container-mapping" title="container-mapping" class="tref internalDFN">container mapping</a> associated to <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
          is set to <code>@index</code>, decrease <i>number members</i> by
          <code>1</code>.</li>
        <li>If <i>number members</i> is greater than <code>2</code>, return
          <i>value</i> as it cannot be compacted.</li>
        <li>If <i>value</i> has an <code>@id</code> member:
          <ol class="algorithm">
            <li>If <i>number members</i> is <code>1</code> and
              the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
              is set to <code>@id</code>, return the result of using the
              <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> compaction algorithm</a>,
              passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
              and the value of the <code>@id</code> member for <i>iri</i>.</li>
            <li>Otherwise, if <i>number members</i> is <code>1</code> and
              the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
              is set to <code>@vocab</code>, return the result of using the
              <a href="#iri-compaction"><abbr title="Internationalized Resource Identifier">IRI</abbr> compaction algorithm</a>,
              passing <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>, <a href="#dfn-inverse-context" title="inverse-context" class="tref internalDFN">inverse context</a>,
              the value of the <code>@id</code> member for <i>iri</i>, and
              <a href="#dfn-true" title="true" class="tref internalDFN">true</a> for <i>vocab</i>.</li>
            <li>Otherwise, return <i>value</i> as is.</li>
          </ol>
        </li>
        <li>Otherwise, if <i>value</i> has an <code>@type</code> member whose
          value matches the <a href="#dfn-type-mapping" title="type-mapping" class="tref internalDFN">type mapping</a> of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>,
          return the value associated with the <code>@value</code> member
          of <i>value</i>.</li>
        <li>Otherwise, if <i>value</i> has an <code>@language</code> member whose
          value matches the <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> of
          <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, return the value associated with the
          <code>@value</code> member of <i>value</i>.</li>
        <li>Otherwise, if <i>number members</i> equals <code>1</code> and either
          the value of the <code>@value</code> member is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>,
          or the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> has no <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a>,
          or the <a href="#dfn-language-mapping" title="language-mapping" class="tref internalDFN">language mapping</a> of <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
          is set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,, return the value associated with the
          <code>@value</code> member.</li>
        <li>Otherwise, return <i>value</i> as is.</li>
      </ol>
    </section>
  </section> <!-- end of Value Compaction algorithm -->
</section> <!-- end of Compaction section -->


<section id="flattening-algorithms">
  <!--OddPage--><h2 id="h2_flattening-algorithms" role="heading" aria-level="1"><span class="secno">9. </span>Flattening Algorithms</h2>

  <section id="flattening-algorithm">
    <h3 id="h3_flattening-algorithm" role="heading" aria-level="2"><span class="secno">9.1 </span>Flattening Algorithm</h3>

    <p>This algorithm flattens an expanded JSON-LD document by collecting all
      properties of a <a href="#dfn-node" title="node" class="tref internalDFN">node</a> in a single <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
      and labeling all <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank nodes</a> with
      <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>.
      This resulting uniform shape of the document, may drastically simplify
      the code required to process JSON-LD data in certain applications.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-10">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>First, a <i>node map</i> is generated using the
        <a href="#node-map-generation">Node Map Generation algorithm</a>
        which collects all properties of a <a href="#dfn-node" title="node" class="tref internalDFN">node</a> in a single
        <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>. In the next step, the <i>node map</i> is
        converted to a JSON-LD document in
        <a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#flattened-document-form" title="flattened-document-form" class="tref externalDFN">flattened document form</a>.
        Finally, if a <a href="#dfn-context" title="context" class="tref internalDFN">context</a> has been passed, the flattened document
        is compacted using the <a href="#compaction-algorithm">Compaction algorithm</a>
        before being returned.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-10">Algorithm</h4>

      <p>The algorithm takes two input variables, an <i>element</i> to flatten and
        an optional <i>context</i> used to compact the flattened document. If not
        passed, <i>context</i> is set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</p>

      <p>This algorithm generates new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>
        and relabels existing <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>.
        The used <a href="#generate-blank-node-identifier">Generate Blank Node Identifier algorithm</a>
        keeps an <i>identifier map</i> and a <i>counter</i> to ensure consistent
        relabeling and avoid collisions. Thus, before this algorithm is run,
        the <i>identifier map</i> is reset and the <i>counter</i> is initialized
        to <code>0</code>.</p>

      <ol class="algorithm">
        <li>Initialize <i>node map</i> to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting of
          a single member whose key is <code>@default</code> and whose value is
          an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>Perform the <a href="#node-map-generation">Node Map Generation algorithm</a>, passing
          <i>element</i> and <i>node map</i>.</li>
        <li>Initialize <i>default graph</i> to the value of the <code>@default</code>
          member of <i>node map</i>, which is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> representing
          the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a>.</li>
        <li>For each key-value pair <i>graph name</i>-<i>graph</i> in <i>node map</i>
          where <i>graph name</i> is not <code>@default</code>,  perform the following steps:
          <ol class="algorithm">
            <li>If <i>default graph</i> does not have a <i>graph name</i> member, create
              one and initialize its value to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting of an
              <code>@id</code> member whose value is set to <i>graph name</i>.</li>
            <li>Reference the value associated with the <i>graph name</i> member in
              <i>default graph</i> using the variable <i>entry</i>.</li>
            <li>Add an <code>@graph</code> member to <i>entry</i> and set it to an
              empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
            <li>For each <i>id</i>-<i>node</i> pair in <i>graph</i> ordered by <i>id</i>,
              add <i>node</i> to the <code>@graph</code> member of <i>entry</i>,
              unless the only member of <i>node</i> is <code>@id</code>.</li>
          </ol>
        </li>
        <li>Initialize an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>flattened</i>.</li>
        <li>For each <i>id</i>-<i>node</i> pair in <i>default graph</i> ordered by <i>id</i>,
          add <i>node</i> to <i>flattened</i>,
          unless the only member of <i>node</i> is <code>@id</code>.</li>
        <li>If <i>context</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, return <i>flattened</i>.</li>
        <li>Otherwise, return the result of compacting <i>flattened</i> according the
          <a href="#compaction-algorithm">Compaction algorithm</a> passing <i>context</i>
          ensuring that the compaction result has only the <code>@graph</code> keyword (or its alias)
          at the top-level other than <code>@context</code>, even if the context is empty or if there is only one element to
          put in the <code>@graph</code> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. This ensures that the returned
          document has a deterministic structure.</li>
      </ol>
    </section>
  </section> <!-- end of Flattening Algorithm -->

  <section id="node-map-generation">
    <h3 id="h3_node-map-generation" role="heading" aria-level="2"><span class="secno">9.2 </span>Node Map Generation</h3>

    <p>This algorithm creates a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>node map</i> holding an indexed
      representation of the <a href="#dfn-graph" title="graph" class="tref internalDFN">graphs</a> and <a href="#dfn-node" title="node" class="tref internalDFN">nodes</a>
      represented in the passed expanded document. All <a href="#dfn-node" title="node" class="tref internalDFN">nodes</a> that are not
      uniquely identified by an <abbr title="Internationalized Resource Identifier">IRI</abbr> get assigned a (new) <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.
      The resulting <i>node map</i> will have a member for every graph in the document whose
      value is another object with a member for every <a href="#dfn-node" title="node" class="tref internalDFN">node</a> represented in the document.
      The default graph is stored under the <code>@default</code> member, all other graphs are
      stored under their <a href="#dfn-graph-name" title="graph-name" class="tref internalDFN">graph name</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-11">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>The algorithm recursively runs over an expanded JSON-LD document to
        collect all <a href="#dfn-property" title="property" class="tref internalDFN">properties</a> of a <a href="#dfn-node" title="node" class="tref internalDFN">node</a>
        in a single <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>. The algorithm constructs a
        <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>node map</i> whose keys represent the
        <a href="#dfn-graph-name" title="graph-name" class="tref internalDFN">graph names</a> used in the document
        (the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a> is stored under the key <code>@default</code>)
        and whose associated values are <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a>
        which index the <a href="#dfn-node" title="node" class="tref internalDFN">nodes</a> in the
        <a href="#dfn-graph" title="graph" class="tref internalDFN">graph</a>. If a
        <a href="#dfn-property" title="property" class="tref internalDFN">property's</a> value is a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>,
        it is replaced by a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> consisting of only an
        <code>@id</code> member. If a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> has no <code>@id</code>
        member or it is identified by a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>,
        a new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> is generated. This relabeling
        of <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a> is
        also done for <a href="#dfn-property" title="property" class="tref internalDFN">properties</a> and values of
        <code>@type</code>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-11">Algorithm</h4>

      <p>The algorithm takes as input an expanded JSON-LD document <i>element</i> and a reference to
        a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>node map</i>. Furthermore it has the optional parameters
        <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a> (which defaults to <code>@default</code>), an <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>,
        <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and a reference to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>list</i>. If
        not passed, <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>, <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>list</i> are
        set to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</p>

      <ol class="algorithm">
        <li>If <i>element</i> is an array, process each <i>item</i> in <i>element</i>
          as follows and then return:
          <ol class="algorithm">
            <li>Run this algorithm recursively by passing <i>item</i> for <i>element</i>,
              <i>node map</i>, <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a>, <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>,
              <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and <i>list</i>.</li>
          </ol>
        </li>
        <li>Otherwise <i>element</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>. Reference the
          <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> which is the value of the <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a>
          member of <i>node map</i> using the variable <i>graph</i>. If the
          <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set <i>node</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>
          otherwise reference the <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> member of <i>graph</i> using the
          variable <i>node</i>.</li>
        <li>If <i>element</i> has an <code>@type</code> member, perform for each
          <i>item</i> the following steps:
          <ol class="algorithm">
            <li>If <i>item</i> is a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, replace it with a newly
              <a href="#generate-blank-node-identifier">generated blank node identifier</a>
              passing <i>item</i> for <i>identifier</i>.</li>
          </ol>
        </li>
        <li>If <i>element</i> has an <code>@value</code> member, perform the following steps:
          <ol class="algorithm">
            <li>If <i>list</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>:
              <ol class="algorithm">
                <li>If <i>node</i> does not have an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> member,
                  create one and initialize its value to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                  containing <i>element</i>.</li>
                <li>Otherwise, compare <i>element</i> against every item in the
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a> associated with the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
                  member of <i>node</i>. If there is no item equivalent to <i>element</i>,
                  append <i>element</i> to the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Two
                  <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a> are considered
                  equal if they have equivalent key-value pairs.</li>
              </ol>
            </li>
            <li>Otherwise, append <i>element</i> to the <code>@list</code> member of <i>list</i>.</li>
          </ol>
        </li>
        <li>Otherwise, if <i>element</i> has an <code>@list</code> member, perform
          the following steps:
          <ol class="algorithm">
            <li>Initialize a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>result</i> consisting of a single member
              <code>@list</code> whose value is initialized to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
            <li>Recursively call this algorithm passing the value of <i>element's</i>
              <code>@list</code> member for <i>element</i>, <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a>,
              <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>, <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>, and
              <i>result</i> for <i>list</i>.</li>
            <li>Append <i>result</i> to the value of the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> member
              of <i>node</i>.</li>
          </ol>
        </li>
        <li>Otherwise <i>element</i> is a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>, perform
          the following steps:
          <ol class="algorithm">
            <li>If <i>element</i> has an <code>@id</code> member, set <i>id</i>
              to its value and remove the member from <i>element</i>. If <i>id</i>
              is a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, replace it with a newly
              <a href="#generate-blank-node-identifier">generated blank node identifier</a>
              passing <i>id</i> for <i>identifier</i>.</li>
            <li>Otherwise, set <i>id</i> to the result of the
              <a href="#generate-blank-node-identifier">Generate Blank Node Identifier algorithm</a>
              passing <a href="#dfn-null" title="null" class="tref internalDFN">null</a> for <i>identifier</i>.</li>
            <li>If <i>graph</i> does not contain a member <i>id</i>, create one and initialize
              its value to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting of a single member <code>@id</code> whose
              value is <i>id</i>.</li>
            <li>Reference the value of the <i>id</i> member of <i>graph</i> using the
              variable <i>node</i>.</li>
            <li>If <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, a reverse property relationship
              is being processed. Perform the following steps:
              <ol class="algorithm">
                <li>If <i>node</i> does not have an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> member,
                  create one and initialize its value to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                  containing <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>.</li>
                <li>Otherwise, compare <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> against every item in the
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a> associated with the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
                  member of <i>node</i>. If there is no item equivalent to <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>,
                  append <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> to the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Two
                  <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a> are considered
                  equal if they have equivalent key-value pairs.</li>
              </ol>
            </li>
            <li>Otherwise, if <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, perform the following steps:
              <ol class="algorithm">
                <li>Create a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>reference</i> consisting of a single member
                  <code>@id</code> whose value is <i>id</i>.</li>
                <li>If <i>list</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>:
                  <ol class="algorithm">
                    <li>If <i>node</i> does not have an <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a> member,
                      create one and initialize its value to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                      containing <i>reference</i>.</li>
                    <li>Otherwise, compare <i>reference</i> against every item in the
                      <a href="#dfn-array" title="array" class="tref internalDFN">array</a> associated with the <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>
                      member of <i>node</i>. If there is no item equivalent to <i>reference</i>,
                      append <i>reference</i> to the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Two
                      <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a> are considered
                      equal if they have equivalent key-value pairs.</li>
                  </ol>
                </li>
                <li>Otherwise, append <i>element</i> to the <code>@list</code> member of <i>list</i>.</li>
              </ol>
            </li>
            <li>If <i>element</i> has an <code>@type</code> key, append
              each item of its associated <a href="#dfn-array" title="array" class="tref internalDFN">array</a> to the
              <a href="#dfn-array" title="array" class="tref internalDFN">array</a> associated with the <code>@type</code> key of
              <i>node</i> unless it is already in that <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Finally
              remove the <code>@type</code> member from <i>element</i>.</li>
            <li>If <i>element</i> has an <code>@index</code> member, set the <code>@index</code>
              member of <i>node</i> to its value. If <a href="#dfn-node" title="node" class="tref internalDFN">node</a> has already an
              <code>@index</code> member with a different value, a
              <code class="error"><a href="#idl-def-JsonLdErrorCode.conflicting-indexes">conflicting indexes</a></code>
              error has been detected and processing is aborted. Otherwise, continue by
              removing the <code>@index</code> member from <i>element</i>.</li>
            <li>If <i>element</i> has an <code>@reverse</code> member:
              <ol class="algorithm">
                <li>Create a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> <i>referenced node</i> with a single member <code>@id</code> whose
                  value is <i>id</i>.</li>
                <li>Set <i>reverse map</i> to the value of the <code>@reverse</code> member of
                  <i>element</i>.</li>
                <li>For each key-value pair <i>property</i>-<i>values</i> in <i>reverse map</i>:
                  <ol class="algorithm">
                    <li>For each <i>value</i> of <i>values</i>:
                      <ol class="algorithm">
                        <li>Recursively invoke this algorithm passing <i>value</i> for
                          <i>element</i>, <i>node map</i>, <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a>,
                          <i>referenced node</i> for <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>, and
                          <i>property</i> for <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>. Passing a
                          <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> for <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a> indicates to the
                          algorithm that a reverse property relationship is being processed.</li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>Remove the <code>@reverse</code> member from <i>element</i>.</li>
              </ol>
            </li>
            <li>If <i>element</i> has an <code>@graph</code> member, recursively invoke this
              algorithm passing the value of the <code>@graph</code> member for <i>element</i>,
              <i>node map</i>, and <i>id</i> for <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a> before removing
              the <code>@graph</code> member from <i>element</i>.</li>
            <li>Finally, for each key-value pair <i>property</i>-<i>value</i> in <i>element</i> ordered by
              <i>property</i> perform the following steps:
              <ol class="algorithm">
                <li>If <i>property</i> is a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, replace it with a newly
                  <a href="#generate-blank-node-identifier">generated blank node identifier</a>
                  passing <i>property</i> for <i>identifier</i>.</li>
                <li>If <i>node</i> does not have a <i>property</i> member, create one and initialize
                  its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>Recursively invoke this algorithm passing <i>value</i> for <i>element</i>,
                  <i>node map</i>, <a href="#dfn-active-graph" title="active-graph" class="tref internalDFN">active graph</a>, <i>id</i> for <a href="#dfn-active-subject" title="active-subject" class="tref internalDFN">active subject</a>,
                  and <i>property</i> for <a href="#dfn-active-property" title="active-property" class="tref internalDFN">active property</a>.</li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </section>
  </section> <!-- end of Node Map Generation -->

  <section id="generate-blank-node-identifier">
    <h3 id="h3_generate-blank-node-identifier" role="heading" aria-level="2"><span class="secno">9.3 </span>Generate Blank Node Identifier</h3>

    <p>This algorithm is used to generate new
      <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a> or to
      relabel an existing <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> to avoid collision
      by the introduction of new ones.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-12">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>The simplest case is if there exists already a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>
        in the <i>identifier map</i> for the passed <i>identifier</i>, in which
        case it is simply returned. Otherwise, a new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>
        is generated by concatenating the string <code>_:b</code> and the
        <i>counter</i>. If the passed <i>identifier</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>,
        an entry is created in the <i>identifier map</i> associating the
        <i>identifier</i> with the <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>. Finally,
        the <i>counter</i> is increased by one and the new
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> is returned.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-12">Algorithm</h4>

      <p>The algorithm takes a single input variable <i>identifier</i> which may
        be <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. Between its executions, the algorithm needs to
        keep an <i>identifier map</i> to relabel existing
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>
        consistently and a <i>counter</i> to generate new
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>. The
        <i>counter</i> is initialized to <code>0</code> by default.</p>

      <ol class="algorithm">
        <li>If <i>identifier</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a> and has an entry in the
          <i>identifier map</i>, return the mapped identifier.</li>
        <li>Otherwise, generate a new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> by concatenating
          the string <code>_:b</code> and <i>counter</i>.</li>
        <li>Increment <i>counter</i> by <code>1</code>.</li>
        <li>If <i>identifier</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, create a new entry
          for <i>identifier</i> in <i>identifier map</i> and set its value
          to the new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.</li>
        <li>Return the new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.</li>
      </ol>
    </section>
  </section> <!-- end of Generate Blank Node Identifier -->
</section> <!-- end of Flattening section -->


<section id="rdf-serialization-deserialization-algorithms">
  <!--OddPage--><h2 id="h2_rdf-serialization-deserialization-algorithms" role="heading" aria-level="1"><span class="secno">10. </span>RDF Serialization/Deserialization Algorithms</h2>

  <p>This section describes algorithms to deserialize a JSON-LD document to an
    <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a> and vice versa. The algorithms are designed for in-memory
    implementations with random access to <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> elements.</p>

  <p>Throughout this section, the following vocabulary
    <a href="#dfn-prefix" title="prefix" class="tref internalDFN">prefixes</a> are used in
    <a href="#dfn-compact-iri" title="compact-iri" class="tref internalDFN">compact IRIs</a>:</p>

  <table class="simple">
    <thead>
      <tr><th>Prefix</th>
      <th><abbr title="Internationalized Resource Identifier">IRI</abbr></th>
    </tr></thead>
    <tbody>
      <tr>
        <td>rdf</td>
        <td>http://www.w3.org/1999/02/22-rdf-syntax-ns#</td>
      </tr>
      <tr>
        <td>rdfs</td>
        <td> http://www.w3.org/2000/01/rdf-schema#</td>
      </tr>
      <tr>
        <td>xsd</td>
        <td>http://www.w3.org/2001/XMLSchema#</td>
      </tr>
    </tbody>
  </table>

  <section id="deserialize-json-ld-to-rdf-algorithm">
    <h3 id="h3_deserialize-json-ld-to-rdf-algorithm" role="heading" aria-level="2"><span class="secno">10.1 </span>Deserialize JSON-LD to RDF algorithm</h3>

    <p>This algorithm deserializes a JSON-LD document to an <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a>.
      Please note that RDF does not allow a <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a> to be used
      as a <a href="#dfn-property" title="property" class="tref internalDFN">property</a>, while JSON-LD does.  Therefore, by default
      RDF triples that would have contained blank nodes as properties are
      discarded when interpreting JSON-LD as RDF.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-13">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>The JSON-LD document is expanded and converted to a <i>node map</i> using the
        <a href="#node-map-generation">Node Map Generation algorithm</a>.
        This allows each graph represented within the document to be
        extracted and flattened, making it easier to process each
        <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>. Each graph from the <i>node map</i>
        is processed to extract <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triples</a>,
        to which any (non-default) graph name is applied to create an
        <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a>. Each <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> in the
        <i>node map</i> has an <code>@id</code> member which corresponds to the
        <a href="#dfn-rdf-subject" title="rdf-subject" class="tref internalDFN">RDF subject</a>, the other members
        represent <a href="#dfn-rdf-predicate" title="rdf-predicate" class="tref internalDFN">RDF predicates</a>. Each
        member value is either an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> or can be transformed to an
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref externalDFN">RDF literal</a>
        to generate an <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triple</a>. <a href="#dfn-list" title="list" class="tref internalDFN">Lists</a>
        are transformed into an
        <a href="http://www.w3.org/TR/rdf-schema/#ch_collectionvocab" title="rdf-collection" class="tref externalDFN">RDF Collection</a>
        using the <a href="#list-to-rdf-conversion">List to RDF Conversion algorithm.</a></p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-13">Algorithm</h4>

      <p>The algorithm takes a JSON-LD document <i>element</i> and returns an
        <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a>. Unless the <i>produce generalized RDF</i> flag
        is set to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triples</a>
        containing a <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a> <a href="#dfn-rdf-predicate" title="rdf-predicate" class="tref internalDFN">predicate</a>
        are excluded from output.</p>

      <p>This algorithm generates new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>
        and relabels existing <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>.
        The used <a href="#generate-blank-node-identifier">Generate Blank Node Identifier algorithm</a>
        keeps an <i>identifier map</i> and a <i>counter</i> to ensure consistent
        relabeling and avoid collisions. Thus, before this algorithm is run,
        the <i>identifier map</i> is reset and the <i>counter</i> is initialized
        to <code>0</code>.</p>

      <ol class="algorithm">
        <li>Expand <i>element</i> according to the
          <a href="#expansion-algorithm">Expansion algorithm</a>.</li>
        <li>Generate a <i>node map</i> according to the
          <a href="#node-map-generation">Node Map Generation algorithm</a>.</li>
        <li>Initialize an empty <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a> <i>dataset</i>.</li>
        <li>For each <i>graph name</i> and <i>graph</i> in <i>node map</i>
          ordered by <i>graph name</i>:
          <ol class="algorithm">
            <li>If <i>graph name</i> is a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, continue
              with the next <i>graph name</i>-<i>graph</i> pair.</li>
            <li>Initialize <i>triples</i> as an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
            <li>For each <i>subject</i> and <i>node</i> in <i>graph</i> ordered
              by <i>subject</i>:
              <ol class="algorithm">
                <li>If <i>subject</i> is a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, continue
                  with the next <i>subject</i>-<i>node</i> pair.</li>
                <li>For each <i>property</i> and <i>values</i> in <i>node</i>
                  ordered by <i>property</i>:
                  <ol class="algorithm">
                    <li>If <i>property</i> is <code>@type</code>, then for each
                      <i>type</i> in <i>values</i>, append a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triple</a>
                      composed of <i>subject</i>, <code>rdf:type</code>,
                      and <i>type</i> to <i>triples</i>.</li>
                    <li>Otherwise, if <i>property</i> is a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a>
                      continue with the next <i>property</i>-<i>values</i> pair.</li>
                    <li>Otherwise, if <i>property</i> is a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> and
                      the <i>produce generalized RDF</i> flag is not <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
                      continue with the next <i>property</i>-<i>values</i> pair.</li>
                    <li>Otherwise, if <i>property</i> is a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>,
                      continue with the next <i>property</i>-<i>values</i> pair.</li>
                    <li>Otherwise, <i>property</i> is an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> or
                      <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>. For each <i>item</i>
                      in <i>values</i>:
                      <ol class="algorithm">
                        <li>If <i>item</i> is a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>, initialize
                          <i>list triples</i> as an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a> and
                          <i>list head</i> to the result of the <a href="#list-to-rdf-conversion">List Conversion algorithm</a>, passing
                          the value associated with the <code>@list</code> key from
                          <i>item</i> and <i>list triples</i>. Append first a
                          <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triple</a> composed of <i>subject</i>,
                          <i>property</i>, and <i>list head</i> to <i>triples</i> and
                          finally append all <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triples</a> from
                          <i>list triples</i> to <i>triples</i>.</li>
                        <li>Otherwise, <i>item</i> is a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a>
                          or a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>. Append a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triple</a>
                          composed of <i>subject</i>, <i>property</i>, and
                          the result of using the
                          <a href="#object-to-rdf-conversion">Object to RDF Conversion algorithm</a>
                          passing <i>item</i> to <i>triples</i>, unless the result is
                          <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, indicating a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a> that has
                          to be ignored.</li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>If <i>graph name</i> is <code>@default</code>, add
              <i>triples</i> to the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a> in <i>dataset</i>.</li>
            <li>Otherwise, create a <a href="#dfn-named-graph" title="named-graph" class="tref internalDFN">named graph</a> in <i>dataset</i>
              composed of <i>graph name</i> and add <i>triples</i>.</li>
          </ol>
        </li>
        <li>Return <i>dataset</i>.</li>
      </ol>
    </section>
  </section> <!-- end of Deserialize JSON-LD to RDF algorithm -->

  <section id="object-to-rdf-conversion">
    <h3 id="h3_object-to-rdf-conversion" role="heading" aria-level="2"><span class="secno">10.2 </span>Object to RDF Conversion</h3>

    <p>This algorithm takes a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> or <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a>
      and transforms it into an
      <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-resource" title="rdf-resource" class="tref externalDFN">RDF resource</a>
      to be used as the <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-object" title="object" class="tref internalDFN">object</a> of an <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triple</a>. If a
      <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> containing a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a> is passed to
      the algorithm, <a href="#dfn-null" title="null" class="tref internalDFN">null</a> is returned which then causes the resulting
      <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triple</a> to be ignored.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-14">Overview</h4><p><em>This section is non-normative.</em></p>

      <p><a href="#dfn-value-object" title="value-object" class="tref internalDFN">Value objects</a> are transformed to
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a> as described in
        <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>
        whereas <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node objects</a> are transformed
        to <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a>,
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>,
        or <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-14">Algorithm</h4>

      <p>The algorithm takes as its sole argument <i>item</i> which must be
        either a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> or <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>.</p>

      <ol class="algorithm">
        <li>If <i>item</i> is a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a> and the value of
          its <code>@id</code> member is a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>, return
          <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</li>
        <li>If <i>item</i> is a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>, return the
          <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> associated
          with its <code>@id</code> member.</li>
        <li>Otherwise, <i>item</i> is a <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a>. Initialize
          <i>value</i> to the value associated with the <code>@value</code>
          member in <i>item</i>.
        </li><li>Initialize <i>datatype</i> to the value associated with the
          <code>@type</code> member of <i>item</i> or  <a href="#dfn-null" title="null" class="tref internalDFN">null</a> if
          <i>item</i> does not have such a member.</li>
        <li>If <i>value</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a> or
          <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, set <i>value</i> to the <a href="#dfn-string" title="string" class="tref internalDFN">string</a>
          <code>true</code> or <code>false</code> which is the
          <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> as described in
          <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>
          If <i>datatype</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
          <code>xsd:boolean</code>.</li>
        <li>Otherwise, if <i>value</i> is a <a href="#dfn-number" title="number" class="tref internalDFN">number</a> with a non-zero fractional
          part (the result of a modulo‑1 operation) or <i>value</i> is a <a href="#dfn-number" title="number" class="tref internalDFN">number</a>
          and <i>datatype</i> equals <code>xsd:double</code>, convert <i>value</i> to a
          <a href="#dfn-string" title="string" class="tref internalDFN">string</a> in <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> of
          an <code>xsd:double</code> as defined in [<cite><a href="#bib-XMLSCHEMA11-2" class="bibref">XMLSCHEMA11-2</a></cite>]
          and described in
          <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>.
          If <i>datatype</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
          <code>xsd:double</code>.</li>
        <li>Otherwise, if <i>value</i> is a <a href="#dfn-number" title="number" class="tref internalDFN">number</a> with no non-zero
          fractional part (the result of a modulo‑1 operation) or <i>value</i>
          is a <a href="#dfn-number" title="number" class="tref internalDFN">number</a> and <i>datatype</i>
          equals <code>xsd:integer</code>, convert <i>value</i> to a
          <a href="#dfn-string" title="string" class="tref internalDFN">string</a> in <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> of
          an <code>xsd:integer</code> as defined in [<cite><a href="#bib-XMLSCHEMA11-2" class="bibref">XMLSCHEMA11-2</a></cite>]
          and described in
          <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>.
          If <i>datatype</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
          <code>xsd:integer</code>.</li>
        <li>Otherwise, if <i>datatype</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, set it to
          <code>xsd:string</code> or <code>rdf:langString</code>, depending on if
          item has an <code>@language</code> member.</li>
        <li>Initialize <i>literal</i> as an <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literal</a> using
          <i>value</i> and <i>datatype</i>. If <i>item</i> has an
          <code>@language</code> member, add the value associated with the
          <code>@language</code> key as the language tag of <i>literal</i>.</li>
        <li>Return <i>literal</i>.</li>

      </ol>
    </section>
  </section> <!-- end of Object to RDF Conversion -->

  <section id="list-to-rdf-conversion">
    <h3 id="h3_list-to-rdf-conversion" role="heading" aria-level="2"><span class="secno">10.3 </span>List to RDF Conversion</h3>

    <p>List Conversion is the process of taking a <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>
      and transforming it into an
      <a href="http://www.w3.org/TR/rdf-schema/#ch_collectionvocab" title="rdf-collection" class="tref externalDFN">RDF Collection</a>
      as defined in RDF Semantics [<cite><a href="#bib-RDF-MT" class="bibref">RDF-MT</a></cite>].</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-15">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>For each element of the <a href="#dfn-list" title="list" class="tref internalDFN">list</a> a new <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>
        is allocated which is used to generate <code>rdf:first</code> and
        <code>rdf:rest</code> <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">triples</a>. The
        algorithm returns the list head, which is either the first allocated
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> or <code>rdf:nil</code> if the
        <a href="#dfn-list" title="list" class="tref internalDFN">list</a> is empty. If a list element represents a <a href="#dfn-relative-iri" title="relative-iri" class="tref internalDFN">relative <abbr title="Internationalized Resource Identifier">IRI</abbr></a>,
        the corresponding <code>rdf:first</code> triple is omitted.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-15">Algorithm</h4>

      <p>The algorithm takes two inputs: an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>list</i>
        and an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>list triples</i> used for returning
        the generated <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">triples</a>.</p>

      <ol class="algorithm">
        <li>If <i>list</i> is empty, return <code>rdf:nil</code>.</li>
        <li>Otherwise, create an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>bnodes</i> composed of a
          <a href="#generate-blank-node-identifier">newly generated blank node identifier</a>
          for each entry in <i>list</i>.</li>
        <li>Initialize an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>list triples</i>.</li>
        <li>For each pair of <i>subject</i> from <i>bnodes</i> and <i>item</i> from <i>list</i>:
          <ol class="algorithm">
            <li>Initialize <i>object</i> to the result of using the
              <a href="#object-to-rdf-conversion">Object to RDF Conversion algorithm</a>
              passing <i>item</i> to <i>list triples</i>.</li>
            <li>Unless <i>object</i> is <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, append a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triple</a>
              composed of <i>subject</i>, <code>rdf:first</code>, and <i>object</i>.</li>
            <li>Set <i>rest</i> as the next entry in <i>bnodes</i>, or if that
              does not exist, <code>rdf:nil</code>. Append a
              <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" title="triple" class="tref internalDFN">triple</a> composed of <i>subject</i>,
              <code>rdf:rest</code>, and <i>rest</i> to <i>list triples</i>.</li>
          </ol>
        </li>
        <li>Return the first <a href="#dfn-blank-node" title="blank-node" class="tref internalDFN">blank node</a> from <i>bnodes</i> or
          <code>rdf:nil</code> if <i>bnodes</i> is empty.</li>
      </ol>
    </section>
  </section> <!-- end of List to RDF -->

  <section id="serialize-rdf-as-json-ld-algorithm">
    <h3 id="h3_serialize-rdf-as-json-ld-algorithm" role="heading" aria-level="2"><span class="secno">10.4 </span>Serialize RDF as JSON-LD Algorithm</h3>

    <p>This algorithm serializes an <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a> consisting of a
      <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a> and zero or more
      <a href="#dfn-named-graph" title="named-graph" class="tref internalDFN">named graphs</a> into a JSON-LD document.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-16">Overview</h4><p><em>This section is non-normative.</em></p>

      <p>Iterate through each graph in the dataset, converting each
        <a href="http://www.w3.org/TR/rdf-schema/#ch_collectionvocab" title="rdf-collection" class="tref internalDFN">RDF Collection</a> into a <a href="#dfn-list" title="list" class="tref internalDFN">list</a>
        and generating a JSON-LD document in expanded form for all
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a>, <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a>
        and <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a>.
        If the <i>use native types</i> flag is set to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a> with a
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        that equals <code>xsd:integer</code> or <code>xsd:double</code> are converted
        to a <a href="#dfn-number" title="number" class="tref internalDFN">JSON numbers</a> and <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a>
        with a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        that equals <code>xsd:boolean</code> are converted to <a href="#dfn-true" title="true" class="tref internalDFN">true</a> or
        <a href="#dfn-false" title="false" class="tref internalDFN">false</a> based on their
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
        as described in
        <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>.
        Unless the <i>use <code>rdf:type</code></i> flag is set to true, <code>rdf:type</code>
        predicates will be serialized as <code>@type</code> as long as the associated object is
        either an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-16">Algorithm</h4>

      <p>The algorithm takes one required and two optional inputs: an <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a>
        and the two flags <i>use native types</i> and <i>use <code>rdf:type</code></i>
        that both default to <a href="#dfn-false" title="false" class="tref internalDFN">false</a>.</p>

      <ol class="algorithm">
        <li>Initialize <i>default graph</i> to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
        <li>Initialize <i>graph map</i> to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting
          of a single member <code>@default</code> whose value references
          <i>default graph</i>.</li>
        <li>For each <i>graph</i> in <a href="#dfn-rdf-dataset" title="rdf-dataset" class="tref internalDFN">RDF dataset</a>:
          <ol class="algorithm">
            <li>If <i>graph</i> is the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a>,
              set <i>name</i> to <code>@default</code>, otherwise to the
              <a href="#dfn-graph-name" title="graph-name" class="tref internalDFN">graph name</a> associated with <i>graph</i>.</li>
            <li>If <i>graph map</i> has no <i>name</i> member, create one and set
              its value to an empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</li>
            <li>If <i>graph</i> is not the <a href="#dfn-default-graph" title="default-graph" class="tref internalDFN">default graph</a> and
              <i>default graph</i> does not have a <i>name</i> member,
              create such a member and initialize its value to a new
              <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> with a single member <code>@id</code>
              whose value is <i>name</i>.</li>
            <li>Reference the value of the <i>name</i> member in <i>graph map</i>
              using the variable <i>node map</i>.</li>
            <li>For each <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triple</a> in <i>graph</i>
              consisting of <i>subject</i>, <i>predicate</i>, and <i>object</i>:
              <ol class="algorithm">
                <li>If <i>node map</i> does not have a <i>subject</i> member,
                  create one and initialize its value to a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
                  consisting of a single member <code>@id</code> whose value is
                  set to <i>subject</i>.</li>
                <li>Reference the value of the <i>subject</i> member in <i>node map</i>
                  using the variable <i>node</i>.</li>
                <li>If <i>object</i> is an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>,
                  and <i>node map</i> does not have an <i>object</i> member,
                  create one and initialize its value to a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
                  consisting of a single member <code>@id</code> whose value is
                  set to <i>object</i>.</li>
                <li>If <i>predicate</i> equals <code>rdf:type</code>, the
                  <i>use <code>rdf:type</code></i> flag is not <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, and <i>object</i>
                  is an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>,
                  append <i>object</i> to the value of the <code>@type</code>
                  member of <i>node</i>; unless such an item already exists.
                  If no such member exists, create one
                  and initialize it to an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> whose only item is
                  <i>object</i>. Finally, continue to the next
                  <a href="#dfn-rdf-triple" title="rdf-triple" class="tref internalDFN">RDF triple</a>.</li>
                <li>Set <i>value</i> to the result of using the
                  <a href="#rdf-to-object-conversion">RDF to Object Conversion algorithm</a>,
                  passing <i>object</i> and <i>use native types</i>.</li>
                <li>If <i>node</i> does not have an <i>predicate</i> member, create one
                  and initialize its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>If there is no item equivalent to <i>value</i> in the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                  associated with the <i>predicate</i> member of <i>node</i>, append a
                  reference to <i>value</i> to the <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. Two JSON objects
                  are considered equal if they have equivalent key-value pairs.</li>
                <li>If <i>object</i> is a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a> or <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>,
                  it might represent the list node:
                  <ol class="algorithm">
                    <li>If the <i>object</i> member of <i>node map</i> has no
                      <code>usages</code> member, create one and initialize it to
                      an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                    <li>Reference the <code>usages</code> member of the <i>object</i>
                      member of <i>node map</i> using the variable <i>usages</i>.</li>
                    <li>Append a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> consisting of three
                      members, <code>node</code>, <code>property</code>, and <code>value</code>
                      to the <i>usages</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>. The <code>node</code> member
                      is set to a reference to <i>node</i>, <code>property</code> to <i>predicate</i>,
                      and <code>value</code> to a reference to <i>value</i>.</li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
        </li>
        <li>For each <i>name</i> and <i>graph object</i> in <i>graph map</i>:
          <ol class="algorithm">
            <li>If <i>graph object</i> has no <code>rdf:nil</code> member, continue
              with the next <i>name</i>-<i>graph object</i> pair as the graph does
              not contain any lists that need to be converted.</li>
            <li>Initialize <i>nil</i> to the value of the <code>rdf:nil</code> member
              of <i>graph object</i>.</li>
            <li>For each item <i>usage</i> in the <code>usages</code> member of
              <i>nil</i>, perform the following steps:
              <ol class="algorithm">
                <li>Initialize <i>node</i> to the value of the value of the
                  <code>node</code> member of <i>usage</i>, <i>property</i> to
                  the value of the <code>property</code> member of <i>usage</i>,
                  and <i>head</i> to the value of the <code>value</code> member
                  of <i>usage</i>.</li>
                <li>Initialize two empty <a href="#dfn-array" title="array" class="tref internalDFN">arrays</a> <i>list</i>
                  and <i>list nodes</i>.</li>
                <li>While <i>property</i> equals <code>rdf:rest</code>, the value
                  associated to the <code>usages</code> member of <i>node</i> has
                  exactly 1 entry, <i>node</i> has a <code>rdf:first</code> and
                  <code>rdf:rest</code> property, both of which have as value an
                  <a href="#dfn-array" title="array" class="tref internalDFN">array</a> consisting of a single element, and <i>node</i>
                  has no other members apart from an optional <code>@type</code>
                  member whose value is an array with a single item equal to
                  <code>rdf:List</code>, <i>node</i> represents a well-formed list
                  node. Perform the following steps to traverse the list backwards
                  towards its head:
                  <ol class="algorithm">
                    <li>Append the only item of <code>rdf:first</code> member of
                      <i>node</i> to the <i>list</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                    <li>Append the value of the <code>@id</code> member of
                      <i>node</i> to the <i>list nodes</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                    <li>Initialize <i>node usage</i> to the only item of the
                      <code>usages</code> member of <i>node</i>.</li>
                    <li>Set <i>node</i> to the value of the <code>node</code> member
                      of <i>node usage</i>, <i>property</i> to the value of the
                      <code>property</code> member of <i>node usage</i>, and
                      <i>head</i> to the value of the <code>value</code> member
                      of <i>node usage</i>.</li>
                    <li>If the <code>@id</code> member of <i>node</i> is an
                      <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> instead of a <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>,
                      exit the while loop.</li>
                  </ol>
                </li>
                <li>If <i>property</i> equals <code>rdf:first</code>, i.e., the
                  detected list is nested inside another list
                  <ol class="algorithm">
                    <li>and the value of the <code>@id</code> of <i>node</i> equals
                      <code>rdf:nil</code>, i.e., the detected list is empty,
                      continue with the next <i>usage</i> item. The
                      <code>rdf:nil</code> node cannot be converted to a
                      <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a> as it would result in a list of
                      lists, which isn't supported.</li>
                    <li>Otherwise, the list consists of at least one item. We preserve the
                      head node and transform the rest of the linked list to a
                      <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a>.</li>
                    <li>Set <i>head id</i> to the value of the <code>@id</code>
                      member of <i>head</i>.</li>
                    <li>Set <i>head</i> to the value of the <i>head id</i> member of
                      <i>graph object</i> so that all it's properties can be accessed.</li>
                    <li>Then, set <i>head</i> to the only item in the value of the
                      <code>rdf:rest</code> member of <i>head</i>.</li>
                    <li>Finally, remove the last item of the <i>list</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
                      and the last item of the <i>list nodes</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                  </ol>
                </li>
                <li>Remove the <code>@id</code> member from <i>head</i>.</li>
                <li>Reverse the order of the <i>list</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>Add a <code>@list</code> member to <i>head</i> and initialize
                  its value to the <i>list</i> <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>For each item <i>node id</i> in <i>list nodes</i>, remove the
                  <i>node id</i> member from <i>graph object</i>.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Initialize an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a> <i>result</i>.</li>
        <li>For each <i>subject</i> and <i>node</i> in <i>default graph</i>
          ordered by <i>subject</i>:
          <ol class="algorithm">
            <li>If <i>graph map</i> has a <i>subject</i> member:
              <ol class="algorithm">
                <li>Add a <code>@graph</code> member to <i>node</i> and initialize
                  its value to an empty <a href="#dfn-array" title="array" class="tref internalDFN">array</a>.</li>
                <li>For each key-value pair <i>s</i>-<i>n</i> in the <i>subject</i>
                  member of <i>graph map</i> ordered by <i>s</i>, append <i>n</i>
                  to the <code>@graph</code> member of <i>node</i> after
                  removing its <code>usages</code> member, unless the only
                  remaining member of <i>n</i> is <code>@id</code>.</li>
              </ol>
            </li>
            <li>Append <i>node</i> to <i>result</i> after removing its
              <code>usages</code> member, unless the only remaining member of
              <i>node</i> is <code>@id</code>.</li>
          </ol>
        </li>
        <li>Return <i>result</i>.</li>
      </ol>
    </section>
  </section> <!-- end of Serialize RDF as JSON-LD Algorithm -->

  <section id="rdf-to-object-conversion">
    <h3 id="h3_rdf-to-object-conversion" role="heading" aria-level="2"><span class="secno">10.5 </span>RDF to Object Conversion</h3>

    <p>This algorithm transforms an RDF literal to a JSON-LD <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a>
      and a RDF blank node or <abbr title="Internationalized Resource Identifier">IRI</abbr> to an JSON-LD <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="overview-17">Overview</h4><p><em>This section is non-normative.</em></p>

      <p><a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a> are transformed to
        <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value objects</a> whereas <a href="#dfn-iri" title="iri" class="tref internalDFN">IRIs</a> and
        <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifiers</a> are
        transformed to <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node objects</a>.
        If the <i>use native types</i> flag is set to <a href="#dfn-true" title="true" class="tref internalDFN">true</a>,
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a> with a
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        that equals <code>xsd:integer</code> or <code>xsd:double</code> are converted
        to a <a href="#dfn-number" title="number" class="tref internalDFN">JSON numbers</a> and <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref internalDFN">RDF literals</a>
        with a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
        that equals <code>xsd:boolean</code> are converted to <a href="#dfn-true" title="true" class="tref internalDFN">true</a> or
        <a href="#dfn-false" title="false" class="tref internalDFN">false</a> based on their
        <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
        as described in
        <a class="sectionRef" href="#data-round-tripping">section 10.6 Data Round Tripping</a>.</p>
    </section>

    <section>
      <h4 role="heading" aria-level="3" id="algorithm-17">Algorithm</h4>

      <p>This algorithm takes two required inputs: a <i>value</i> to be converted
        to a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> and a flag <i>use native types</i>.</p>

      <ol class="algorithm">
        <li>If <i>value</i> is an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> or a
          <a href="#dfn-blank-node-identifier" title="blank-node-identifier" class="tref internalDFN">blank node identifier</a>, return a new <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>
          consisting of a single member <code>@id</code> whose value is set to
          <i>value</i>.</li>
        <li>Otherwise <i>value</i> is an
          <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literal" class="tref externalDFN">RDF literal</a>:
          <ol class="algorithm">
            <li>Initialize a new empty <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> result.</li>
            <li>Initialize <i>converted value</i> to <i>value</i>.</li>
            <li>Initialize <i>type</i> to <a href="#dfn-null" title="null" class="tref internalDFN">null</a></li>
            <li>If <i>use native types</i> is <a href="#dfn-true" title="true" class="tref internalDFN">true</a>
              <ol class="algorithm">
                <li>If the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
                  of <i>value</i> equals <code>xsd:string</code>, set
                  <i>converted value</i> to the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
                  of <i>value</i>.</li>
                <li>Otherwise, if the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
                  of <i>value</i> equals <code>xsd:boolean</code>, set
                  <i>converted value</i> to <a href="#dfn-true" title="true" class="tref internalDFN">true</a> if the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
                  of <i>value</i> matches <code>true</code>, or <a href="#dfn-false" title="false" class="tref internalDFN">false</a>
                  if it matches <code>false</code>. If it matches neither,
                  set <i>type</i> to <code>xsd:boolean</code>.</li>
                <li>Otherwise, if the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
                  of <i>value</i> equals <code>xsd:integer</code> or
                  <code>xsd:double</code> and its
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
                  is a valid <code>xsd:integer</code> or <code>xsd:double</code>
                  according [<cite><a href="#bib-XMLSCHEMA11-2" class="bibref">XMLSCHEMA11-2</a></cite>], set <i>converted value</i>
                  to the result of converting the
                  <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form" title="lexical-form" class="tref externalDFN">lexical form</a>
                  to a JSON <a href="#dfn-number" title="number" class="tref internalDFN">number</a>.</li>
              </ol>
            </li>
            <li>Otherwise, if <i>value</i> is a
              <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string" title="language-tagged-string" class="tref externalDFN">language-tagged string</a>
              add a member <code>@language</code> to <i>result</i> and set its value to the
              <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-language-tag" title="language-tag" class="tref externalDFN">language tag</a>
              of <i>value</i>.</li>
            <li>Otherwise, set <i>type</i> to the
              <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
              of <i>value</i>, unless it equals <code>xsd:string</code> which is ignored.</li>
            <li>Add a member <code>@value</code> to <i>result</i> whose value
              is set to <i>converted value</i>.</li>
            <li>If <i>type</i> is not <a href="#dfn-null" title="null" class="tref internalDFN">null</a>, add a member <code>@type</code>
              to <i>result</i> whose value is set to <i>type</i>.</li>
            <li>Return <i>result</i>.</li>
          </ol>
        </li>
      </ol>
    </section>
  </section>

  <section id="data-round-tripping">
    <h3 id="h3_data-round-tripping" role="heading" aria-level="2"><span class="secno">10.6 </span>Data Round Tripping</h3>

    <p>When <a href="#deserialize-json-ld-to-rdf-algorithm">deserializing JSON-LD to RDF</a>
      JSON-native <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a> are automatically
      type-coerced to <code>xsd:integer</code> or <code>xsd:double</code>
      depending on whether the <a href="#dfn-number" title="number" class="tref internalDFN">number</a> has a non-zero fractional part
      or not (the result of a modulo‑1 operation), the boolean values
      <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and <a href="#dfn-false" title="false" class="tref internalDFN">false</a> are coerced to <code>xsd:boolean</code>,
      and <a href="#dfn-string" title="string" class="tref internalDFN">strings</a> are coerced to <code>xsd:string</code>.
      The numeric or boolean values themselves are converted to
      <dfn id="dfn-canonical-lexical-form" title="canonical-lexical-form">canonical lexical form</dfn>, i.e., a deterministic string
      representation as defined in [<cite><a href="#bib-XMLSCHEMA11-2" class="bibref">XMLSCHEMA11-2</a></cite>].</p>

    <p>The <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> of an <em>integer</em>, i.e., a
      <a href="#dfn-number" title="number" class="tref internalDFN">number</a> with no non-zero fractional part or a <a href="#dfn-number" title="number" class="tref internalDFN">number</a>
      coerced to <code>xsd:integer</code>, is a finite-length sequence of decimal
      digits (<code>0-9</code>) with an optional leading minus sign; leading
      zeros are prohibited. In JavaScript, implementers can use the following
      snippet of code to convert an integer to
      <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a>:</p>

    <div class="example"><div class="example-title"><span>Example 12</span>: Sample integer serialization implementation in JavaScript</div><pre class="example">(value).toFixed(0).toString()</pre></div>

    <p>The <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> of a <em>double</em>, i.e., a
      <a href="#dfn-number" title="number" class="tref internalDFN">number</a> with a non-zero fractional part or a <a href="#dfn-number" title="number" class="tref internalDFN">number</a>
      coerced to <code>xsd:double</code>, consists of a mantissa followed by the
      character <code>E</code>, followed by an exponent. The mantissa is a
      decimal number and the exponent is an integer. Leading zeros and a
      preceding plus sign (<code>+</code>) are prohibited in the exponent.
      If the exponent is zero, it is indicated by <code>E0</code>. For the
      mantissa, the preceding optional plus sign is prohibited and the
      decimal point is required. Leading and trailing zeros are prohibited
      subject to the following: number representations must be normalized
      such that there is a single digit which is non-zero to the left of
      the decimal point and at least a single digit to the right of the
      decimal point unless the value being represented is zero. The
      canonical representation for zero is <code>0.0E0</code>.
      <code>xsd:double</code>'s value space is defined by the IEEE
      double-precision 64-bit floating point type [<cite><a href="#bib-IEEE-754-1985" class="bibref">IEEE-754-1985</a></cite>] whereas
      the value space of JSON <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a> is not
      specified; when deserializing JSON-LD to RDF the mantissa is rounded to
      15&nbsp;digits after the decimal point. In JavaScript, implementers
      can use the following snippet of code to convert a double to
      <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a>:</p>

    <div class="example"><div class="example-title"><span>Example 13</span>: Sample floating point number serialization implementation in JavaScript</div><pre class="example">(value).toExponential(15).replace(/(\d)0*e\+?/,'$1E')</pre></div>

    <p>The <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a> of the <em>boolean</em>
      values <a href="#dfn-true" title="true" class="tref internalDFN">true</a> and <a href="#dfn-false" title="false" class="tref internalDFN">false</a> are the strings
      <code>true</code> and <code>false</code>.</p>

    <p>When JSON-native <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a> are deserialized
      to RDF, lossless data round-tripping cannot be guaranteed, as rounding
      errors might occur. When
      <a href="#serialize-rdf-as-json-ld-algorithm">serializing RDF as JSON-LD</a>,
      similar rounding errors might occur. Furthermore, the datatype or the lexical
      representation might be lost. An <code>xsd:double</code> with a value
      of <code>2.0</code> will, e.g., result in an <code>xsd:integer</code>
      with a value of <code>2</code> in <a href="#dfn-canonical-lexical-form" title="canonical-lexical-form" class="tref internalDFN">canonical lexical form</a>
      when converted from RDF to JSON-LD and back to RDF. It is important
      to highlight that in practice it might be impossible to losslessly
      convert an <code>xsd:integer</code> to a <a href="#dfn-number" title="number" class="tref internalDFN">number</a> because
      its value space is not limited. While the JSON specification [<cite><a href="#bib-RFC4627" class="bibref">RFC4627</a></cite>]
      does not limit the value space of <a href="#dfn-number" title="number" class="tref internalDFN">numbers</a>
      either, concrete implementations typically do have a limited value
      space.</p>

    <p>To ensure lossless round-tripping the
      <a href="#serialize-rdf-as-json-ld-algorithm">Serialize RDF as JSON-LD algorithm</a>
      specifies a <i>use native types</i> flag which controls whether
      <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" title="rdf-literals" class="tref externalDFN">RDF literals</a>
      with a <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" title="datatype-iri" class="tref externalDFN">datatype <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
      equal to <code>xsd:integer</code>, <code>xsd:double</code>, or
      <code>xsd:boolean</code> are converted to their JSON-native
      counterparts. If the <i>use native types</i> flag is set to
      <a href="#dfn-false" title="false" class="tref internalDFN">false</a>, all literals remain in their original string
      representation.</p>

    <p>Some JSON serializers, such as PHP's native implementation in some versions,
      backslash-escape the forward slash character. For example, the value
      <code>http://example.com/</code> would be serialized as <code>http:\/\/example.com\/</code>.
      This is problematic as other JSON parsers might not understand those escaping characters.
      There is no need to backslash-escape forward slashes in JSON-LD. To aid
      interoperability between JSON-LD processors, forward slashes <em title="MUST NOT" class="rfc2119">MUST NOT</em> be
      backslash-escaped.</p>
  </section> <!-- end of Data Round Tripping -->
</section>


<section id="the-application-programming-interface" class="informative">
  <!--OddPage--><h2 id="h2_the-application-programming-interface" role="heading" aria-level="1"><span class="secno">11. </span>The Application Programming Interface</h2><p><em>This section is non-normative.</em></p>

  <p>This API provides a clean mechanism that enables developers to convert
    JSON-LD data into a variety of output formats that are often easier to
    work with.</p>

  <p>The JSON-LD API uses <a href="#dfn-promise" title="promise" class="tref internalDFN">Promises</a> to represent
    the result of the various asynchronous operations.
    <dfn id="dfn-promise" title="promise">Promises</dfn> are temporarily being drafted on
    <cite><a href="https://github.com/domenic/promises-unwrapping/blob/master/README.md">GitHub</a></cite>
    [<cite><a href="#bib-PROMISES" class="bibref">PROMISES</a></cite>] but are expected to be standardized as part of ECMAScript&nbsp;6.</p>

  <section id="the-jsonldprocessor-interface" class="informative">
    <h3 id="h3_the-jsonldprocessor-interface" role="heading" aria-level="2"><span class="secno">11.1 </span>The <a class="idlType" href="#idl-def-JsonLdProcessor"><code>JsonLdProcessor</code></a> Interface</h3><p><em>This section is non-normative.</em></p>

    <p>The <a class="idlType" href="#idl-def-JsonLdProcessor"><code>JsonLdProcessor</code></a> interface is the high-level programming structure
      that developers use to access the JSON-LD transformation methods.</p>

    <p>It is important to highlight that implementations do not modify the input parameters.
      If an error is detected, the Promise is
      rejected passing a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> with the corresponding error
      <code class="idlMemberName"><a href="#widl-JsonLdError-code">code</a></code>
      and processing is stopped.</p>

    <p>If the <code class="idlMemberName"><a href="#widl-JsonLdOptions-documentLoader">documentLoader</a></code>
      option is specified, it is used to dereference remote documents and contexts.
      The <code class="idlMemberName"><a href="#widl-RemoteDocument-documentUrl">documentUrl</a></code>
      in the returned <code class="idlMemberName"><a href="#idl-def-RemoteDocument">RemoteDocument</a></code>
      is used as <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> and the
      <code class="idlMemberName"><a href="#widl-RemoteDocument-contextUrl">contextUrl</a></code>
      is used instead of looking at the HTTP Link Header directly. For the sake of simplicity, none of the algorithms
      in this document mention this directly.</p>

    <pre class="idl"><span class="idlInterface" id="idl-def-JsonLdProcessor">[<span class="extAttr">Constructor</span>]
interface <span class="idlInterfaceID">JsonLdProcessor</span> {
<span class="idlMethod">    <span class="idlMethType"><a class="internalDFN" href="#dfn-promise">Promise</a></span> <span class="idlMethName"><a href="#widl-JsonLdProcessor-compact-Promise-any-input-JsonLdContext-context-JsonLdOptions-options">compact</a></span> (<span class="idlParam"><span class="idlParamType"><a>any</a></span> <span class="idlParamName">input</span></span>, <span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-JsonLdContext"><code>JsonLdContext</code></a></span> <span class="idlParamName">context</span></span>, <span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></span> <span class="idlParamName">options</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a class="internalDFN" href="#dfn-promise">Promise</a></span> <span class="idlMethName"><a href="#widl-JsonLdProcessor-expand-Promise-any-input-JsonLdOptions-options">expand</a></span> (<span class="idlParam"><span class="idlParamType"><a>any</a></span> <span class="idlParamName">input</span></span>, <span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></span> <span class="idlParamName">options</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a class="internalDFN" href="#dfn-promise">Promise</a></span> <span class="idlMethName"><a href="#widl-JsonLdProcessor-flatten-Promise-any-input-JsonLdContext-context-JsonLdOptions-options">flatten</a></span> (<span class="idlParam"><span class="idlParamType"><a>any</a></span> <span class="idlParamName">input</span></span>, <span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-JsonLdContext"><code>JsonLdContext</code></a>?</span> <span class="idlParamName">context</span></span>, <span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></span> <span class="idlParamName">options</span></span>);</span>
};</span></pre><section><h4 role="heading" aria-level="3" id="methods">Methods</h4><p><em>This section is non-normative.</em></p><dl class="methods"><dt id="widl-JsonLdProcessor-compact-Promise-any-input-JsonLdContext-context-JsonLdOptions-options"><code>compact</code></dt><dd>
        <p><a href="#compaction">Compacts</a> the given <i>input</i> using the
          <i>context</i> according to the steps in the
          <a href="#compaction-algorithm">Compaction algorithm</a>:</p>

        <ol class="algorithm">
          <li>Create a new <a href="#dfn-promise" title="promise" class="tref internalDFN">Promise</a> <i>promise</i> and return it. The
            following steps are then executed asynchronously.</li>
          <li>If the passed <i>input</i> is a <span class="idlParamType">DOMString</span>
            representing the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> of a remote document, dereference it.
            If the retrieved document's content type is neither <code>application/json</code>,
            nor <code>application/ld+json</code>, nor any other media type using a
            <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>]
            or if the document cannot be parsed as JSON, reject the <i>promise</i> passing an
            <code class="error"><a href="#idl-def-JsonLdErrorCode.loading-document-failed">loading document failed</a></code>
            error.</li>
          <li>Initialize a new empty <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. The <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
            of the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is set to the <abbr title="Internationalized Resource Identifier">IRI</abbr> of the currently being processed
            document, if available; otherwise to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If set, the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-base">base</a></code> option
            overrides the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
          <li>If an
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            has been passed, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. If
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> having a <code>@context</code> member, pass that member's value instead.</li>
          <li>If the <i>input</i> has been retrieved, the response has an HTTP Link Header [<cite><a href="#bib-RFC5988" class="bibref">RFC5988</a></cite>]
            using the <code>http://www.w3.org/ns/json-ld#context</code> link relation
            and a content type of <code>application/json</code> or any media type
            with a <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>] except
            <code>application/ld+json</code>, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            context referenced in the HTTP Link Header as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. The
            HTTP Link Header is ignored for documents served as <code>application/ld+json</code> If
            multiple HTTP Link Headers using the <code>http://www.w3.org/ns/json-ld#context</code>
            link relation are found, the <i>promise</i> is rejected with a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> whose code is set to
            <code class="error"><a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</a></code>
            and processing is terminated.</li>
          <li>Set <i>expanded</i> to the result of using the
            <a href="#expansion-algorithm">Expansion algorithm</a>, passing the
            <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and <i>input</i> as <i>element</i>.</li>
          <li>If <i>context</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> having a <code>@context</code> member, set
            <i>context</i> to that member's value.</li>
          <li>Set <i>compacted</i> to the result of using the
            <a href="#compaction-algorithm">Compaction algorithm</a>, passing
            <i>context</i>, <i>expanded</i> as <i>element</i>, and if passed, the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
            flag in <i>options</i>.</li>
          <li>Fulfill the <i>promise</i> passing <i>compacted</i>.</li>
        </ol>


      <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">input</td><td class="prmType"><code><a>any</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc">The JSON-LD object or array of JSON-LD objects to perform the compaction upon or an
            <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> referencing the JSON-LD document to compact.</td></tr><tr><td class="prmName">context</td><td class="prmType"><code><a class="idlType" href="#idl-def-JsonLdContext"><code>JsonLdContext</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc">The context to use when compacting the <code>input</code>;
            it can be specified by using a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, an
            <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, or an array consisting of
            <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>s and <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>s.</td></tr><tr><td class="prmName">options</td><td class="prmType"><code><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc">A set of options to configure the algorithms. This allows, e.g.,
            to set the input document's base <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</td></tr></table><div><em>Return type: </em><code><a class="internalDFN" href="#dfn-promise">Promise</a></code></div></dd><dt id="widl-JsonLdProcessor-expand-Promise-any-input-JsonLdOptions-options"><code>expand</code></dt><dd>
        <p><a href="#expansion">Expands</a> the given <i>input</i> according to
          the steps in the <a href="#expansion-algorithm">Expansion algorithm</a>:</p>

        <ol class="algorithm">
          <li>Create a new <a href="#dfn-promise" title="promise" class="tref internalDFN">Promise</a> <i>promise</i> and return it. The
            following steps are then executed asynchronously.</li>
          <li>If the passed <i>input</i> is a <span class="idlParamType">DOMString</span>
            representing the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> of a remote document, dereference it.
            If the retrieved document's content type is neither <code>application/json</code>,
            nor <code>application/ld+json</code>, nor any other media type using a
            <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>], reject the <i>promise</i> passing an
            <code class="error"><a href="#idl-def-JsonLdErrorCode.loading-document-failed">loading document failed</a></code>
            error.</li>
          <li>Initialize a new empty <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. The <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
            of the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is set to the <abbr title="Internationalized Resource Identifier">IRI</abbr> of the currently being processed
            document, if available; otherwise to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If set, the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-base">base</a></code> option
            overrides the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
          <li>If an
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            has been passed, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. If
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> having a <code>@context</code> member, pass that member's value instead.</li>
          <li>If the <i>input</i> has been retrieved, the response has an HTTP Link Header [<cite><a href="#bib-RFC5988" class="bibref">RFC5988</a></cite>]
            using the <code>http://www.w3.org/ns/json-ld#context</code> link relation
            and a content type of <code>application/json</code> or any media type
            with a <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>] except
            <code>application/ld+json</code>, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            context referenced in the HTTP Link Header as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. The
            HTTP Link Header is ignored for documents served as <code>application/ld+json</code> If
            multiple HTTP Link Headers using the <code>http://www.w3.org/ns/json-ld#context</code>
            link relation are found, the <i>promise</i> is rejected with a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> whose code is set to
            <code class="error"><a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</a></code>
            and processing is terminated.</li>
          <li>Set <i>expanded</i> to the result of using the
            <a href="#expansion-algorithm">Expansion algorithm</a>, passing the
            <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and <i>input</i> as <i>element</i>.</li>
          <li>Fulfill the <i>promise</i> passing <i>expanded</i>.</li>
        </ol>


      <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">input</td><td class="prmType"><code><a>any</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc">The JSON-LD object or array of JSON-LD objects to perform the expansion upon or an
            <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> referencing the JSON-LD document to expand.</td></tr><tr><td class="prmName">options</td><td class="prmType"><code><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc">A set of options to configure the used algorithms such. This allows, e.g.,
            to set the input document's base <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</td></tr></table><div><em>Return type: </em><code><a class="internalDFN" href="#dfn-promise">Promise</a></code></div></dd><dt id="widl-JsonLdProcessor-flatten-Promise-any-input-JsonLdContext-context-JsonLdOptions-options"><code>flatten</code></dt><dd>
        <p><a href="#flattening">Flattens</a> the given <i>input</i> and
          <a href="#compaction">compacts</a> it using the passed <i>context</i>
          according to the steps in the <a href="#flattening-algorithm">Flattening algorithm</a>:</p>

        <ol class="algorithm">
          <li>Create a new <a href="#dfn-promise" title="promise" class="tref internalDFN">Promise</a> <i>promise</i> and return it. The
            following steps are then executed asynchronously.</li>
          <li>If the passed <i>input</i> is a <span class="idlParamType">DOMString</span>
            representing the <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> of a remote document, dereference it.
            If the retrieved document's content type is neither <code>application/json</code>,
            nor <code>application/ld+json</code>, nor any other media type using a
            <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>], reject the <i>promise</i> passing an
            <code class="error"><a href="#idl-def-JsonLdErrorCode.loading-document-failed">loading document failed</a></code>
            error.</li>
          <li>Initialize a new empty <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a>. The <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>
            of the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> is set to the <abbr title="Internationalized Resource Identifier">IRI</abbr> of the currently being processed
            document, if available; otherwise to <a href="#dfn-null" title="null" class="tref internalDFN">null</a>. If set, the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-base">base</a></code> option
            overrides the <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</li>
          <li>If an
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            has been passed, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. If
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></code>
            is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> having a <code>@context</code> member, pass that member's value instead.</li>
          <li>If the <i>input</i> has been retrieved, the response has an HTTP Link Header [<cite><a href="#bib-RFC5988" class="bibref">RFC5988</a></cite>]
            using the <code>http://www.w3.org/ns/json-ld#context</code> link relation
            and a content type of <code>application/json</code> or any media type
            with a <code>+json</code> suffix as defined in [<cite><a href="#bib-RFC6839" class="bibref">RFC6839</a></cite>] except
            <code>application/ld+json</code>, update the <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> using the
            <a href="#context-processing-algorithm">Context Processing algorithm</a>, passing the
            context referenced in the HTTP Link Header as <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a>. The
            HTTP Link Header is ignored for documents served as <code>application/ld+json</code> If
            multiple HTTP Link Headers using the <code>http://www.w3.org/ns/json-ld#context</code>
            link relation are found, the <i>promise</i> is rejected with a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> whose code is set to
            <code class="error"><a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</a></code>
            and processing is terminated.</li>
          <li>Set <i>expanded</i> to the result of using the
            <a href="#expansion-algorithm">Expansion algorithm</a>, passing the
            <a href="#dfn-active-context" title="active-context" class="tref internalDFN">active context</a> and <i>input</i> as <i>element</i>.</li>
          <li>If <i>context</i> is a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a> having a <code>@context</code> member, set
            <i>context</i> to that member's value.</li>
          <li>Initialize an empty <i>identifier map</i> and a <i>counter</i> (set to <code>0</code>)
            to be used by the
            <a href="#generate-blank-node-identifier">Generate Blank Node Identifier algorithm</a>.</li>
          <li>Set <i>flattened</i> to the result of using the
            <a href="#flattening-algorithm">Flattening algorithm</a>, passing
            <i>expanded</i> as <i>element</i>, <i>context</i>, and if passed, the
            <code class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></code>
            flag in <i>options</i> (which is internally passed to the
            <a href="#compaction-algorithm">Compaction algorithm</a>).</li>
          <li>Fulfill the <i>promise</i> passing <i>flattened</i>.</li>
        </ol>


      <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">input</td><td class="prmType"><code><a>any</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc">The JSON-LD object or array of JSON-LD objects or an <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>
            referencing the JSON-LD document to flatten.</td></tr><tr><td class="prmName">context</td><td class="prmType"><code><a class="idlType" href="#idl-def-JsonLdContext"><code>JsonLdContext</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptTrue">✔</td><td class="prmDesc">The context to use when compacting the flattened <code>input</code>;
            it can be specified by using a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, an
            <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, or an array consisting of <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>s
            and <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>s. If not
            passed or <a href="#dfn-null" title="null" class="tref internalDFN">null</a> is passed, the result will not be compacted
            but kept in expanded form.</td></tr><tr><td class="prmName">options</td><td class="prmType"><code><a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc">A set of options to configure the used algorithms such. This allows, e.g.,
            to set the input document's base <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</td></tr></table><div><em>Return type: </em><code><a class="internalDFN" href="#dfn-promise">Promise</a></code></div></dd></dl></section>

    <pre class="idl"><span class="idlTypedef" id="idl-def-JsonLdContext">typedef <span class="idlTypedefType">(<a>object</a> or <a>DOMString</a> or <a>(object</a> or <a>DOMString[])</a>)</span> <span class="idlTypedefID">JsonLdContext</span>;</span></pre><div class="idlTypedefDesc">
      <p>The <a class="idlType" href="#idl-def-JsonLdContext"><code>JsonLdContext</code></a> type is used to refer to a value that
        that may be a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>, a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> representing an
        <a href="#dfn-iri" title="iri" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, or an array of <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON objects</a>
        and <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>.</p>
    </div>
  </section> <!-- end of JsonLdProcessor -->

  <section id="the-jsonldoptions-type" class="informative">
    <h3 id="h3_the-jsonldoptions-type" role="heading" aria-level="2"><span class="secno">11.2 </span>The <a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a> Type</h3><p><em>This section is non-normative.</em></p>

    <p>The <a class="idlType" href="#idl-def-JsonLdOptions"><code>JsonLdOptions</code></a> type is used to pass various options to the
      <a class="idlType" href="#idl-def-JsonLdProcessor"><code>JsonLdProcessor</code></a> methods.</p>

    <pre class="idl"><span class="idlDictionary" id="idl-def-JsonLdOptions">dictionary <span class="idlDictionaryID">JsonLdOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a>?</span>             <span class="idlMemberName"><a href="#widl-JsonLdOptions-base">base</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a></span>                <span class="idlMemberName"><a href="#widl-JsonLdOptions-compactArrays">compactArrays</a></span> = <span class="idlMemberValue">true</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a class="idlType" href="#idl-def-LoadDocumentCallback"><code>LoadDocumentCallback</code></a></span>   <span class="idlMemberName"><a href="#widl-JsonLdOptions-documentLoader">documentLoader</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>object?</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-JsonLdOptions-expandContext">expandContext</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>              <span class="idlMemberName"><a href="#widl-JsonLdOptions-processingMode">processingMode</a></span> = <span class="idlMemberValue">"json-ld-1.0"</span>;</span>
};</span></pre><section><h4 role="heading" aria-level="3" id="dictionary-jsonldoptions-members">Dictionary <a href="#idl-def-JsonLdOptions" class="idlType"><code>JsonLdOptions</code></a> Members</h4><p><em>This section is non-normative.</em></p><dl class="dictionary-members"><dt id="widl-JsonLdOptions-base"><code>base</code> of type <span class="idlMemberType"><a>DOMString</a></span>, nullable</dt><dd>The base <abbr title="Internationalized Resource Identifier">IRI</abbr> to use when expanding or compacting the document. If set, this overrides
        the input document's <abbr title="Internationalized Resource Identifier">IRI</abbr>.</dd><dt id="widl-JsonLdOptions-compactArrays"><code>compactArrays</code> of type <span class="idlMemberType"><a>boolean</a></span>, defaulting to <code>true</code></dt><dd>If set to <code>true</code>, the JSON-LD processor replaces arrays with just
        one element with that element during compaction. If set to <code>false</code>,
        all arrays will remain arrays even if they have just one element.
      </dd><dt id="widl-JsonLdOptions-documentLoader"><code>documentLoader</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-LoadDocumentCallback"><code>LoadDocumentCallback</code></a></span>, defaulting to <code>null</code></dt><dd>The callback of the loader to be used to retrieve remote documents and contexts.
        If specified, it is used to retrieve remote documents and contexts; otherwise,
        if not specified, the processor's built-in loader is used.</dd><dt id="widl-JsonLdOptions-expandContext"><code>expandContext</code> of type <span class="idlMemberType"><a>(object? or DOMString)</a></span>, defaulting to <code>null</code></dt><dd>A context that is used to initialize the active context when expanding a document.</dd><dt id="widl-JsonLdOptions-processingMode"><code>processingMode</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"json-ld-1.0"</code></dt><dd>If set to <code>json-ld-1.0</code>, the implementation has to produce
        exactly the same results as the algorithms defined in this specification.
        If set to another value, the JSON-LD processor is allowed to extend
        or modify the algorithms defined in this specification to enable
        application-specific optimizations. The definition of such
        optimizations is beyond the scope of this specification and thus
        not defined. Consequently, different implementations may implement
        different optimizations. Developers must not define modes beginning
        with <code>json-ld</code> as they are reserved for future versions
        of this specification.</dd></dl></section>
  </section> <!-- end JsonLdOptions -->

  <section id="remote-document-and-context-retrieval" class="informative">
    <h3 id="h3_remote-document-and-context-retrieval" role="heading" aria-level="2"><span class="secno">11.3 </span>Remote Document and Context Retrieval</h3><p><em>This section is non-normative.</em></p>

    <p>Users of an API implementation can utilize a callback to control how remote
      documents and contexts are retrieved. This section details the parameters of
      that callback and the data structure used to return the retrieved context.</p>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="loaddocumentcallback">LoadDocumentCallback</h4><p><em>This section is non-normative.</em></p>

      <p>The <a class="idlType" href="#idl-def-LoadDocumentCallback"><code>LoadDocumentCallback</code></a> defines a callback that custom document loaders
        have to implement to be used to retrieve remote documents and contexts.</p>

      <pre class="idl"><span class="idlCallback" id="idl-def-LoadDocumentCallback">callback <span class="idlCallbackID">LoadDocumentCallback</span> = <span class="idlCallbackType"><a class="internalDFN" href="#dfn-promise">Promise</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">url</span></span>);</span></pre><section><h5 role="heading" aria-level="4" id="callback-loaddocumentcallback-parameters">Callback <a href="#idl-def-LoadDocumentCallback" class="idlType"><code>LoadDocumentCallback</code></a> Parameters</h5><p><em>This section is non-normative.</em></p><dl class="callback-members"><dt id="widl-LoadDocumentCallback-url"><code>url</code> of type <span class="idlMemberType"><a>DOMString</a></span></dt><dd>The URL of the remote document or context to load.</dd></dl></section>

      <p>All errors result in the <a href="#dfn-promise" title="promise" class="tref internalDFN">Promise</a> being rejected with
        a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> whose code is set to
        <code class="error"><a href="#idl-def-JsonLdErrorCode.loading-document-failed">loading document failed</a></code>
        or <code class="error"><a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</a></code>
        as described in the next section.</p>
    </section>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="remotedocument">RemoteDocument</h4><p><em>This section is non-normative.</em></p>

      <p>The <a class="idlType" href="#idl-def-RemoteDocument"><code>RemoteDocument</code></a> type is used by a <a class="idlType" href="#idl-def-LoadDocumentCallback"><code>LoadDocumentCallback</code></a>
        to return information about a remote document or context.</p>

      <pre class="idl"><span class="idlDictionary" id="idl-def-RemoteDocument">dictionary <span class="idlDictionaryID">RemoteDocument</span> {
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span> <span class="idlMemberName"><a href="#widl-RemoteDocument-contextUrl">contextUrl</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span> <span class="idlMemberName"><a href="#widl-RemoteDocument-documentUrl">documentUrl</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>any</a></span>       <span class="idlMemberName"><a href="#widl-RemoteDocument-document">document</a></span>;</span>
};</span></pre><section><h5 role="heading" aria-level="4" id="dictionary-remotedocument-members">Dictionary <a href="#idl-def-RemoteDocument" class="idlType"><code>RemoteDocument</code></a> Members</h5><p><em>This section is non-normative.</em></p><dl class="dictionary-members"><dt id="widl-RemoteDocument-contextUrl"><code>contextUrl</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>null</code></dt><dd>If available, the value of the HTTP Link Header [<cite><a href="#bib-RFC5988" class="bibref">RFC5988</a></cite>] using the
          <code>http://www.w3.org/ns/json-ld#context</code> link relation in the
          response. If the response's content type is <code>application/ld+json</code>,
          the HTTP Link Header is ignored. If multiple HTTP Link Headers using
          the <code>http://www.w3.org/ns/json-ld#context</code> link relation are found,
          the <a href="#dfn-promise" title="promise" class="tref internalDFN">Promise</a> of the <a class="idlType" href="#idl-def-LoadDocumentCallback"><code>LoadDocumentCallback</code></a> is rejected with
          a <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> whose code is set to
          <code class="error"><a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</a></code>.</dd><dt id="widl-RemoteDocument-document"><code>document</code> of type <span class="idlMemberType"><a>any</a></span></dt><dd>The retrieved document. This can either be the raw payload or the already
          parsed document.</dd><dt id="widl-RemoteDocument-documentUrl"><code>documentUrl</code> of type <span class="idlMemberType"><a>DOMString</a></span></dt><dd>The final URL of the loaded document. This is important
          to handle HTTP redirects properly.</dd></dl></section>
    </section>
  </section> <!-- end of Remote Document and Context Retrieval -->

  <section id="error-handling" class="informative">
    <h3 id="h3_error-handling" role="heading" aria-level="2"><span class="secno">11.4 </span>Error Handling</h3><p><em>This section is non-normative.</em></p>

    <p>This section describes the datatype definitions used within the
      JSON-LD API for error handling.</p>

    <section>
      <h4 role="heading" aria-level="3" id="jsonlderror">JsonLdError</h4><p><em>This section is non-normative.</em></p>

      <p>The <a class="idlType" href="#idl-def-JsonLdError"><code>JsonLdError</code></a> type is used to report processing errors.</p>

      <pre class="idl"><span class="idlDictionary" id="idl-def-JsonLdError">dictionary <span class="idlDictionaryID">JsonLdError</span> {
<span class="idlMember">    <span class="idlMemberType"><a class="idlType" href="#idl-def-JsonLdErrorCode"><code>JsonLdErrorCode</code></a></span> <span class="idlMemberName"><a href="#widl-JsonLdError-code">code</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a>?</span>      <span class="idlMemberName"><a href="#widl-JsonLdError-message">message</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span></pre><section><h5 role="heading" aria-level="4" id="dictionary-jsonlderror-members">Dictionary <a href="#idl-def-JsonLdError" class="idlType"><code>JsonLdError</code></a> Members</h5><p><em>This section is non-normative.</em></p><dl class="dictionary-members"><dt id="widl-JsonLdError-code"><code>code</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-JsonLdErrorCode"><code>JsonLdErrorCode</code></a></span></dt><dd>a string representing the particular error type, as described in
          the various algorithms in this document.</dd><dt id="widl-JsonLdError-message"><code>message</code> of type <span class="idlMemberType"><a>DOMString</a></span>, nullable, defaulting to <code>null</code></dt><dd>an optional error message containing additional debugging information.
          The specific contents of error messages are outside the scope of this
          specification.</dd></dl></section>
    </section>

    <section class="informative">
      <h4 role="heading" aria-level="3" id="jsonlderrorcode">JsonLdErrorCode</h4><p><em>This section is non-normative.</em></p>
      <p>The <a class="idlType" href="#idl-def-JsonLdErrorCode"><code>JsonLdErrorCode</code></a> represents the collection of valid JSON-LD error
        codes.</p>

      <pre class="idl"><span class="idlEnum" id="idl-def-JsonLdErrorCode">enum <span class="idlEnumID">JsonLdErrorCode</span> {
    "<a href="#idl-def-JsonLdErrorCode.loading-document-failed" class="idlEnumItem">loading document failed</a>",
    "<a href="#idl-def-JsonLdErrorCode.list-of-lists" class="idlEnumItem">list of lists</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid--index-value" class="idlEnumItem">invalid @index value</a>",
    "<a href="#idl-def-JsonLdErrorCode.conflicting-indexes" class="idlEnumItem">conflicting indexes</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid--id-value" class="idlEnumItem">invalid @id value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-local-context" class="idlEnumItem">invalid local context</a>",
    "<a href="#idl-def-JsonLdErrorCode.multiple-context-link-headers" class="idlEnumItem">multiple context link headers</a>",
    "<a href="#idl-def-JsonLdErrorCode.loading-remote-context-failed" class="idlEnumItem">loading remote context failed</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-remote-context" class="idlEnumItem">invalid remote context</a>",
    "<a href="#idl-def-JsonLdErrorCode.recursive-context-inclusion" class="idlEnumItem">recursive context inclusion</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-base-IRI" class="idlEnumItem">invalid base IRI</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-vocab-mapping" class="idlEnumItem">invalid vocab mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-default-language" class="idlEnumItem">invalid default language</a>",
    "<a href="#idl-def-JsonLdErrorCode.keyword-redefinition" class="idlEnumItem">keyword redefinition</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-term-definition" class="idlEnumItem">invalid term definition</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-reverse-property" class="idlEnumItem">invalid reverse property</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-IRI-mapping" class="idlEnumItem">invalid IRI mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.cyclic-IRI-mapping" class="idlEnumItem">cyclic IRI mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-keyword-alias" class="idlEnumItem">invalid keyword alias</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-type-mapping" class="idlEnumItem">invalid type mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-language-mapping" class="idlEnumItem">invalid language mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.colliding-keywords" class="idlEnumItem">colliding keywords</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-container-mapping" class="idlEnumItem">invalid container mapping</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-type-value" class="idlEnumItem">invalid type value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-value-object" class="idlEnumItem">invalid value object</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-value-object-value" class="idlEnumItem">invalid value object value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-language-tagged-string" class="idlEnumItem">invalid language-tagged string</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-language-tagged-value" class="idlEnumItem">invalid language-tagged value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-typed-value" class="idlEnumItem">invalid typed value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-set-or-list-object" class="idlEnumItem">invalid set or list object</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-language-map-value" class="idlEnumItem">invalid language map value</a>",
    "<a href="#idl-def-JsonLdErrorCode.compaction-to-list-of-lists" class="idlEnumItem">compaction to list of lists</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-reverse-property-map" class="idlEnumItem">invalid reverse property map</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid--reverse-value" class="idlEnumItem">invalid @reverse value</a>",
    "<a href="#idl-def-JsonLdErrorCode.invalid-reverse-property-value" class="idlEnumItem">invalid reverse property value</a>"
};</span></pre><table class="simple"><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-JsonLdErrorCode.loading-document-failed">loading document failed</code></td><td>The document could not be loaded or parsed as JSON.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.list-of-lists">list of lists</code></td><td>A list of lists was detected. List of lists are not supported in
          this version of JSON-LD due to the algorithmic complexity.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid--index-value">invalid @index value</code></td><td>An <code>@index</code> member was encountered whose value was
          not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.conflicting-indexes">conflicting indexes</code></td><td>Multiple conflicting indexes have been found for the same node.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid--id-value">invalid @id value</code></td><td>An <code>@id</code> member was encountered whose value was not a
          <a href="#dfn-string" title="string" class="tref internalDFN">string</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-local-context">invalid local context</code></td><td>In invalid <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> was detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.multiple-context-link-headers">multiple context link headers</code></td><td>Multiple HTTP Link Headers [<cite><a href="#bib-RFC5988" class="bibref">RFC5988</a></cite>] using the
          <code>http://www.w3.org/ns/json-ld#context</code> link relation
          have been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.loading-remote-context-failed">loading remote context failed</code></td><td>There was a problem encountered loading a remote context.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-remote-context">invalid remote context</code></td><td>No valid context document has been found for a referenced,
         remote context.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.recursive-context-inclusion">recursive context inclusion</code></td><td>A cycle in remote context inclusions has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-base-IRI">invalid base IRI</code></td><td>An invalid <a href="#dfn-base-iri" title="base-iri" class="tref internalDFN">base <abbr title="Internationalized Resource Identifier">IRI</abbr></a> has been detected, i.e., it is
          neither an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> nor <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-vocab-mapping">invalid vocab mapping</code></td><td>An invalid <a href="#dfn-vocabulary-mapping" title="vocabulary-mapping" class="tref internalDFN">vocabulary mapping</a> has been detected, i.e.,
          it is neither an <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a> nor <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-default-language">invalid default language</code></td><td>The value of the <a href="#dfn-default-language" title="default-language" class="tref internalDFN">default language</a> is not a <a href="#dfn-string" title="string" class="tref internalDFN">string</a>
          or <a href="#dfn-null" title="null" class="tref internalDFN">null</a> and thus invalid.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.keyword-redefinition">keyword redefinition</code></td><td>A <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> redefinition has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-term-definition">invalid term definition</code></td><td>An invalid <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a> has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-reverse-property">invalid reverse property</code></td><td>An invalid reverse property definition has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-IRI-mapping">invalid IRI mapping</code></td><td>A <a href="#dfn-local-context" title="local-context" class="tref internalDFN">local context</a> contains a <a href="#dfn-term" title="term" class="tref internalDFN">term</a> that has
          an invalid or missing <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mapping</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.cyclic-IRI-mapping">cyclic IRI mapping</code></td><td>A cycle in <a href="#dfn-iri-mapping" title="iri-mapping" class="tref internalDFN"><abbr title="Internationalized Resource Identifier">IRI</abbr> mappings</a> has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-keyword-alias">invalid keyword alias</code></td><td>An invalid <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> alias definition has been
          encountered.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-type-mapping">invalid type mapping</code></td><td>An <code>@type</code> member in a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
          was encountered whose value could not be expanded to an
          <a href="#dfn-absolute-iri" title="absolute-iri" class="tref internalDFN">absolute <abbr title="Internationalized Resource Identifier">IRI</abbr></a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-language-mapping">invalid language mapping</code></td><td>An <code>@language</code> member in a <a href="#dfn-term-definition" title="term-definition" class="tref internalDFN">term definition</a>
          was encountered whose value was neither a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> nor
          <a href="#dfn-null" title="null" class="tref internalDFN">null</a> and thus invalid.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.colliding-keywords">colliding keywords</code></td><td>Two properties which expand to the same keyword have been detected.
          This might occur if a <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keyword</a> and an alias thereof
          are used at the same time.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-container-mapping">invalid container mapping</code></td><td>An <code>@container</code> member was encountered whose value was
          not one of the following <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>:
          <code>@list</code>, <code>@set</code>, or <code>@index</code>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-type-value">invalid type value</code></td><td>An invalid value for an <code>@type</code> member has been detected,
          i.e., the value was neither a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> nor an <a href="#dfn-array" title="array" class="tref internalDFN">array</a>
          of <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-value-object">invalid value object</code></td><td>A <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> with disallowed members has been
          detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-value-object-value">invalid value object value</code></td><td>An invalid value for the <code>@value</code> member of a
          <a href="#dfn-value-object" title="value-object" class="tref internalDFN">value object</a> has been detected, i.e., it is neither
          a <a href="#dfn-scalar" title="scalar" class="tref internalDFN">scalar</a> nor <a href="#dfn-null" title="null" class="tref internalDFN">null</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-language-tagged-string">invalid language-tagged string</code></td><td>A <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string" title="language-tagged-string" class="tref internalDFN">language-tagged string</a> with an invalid language
          value was detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-language-tagged-value">invalid language-tagged value</code></td><td>A <a href="#dfn-number" title="number" class="tref internalDFN">number</a>, <a href="#dfn-true" title="true" class="tref internalDFN">true</a>, or <a href="#dfn-false" title="false" class="tref internalDFN">false</a> with an
          associated language tag was detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-typed-value">invalid typed value</code></td><td>A <a href="#dfn-typed-value" title="typed-value" class="tref internalDFN">typed value</a> with an invalid type was detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-set-or-list-object">invalid set or list object</code></td><td>A <a href="#dfn-set-object" title="set-object" class="tref internalDFN">set object</a> or <a href="#dfn-list-object" title="list-object" class="tref internalDFN">list object</a> with
          disallowed members has been detected.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-language-map-value">invalid language map value</code></td><td>An invalid value in a <a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/#dfn-language-map" title="language-map" class="tref externalDFN">language map</a>
          has been detected. It has to be a <a href="#dfn-string" title="string" class="tref internalDFN">string</a> or an <a href="#dfn-array" title="array" class="tref internalDFN">array</a> of
          <a href="#dfn-string" title="string" class="tref internalDFN">strings</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.compaction-to-list-of-lists">compaction to list of lists</code></td><td>The compacted document contains a list of lists as multiple
          lists have been compacted to the same term.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-reverse-property-map">invalid reverse property map</code></td><td>An invalid reverse property map has been detected. No
          <a href="#dfn-keyword" title="keyword" class="tref internalDFN">keywords</a> apart from <code>@context</code>
          are allowed in reverse property maps.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid--reverse-value">invalid @reverse value</code></td><td>An invalid value for an <code>@reverse</code> member has been detected,
          i.e., the value was not a <a href="#dfn-json-object" title="json-object" class="tref internalDFN">JSON object</a>.</td></tr><tr><td><code id="idl-def-JsonLdErrorCode.invalid-reverse-property-value">invalid reverse property value</code></td><td>An invalid value for a reverse property has been detected. The value of an inverse
          property must be a <a href="#dfn-node-object" title="node-object" class="tref internalDFN">node object</a>.</td></tr></table>
    </section>
  </section> <!-- end of Error Handling -->
</section> <!-- end of The Application Programming Interfaces -->

<section id="acknowledgements" class="appendix informative">
  <!--OddPage--><h2 id="h2_acknowledgements" role="heading" aria-level="1"><span class="secno">A. </span>Acknowledgements</h2><p><em>This section is non-normative.</em></p>

  <p>A large amount of thanks goes out to the JSON-LD Community Group
    participants who worked through many of the technical issues on the mailing
    list and the weekly telecons - of special mention are Niklas Lindström,
    François Daoust, Lin Clark, and Zdenko 'Denny' Vrandečić.
    The editors would like to thank Mark Birbeck, who provided a great deal of
    the initial push behind the JSON-LD work via his work on RDFj.
    The work of Dave Lehn and Mike Johnson are appreciated for reviewing,
    and performing several implementations of the specification. Ian Davis is
    thanked for his work on RDF/JSON. Thanks also to Nathan Rixham,
    Bradley P. Allen, Kingsley Idehen, Glenn McDonald, Alexandre Passant,
    Danny Ayers, Ted Thibodeau Jr., Olivier Grisel, Josh Mandel, Eric Prud'hommeaux,
    David Wood, Guus Schreiber, Pat Hayes, Sandro Hawke, and Richard Cyganiak
    for their input on the specification.</p>
</section>



<section rel="bibo:chapter" resource="#references" typeof="bibo:Chapter" class="appendix" id="references"><!--OddPage--><h2 id="h2_references" role="heading" aria-level="1"><span class="secno">B. </span>References</h2><section rel="bibo:chapter" resource="#normative-references" typeof="bibo:Chapter" id="normative-references"><h3 id="h3_normative-references" role="heading" aria-level="2"><span class="secno">B.1 </span>Normative references</h3><dl about="" class="bibliography"><dt id="bib-IEEE-754-1985">[IEEE-754-1985]</dt><dd rel="dcterms:requires">IEEE. <cite>IEEE Standard for Binary Floating-Point Arithmetic.</cite> URL: <a href="http://standards.ieee.org/reading/ieee/std_public/description/busarch/754-1985_desc.html">http://standards.ieee.org/reading/ieee/std_public/description/busarch/754-1985_desc.html</a>
</dd><dt id="bib-JSON-LD">[JSON-LD]</dt><dd rel="dcterms:requires">Manu Sporny, Gregg Kellogg, Markus Lanthaler, Editors. <cite><a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/">JSON-LD 1.0</a>.</cite> 5 November 2013. W3C Proposed Recommendation. URL: <a href="http://www.w3.org/TR/2013/PR-json-ld-20131105/">http://www.w3.org/TR/2013/PR-json-ld-20131105/</a>. The latest edition is available at <a href="http://www.w3.org/TR/json-ld/">http://www.w3.org/TR/json-ld/</a>
</dd><dt id="bib-RDF-MT">[RDF-MT]</dt><dd rel="dcterms:requires">Patrick Hayes. <a href="http://www.w3.org/TR/rdf-mt/"><cite>RDF Semantics</cite></a>. 10 February 2004. W3C Recommendation. URL: <a href="http://www.w3.org/TR/rdf-mt/">http://www.w3.org/TR/rdf-mt/</a>
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd rel="dcterms:requires">S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>
</dd><dt id="bib-RFC3986">[RFC3986]</dt><dd rel="dcterms:requires">T. Berners-Lee; R. Fielding; L. Masinter. <a href="http://www.ietf.org/rfc/rfc3986.txt"><cite>Uniform Resource Identifier (URI): Generic Syntax (RFC 3986)</cite></a>. January 2005. RFC. URL: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>
</dd><dt id="bib-RFC3987">[RFC3987]</dt><dd rel="dcterms:requires">M. Dürst; M. Suignard. <a href="http://www.ietf.org/rfc/rfc3987.txt"><cite>Internationalized Resource Identifiers (IRIs)</cite></a>. January 2005. RFC. URL: <a href="http://www.ietf.org/rfc/rfc3987.txt">http://www.ietf.org/rfc/rfc3987.txt</a>
</dd><dt id="bib-RFC4627">[RFC4627]</dt><dd rel="dcterms:requires">D. Crockford. <a href="http://www.ietf.org/rfc/rfc4627.txt"><cite>The application/json Media Type for JavaScript Object Notation (JSON) (RFC 4627)</cite></a>. July 2006. RFC. URL: <a href="http://www.ietf.org/rfc/rfc4627.txt">http://www.ietf.org/rfc/rfc4627.txt</a>
</dd><dt id="bib-RFC5988">[RFC5988]</dt><dd rel="dcterms:requires">M. Nottingham. <cite><a href="http://www.ietf.org/rfc/rfc5988.txt">Web Linking</a>.</cite> October 2010. Internet RFC 5988. URL: <a href="http://www.ietf.org/rfc/rfc5988.txt">http://www.ietf.org/rfc/rfc5988.txt</a>
</dd><dt id="bib-XMLSCHEMA11-2">[XMLSCHEMA11-2]</dt><dd rel="dcterms:requires">David Peterson; Sandy Gao; Ashok Malhotra; Michael Sperberg-McQueen; Henry Thompson; Paul V. Biron et al. <a href="http://www.w3.org/TR/xmlschema11-2/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes</cite></a>. 5 April 2012. W3C Recommendation. URL: <a href="http://www.w3.org/TR/xmlschema11-2/">http://www.w3.org/TR/xmlschema11-2/</a>
</dd></dl></section><section rel="bibo:chapter" resource="#informative-references" typeof="bibo:Chapter" id="informative-references"><h3 id="h3_informative-references" role="heading" aria-level="2"><span class="secno">B.2 </span>Informative references</h3><dl about="" class="bibliography"><dt id="bib-BCP47">[BCP47]</dt><dd rel="dcterms:references">A. Phillips; M. Davis. <a href="http://tools.ietf.org/html/bcp47"><cite>Tags for Identifying Languages</cite></a>. September 2009. IETF Best Current Practice. URL: <a href="http://tools.ietf.org/html/bcp47">http://tools.ietf.org/html/bcp47</a>
</dd><dt id="bib-ECMA-262">[ECMA-262]</dt><dd rel="dcterms:references"><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm"><cite>ECMAScript Language Specification, Edition 5.1</cite></a>. June 2011. URL: <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">http://www.ecma-international.org/publications/standards/Ecma-262.htm</a>
</dd><dt id="bib-JSON-LD-TESTS">[JSON-LD-TESTS]</dt><dd rel="dcterms:references"><cite><a href="http://www.w3.org/2013/json-ld-tests/">JSON-LD 1.0 Test Suite</a></cite>. W3C Test Suite. URL: <a href="http://www.w3.org/2013/json-ld-tests/">http://www.w3.org/2013/json-ld-tests/</a>
</dd><dt id="bib-PROMISES">[PROMISES]</dt><dd rel="dcterms:references">Domenic Denicola. <cite><a href="https://github.com/domenic/promises-unwrapping">Promise Objects</a>.</cite> October 2013. (work in progress). URL: <a href="http://www.w3.org/2013/10/json-ld-api/snapshot-promises-draft">http://www.w3.org/2013/10/json-ld-api/snapshot-promises-draft</a>. The latest draft is available at <a href="https://github.com/domenic/promises-unwrapping">https://github.com/domenic/promises-unwrapping</a>
</dd><dt id="bib-RDF11-CONCEPTS">[RDF11-CONCEPTS]</dt><dd rel="dcterms:references">Richard Cyganiak, David Wood, Markus Lanthaler, Editors. <cite><a href="http://www.w3.org/TR/2013/CR-rdf11-concepts-20131105/">RDF 1.1 Concepts and Abstract Syntax.</a></cite> 5 November 2013. W3C Candidate Recommendation (work in progress). URL: <a href="http://www.w3.org/TR/2013/CR-rdf11-concepts-20131105/">http://www.w3.org/TR/2013/CR-rdf11-concepts-20131105/</a>. The latest edition is available at <a href="http://www.w3.org/TR/rdf11-concepts/">http://www.w3.org/TR/rdf11-concepts/</a>
</dd><dt id="bib-RFC6839">[RFC6839]</dt><dd rel="dcterms:references">Tony Hansen, Alexey Melnikov. <cite><a href="http://www.ietf.org/rfc/rfc6839.txt">Additional Media Type Structured Syntax Suffixes</a>.</cite> January 2013. Internet RFC 6839. URL: <a href="http://www.ietf.org/rfc/rfc6839.txt">http://www.ietf.org/rfc/rfc6839.txt</a>
</dd><dt id="bib-TURTLE">[TURTLE]</dt><dd rel="dcterms:references">Eric Prud'hommeaux, Gavin Carothers, Editors. <cite><a href="http://www.w3.org/TR/2013/CR-turtle-20130219/">Turtle: Terse RDF Triple Language.</a></cite> 19 February 2013. W3C Candidate Recommendation (work in progress). URL: <a href="http://www.w3.org/TR/2013/CR-turtle-20130219/">http://www.w3.org/TR/2013/CR-turtle-20130219/</a>. The latest edition is available at <a href="http://www.w3.org/TR/turtle/">http://www.w3.org/TR/turtle/</a>
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd rel="dcterms:references">Cameron McCormack, Editor. <cite><a href="http://www.w3.org/TR/2012/CR-WebIDL-20120419/">Web IDL.</a></cite> 19 April 2012. W3C Candidate Recommendation (work in progress). URL: <a href="http://www.w3.org/TR/2012/CR-WebIDL-20120419/">http://www.w3.org/TR/2012/CR-WebIDL-20120419/</a>. The latest edition is available at <a href="http://www.w3.org/TR/WebIDL/">http://www.w3.org/TR/WebIDL/</a>
</dd></dl></section></section></body></html>
